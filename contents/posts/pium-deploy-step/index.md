---
title: "í”¼ì›€ì˜ ë°°í¬ê³¼ì •"
description: "ë„ë©”ì¸, í¬íŠ¸í¬ì›Œë”©, ì„œë¸Œë„ë©”ì¸ ì„¤ì •ì„ ì§„í–‰í•©ë‹ˆë‹¤."
date: 2023-07-18
update: 2023-07-18
tags:
  - ë°°í¬
  - ì¸í”„ë¼
---

> ì´ ê¸€ì€ ìš°í…Œì½” í”¼ì›€íŒ€ í¬ë£¨ '[ì£¼ë…¸](https://github.com/Choi-JJunho)'ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.
 

## ì„œë¡ 

![](.index_images/3162b98e.png)

http://pium.life ë¡œ ì ‘ì†í•˜ë©´ í”¼ì›€ì˜ í™ˆí˜ì´ì§€ê°€ ë‚˜ì˜¤ê¸°ê¹Œì§€ì˜ ê³¼ì •ì„ ê¸°ë¡ìœ¼ë¡œ ë‚¨ê²¨ë³´ë ¤ê³  í•œë‹¤.

> ë³¸ ê³¼ì •ì€ ì„œë²„ êµ¬ì¶•ì„ ì²˜ìŒ í•˜ë©´ì„œ ê³¼ì •ì„ ì´í•´í•˜ê¸°ìœ„í•´ ì‘ì„±ëœ ê¸€ì…ë‹ˆë‹¤.
> 
> ë¹ ë¥´ê²Œ ë”°ë¼í•  ìˆ˜ ìˆëŠ” ì„¤ì • ê¸°ë°˜ ê¸€ì„ ì›í•œë‹¤ë©´ ë§ˆì§€ë§‰ ëª©ì°¨ì¸ ì •ë¦¬ë¥¼ í™•ì¸í•´ë³´ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

> ë³¸ ê³¼ì •ì—ì„œëŠ” ì†ŒëŸ‰ì˜ ê³¼ê¸ˆ(?)ì´ ì¡´ì¬í•©ë‹ˆë‹¤.
> (ë„ë©”ì¸ êµ¬ì…ë¹„ìš© : ì•½ 4000ì›)

## ë„ë©”ì¸ ì •í•˜ê¸°

![](.index_images/8e211be2.png)

> ë„ë©”ì¸ì„ êµ¬ì…í•˜ê¸° ìœ„í•´ ë„ë©”ì¸ í˜¸ìŠ¤íŒ… ì‚¬ì´íŠ¸ [ê°€ë¹„ì•„](https://www.gabia.com/)ë¥¼ ì´ìš©í–ˆë‹¤.

`pium.com` `pium.co.kr` `pium.net` ë“±ë“±.
ì„œë¹„ìŠ¤ì˜ ì´ë¦„ìœ¼ë¡œ ìì£¼ ì‚¬ìš©í•˜ëŠ” ë„ë©”ì¸ì„ ìƒì„±í•˜ê³ ì‹¶ì—ˆìœ¼ë‚˜ ì´ë¯¸ ì¡´ì¬í•˜ê±°ë‚˜ ê°€ê²©ì´ ë„ˆë¬´ ë¹„ì‹¸ë‹¤ëŠ” ë¬¸ì œê°€ ìˆì—ˆë‹¤.

ì ë‹¹í•œ ê°€ê²©ì— ì„œë¹„ìŠ¤ì˜ ì´ë¦„ì„ ê°€ì§„ ë„ë©”ì¸ì¸ `pium.life`ë¥¼ ì„ íƒí–ˆë‹¤. (1ë…„ 4000ì›)

## ë„ë©”ì¸ ì„¤ì •í•˜ê¸°

> ê°€ë¹„ì•„ ì„œë¹„ìŠ¤ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ê³¼ì •ì´ ì§„í–‰ë©ë‹ˆë‹¤.

`3.123.123.123`ê³¼ ê°™ì€ ì¸ìŠ¤í„´ìŠ¤ public ip ì£¼ì†Œë¥¼ `pium.life`ë¡œ ë³„ì¹­ì„ ì§€ì •í•´ì£¼ì.

![](.index_images/ce5d100b.png)

ìš°ì¸¡ ìƒë‹¨ì˜ `My ê°€ë¹„ì•„` íƒ­ìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤.

![](.index_images/48a0d2d6.png)

ìš°ì¸¡ì˜ `DNS ê´€ë¦¬íˆ´` íƒ­ìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤.

![](.index_images/dbaa42b0.png)

ë„ë©”ì¸ì˜ `ì„¤ì •` íƒ­ìœ¼ë¡œ ë“¤ì–´ê°„ë‹¤.

![](.index_images/0b4d4be0.png)

DNS ê´€ë¦¬ íƒ­ì˜ `ì„¤ì •` í˜¹ì€ `ë ˆì½”ë“œ ìˆ˜ì •`ì— ë“¤ì–´ê°„ë‹¤.

![](.index_images/d830ba27.png)

ìœ„ì™€ ê°™ì´ ë ˆì½”ë“œë¥¼ ì¶”ê°€í•˜ê³  ì €ì¥í•œë‹¤.

> CNAME ì„¤ì •ì€ í–¥í›„ ì„œë¸Œë„ë©”ì¸ ì„¤ì •ì„ ìœ„í•œ ì„¤ì •ì…ë‹ˆë‹¤.

ì´ì œ http://pium.life ë¡œ ì ‘ì†í•˜ë©´ ì„œë²„ë¡œ ë°”ë¡œ ì ‘ì†í•  ìˆ˜ ìˆê²Œëœë‹¤. (SSH ì ‘ì†ì´ ì•„ë‹Œ HTTP ì ‘ì†ì„ ì˜ë¯¸í•œë‹¤.)

## í™˜ê²½ ì‚´í´ë³´ê¸°

í”¼ì›€ì€ í•˜ë‚˜ì˜ EC2ì— í”„ë¡ íŠ¸ì—”ë“œ, ë°±ì—”ë“œì˜ ë°°í¬ë¥¼ ëª¨ë‘ ì§„í–‰í•˜ë ¤ê³ í•œë‹¤.

ì´ë¥¼ ìœ„í•´ì„œë¼ë©´ ì„œë¡œ ë‹¤ë¥¸ í¬íŠ¸ì— ì„œë¹„ìŠ¤ë¥¼ ë„ì›Œë‘” ë’¤ ê° ìš”ì²­ë³„ë¡œ í¬íŠ¸ë¥¼ ë¶„ì‚°ì‹œí‚¬ í•„ìš”ê°€ ìˆë‹¤.

![](.index_images/ee357fa5.png)

ë•Œë¬¸ì— ìœ„ì™€ ê°™ì€ íë¦„ìœ¼ë¡œ ìš”ì²­ì´ ì§„í–‰ë˜ëŠ” ê²ƒì´ ìµœì¢… ëª©í‘œë‹¤!

### EC2 ë³´ì•ˆê·œì¹™

ìš°ì•„í•œí…Œí¬ì½”ìŠ¤ ê³¼ì •ì—ì„œ ì œê³µë˜ëŠ” EC2ì˜ ë³´ì•ˆê·œì¹™ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.

- ì‚¬ë‚´ì—ì„œë§Œ 22ë²ˆ í¬íŠ¸ ì ‘ì† ê°€ëŠ¥
- 80, 443ì€ ì—´ë ¤ìˆìŒ
- ì´ì™¸ì˜ í¬íŠ¸ëŠ” ì—´ë ¤ìˆì§€ ì•ŠìŒ.

ìš°ë¦¬ê°€ í”íˆ ê°œë°œì„ í•˜ë©´ì„œ ì‚¬ìš©í•˜ëŠ” 3000ë²ˆ í¬íŠ¸ í˜¹ì€ 8080ë²ˆ í¬íŠ¸ë¥¼ í†µí•´ í•´ë‹¹ ì„œë²„ì— ì ‘ê·¼í•˜ì§€ ëª»í•œë‹¤ëŠ” ì´ì•¼ê¸°ë‹¤.

ì¦‰, ë‹¤ì‹œë§í•´ pium.life:8080ê³¼ ê°™ì€ ì ‘ê·¼ì´ ì•ˆëœë‹¤ëŠ” ì´ì•¼ê¸°ë‹¤.

ì¸ë°”ìš´ë“œ ê·œì¹™ì—ì„œ 8080 í˜¹ì€ 3000ë²ˆ í¬íŠ¸ë¥¼ ì—´ì–´ë²„ë¦¬ëŠ” ë°©ë²•ë„ ìˆê² ì§€ë§Œ ë³´ì•ˆ ê·œì¹™ì— ì†ëŒ€ì§€ ì•Šìœ¼ë©´ì„œ í•´ê²°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì°¾ì•„ë³´ì.

## nginxë¡œ í¬íŠ¸í¬ì›Œë”©í•˜ê¸°

linuxì— ì¡´ì¬í•˜ëŠ” `iptables` ëª…ë ¹ì–´ë¥¼ í†µí•´ ì„œë²„ ìì²´ì ìœ¼ë¡œ í¬íŠ¸í¬ì›Œë”© í™˜ê²½ì„ êµ¬ì„±í•  ìˆ˜ë„ ìˆì§€ë§Œ í˜„ì¬ í”¼ì›€ì€ í•˜ë‚˜ì˜ ì„œë²„ì—ì„œ ë‘ê°œì˜ ì–´í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•˜ê³  ìˆê³ , ë„ë©”ì¸ë„ í•˜ë‚˜ë‹¤.

ë”°ë¼ì„œ í›„ì— ì„¤ëª…í•  ì„œë¸Œë„ë©”ì¸ì„ ì ìš©í•˜ê¸° ìœ„í•´ì„œë¼ë„ nginxë¥¼ ì´ìš©í•˜ê¸°ë¡œ í•œë‹¤.

### nginx ì„¤ì¹˜í•˜ê¸°

```shell
sudo apt install nginx
```

```shell
systemctl status nginx
```

![](.index_images/28e0139a.png)

ì´ì œ ì£¼ì†Œì°½ì— ì¸ìŠ¤í„´ìŠ¤ ip ë¥¼ ì¹˜ê³  ì ‘ì†í•˜ë©´ ë‹¤ìŒê³¼ ê°™ì´ nginx default í˜ì´ì§€ë¥¼ ë³¼ ìˆ˜ ìˆë‹¤. 

![](.index_images/9345764b.png)

### 80 í¬íŠ¸ ì ‘ì†ì„ 8080 í¬íŠ¸ë¡œ

> í•´ë‹¹ ê³¼ì •ì€ 8080í¬íŠ¸ì— ì• í”Œë¦¬ì¼€ì´ì…˜ì´ êµ¬ë™ì¤‘ì¸ ìƒíƒœì—ì„œ ì§„í–‰ë©ë‹ˆë‹¤. 
> ë‹¤ìŒ ëª…ë ¹ì–´ë¡œ 8080í¬íŠ¸ì—ì„œ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ êµ¬ë™ì¤‘ì¸ì§€ í™•ì¸í•œë‹¤.
>
> ```shell
> lsof -i tcp:8080
> ```
> ![](.index_images/1573063d.png)

ì´ì œ nginx ì„¤ì •íŒŒì¼ì„ ì‘ì„±í•˜ì—¬ 80í¬íŠ¸ë¡œ ì˜¤ëŠ” ìš”ì²­ì„ 8080í¬íŠ¸ë¡œ ì „í™˜ì‹œì¼œë³¸ë‹¤.

```shell
cd /etc/nginx/sites-available/

sudo vi default
```

> ì£¼ì„ì²˜ë¦¬ ë˜ì–´ìˆëŠ” ë¶€ë¶„ì€ ì œì™¸í•˜ê³  ì½”ë“œë¡œ í‘œí˜„í•©ë‹ˆë‹¤.

```shell
# ë³€ê²½ ì „ íŒŒì¼ë‚´ìš©
server {
        listen 80 default_server;
        listen [::]:80 default_server;

        root /var/www/html;

        index index.html index.htm index.nginx-debian.html;

        server_name _;

        location / {
                try_files $uri $uri/ =404;
        }
}
```

ì²˜ìŒ íŒŒì¼ì„ ì—´ì–´ë³´ë©´ ìœ„ì™€ê°™ì´ ì„¤ì •ë˜ì–´ìˆì„ ê²ƒì´ë‹¤.

ìµœëŒ€í•œ ê°„ëµí•˜ê²Œ í¬íŠ¸ë¥¼ ë³€ê²½í•œë‹¤ëŠ” ëª©ì ë§Œ ë‹¬ì„±í•´ë³´ê¸° ìœ„í•´ ë‹¤ìŒ ë‚´ìš©ë“¤ì„ ìˆ˜ì •í•´ë³´ì.

- `root /var/www/html;` ì£¼ì„ì²˜ë¦¬
- `index index.html index.htm index.nginx-debian.html;` ì£¼ì„ì²˜ë¦¬
- `location / { ... }` ë‚´ë¶€ ë‚´ìš©ì— ë‹¤ìŒ ë‚´ìš© ì¶”ê°€
  - `proxy_set_header Host $host:$server_port;`
  - `proxy_set_header X-Real-IP $remote_addr;`
  - `proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;`
  - `proxy_pass http://127.0.0.1:8080;`

```shell
# ë³€ê²½ëœ íŒŒì¼ë‚´ìš©
server {
        listen 80 default_server;
        listen [::]:80 default_server;

        # root /var/www/html;

        # index index.html index.htm index.nginx-debian.html;

        server_name _;

        location / {
                proxy_set_header Host $host:$server_port;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_pass http://127.0.0.1:8080;
        }
}
```

ìœ„ì™€ê°™ì´ ì„¤ì •íŒŒì¼ì„ ìˆ˜ì •í–ˆë‹¤ë©´ ë‹¤ìŒ ëª…ë ¹ì–´ë¥¼ ìˆ˜í–‰í•´ nginxë¥¼ ë‹¤ì‹œ ì‹œì‘í•œë‹¤.

```shell
sudo systemctl restart nginx
```

![](.index_images/232c6d5d.png)

ìŠ¤í”„ë§ë¶€íŠ¸ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰ì¤‘ì´ì˜€ë‹¤ë©´ ìœ„ì™€ê°™ì€ Whitelabel Error Pageë¥¼ í™•ì¸í•  ìˆ˜ ìˆì„ê²ƒì´ë‹¤.

## ì„œë¸Œë„ë©”ì¸ êµ¬ì„±í•˜ê¸°

ì´ì œ 80í¬íŠ¸ì—ì„œ 8080í¬íŠ¸ë¡œ ìš”ì²­ì„ ë³€í™˜í•˜ëŠ” ê³¼ì •ì€ ì„±ê³µí–ˆë‹¤.

í•˜ë‚˜ì˜ ì„œë²„ì— í”„ë¡ íŠ¸ì—”ë“œ, ë°±ì—”ë“œ ì½”ë“œê°€ ê°™ì´ ë„ì›Œì ¸ì•¼í•˜ë¯€ë¡œ ì„œë¸Œë„ë©”ì¸ì„ í†µí•´ í˜ì´ì§€ì™€ APIë¥¼ êµ¬ë¶„í•´ì¤˜ì•¼í•œë‹¤.

### index íŒŒì¼ ì§€ì •í•˜ê¸° - default íŒŒì¼ ìˆ˜ì •

í”„ë¡ íŠ¸ì—ì„œ ë¹Œë“œ ì‚°ì¶œë¬¼ë¡œ ë‚˜ì˜¨ index.htmlì„ ê¸°ë³¸ í˜ì´ì§€ë¡œ ì°¸ê³ í•˜ë„ë¡ ì„¤ì •í•˜ì.

```shell
cd /etc/nginx/sites-available/

sudo vi default
```

```shell
# ë³€ê²½ ì „ ì„¤ì •ë‚´ìš©
server {
        listen 80 default_server;
        listen [::]:80 default_server;

        # root /var/www/html;

        # index index.html index.htm index.nginx-debian.html;

        server_name _;

        location / {
                proxy_set_header Host $host:$server_port;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
                proxy_pass http://127.0.0.1:8080;
        }
}
```

ê¸°ì¡´ì— 80í¬íŠ¸ë¥¼ 8080í¬íŠ¸ë¡œ í¬ì›Œë”©ì‹œì¼œì£¼ëŠ” ì„¤ì •ì„ ë°”ê¿”ì¤€ë‹¤.

```shell
# ë³€ê²½ í›„ ì„¤ì •ë‚´ìš©
server {
        listen 80 default_server;
        listen [::]:80 default_server;

        root /var/www/html;

        index index.html;

        server_name pium.life;

        location / {
        }
}
```

ì´ì œ pium.lifeë¡œ ì ‘ì†í•˜ë©´ `/var/www/html` ê²½ë¡œì— ìˆëŠ” `index.html`ì„ ì°¸ì¡°í•˜ë„ë¡ ì„¤ì •ë˜ì—ˆë‹¤.

ìœ„ ì„¤ì •ì— ë”°ë¥´ë©´ `index.html` ë° `bundle.js`, `assets` ë“±ì˜ í”„ë¡ íŠ¸ ë¦¬ì†ŒìŠ¤ë“¤ì€ ì„œë²„ì˜ `/var/www/html`ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ìœ„ì¹˜ì‹œí‚¤ë©´ ëœë‹¤.

> ë¹Œë“œ ì‚°ì¶œë¬¼ ë° CDì™€ ê´€ë ¨ëœ ë‚´ìš©ì€ ë³¸ ê²Œì‹œê¸€ì—ì„œ ë‹¤ë£¨ì§€ ì•ŠìŠµë‹ˆë‹¤.

### API ì„œë²„ ì§€ì •í•˜ê¸° - api_config íŒŒì¼ ë§Œë“¤ê¸°

http://api.pium.life ë¡œ APIë¥¼ í˜¸ì¶œí•˜ë„ë¡ êµ¬ì„±í•´ë³´ì.

nginxëŠ” ê¸°ë³¸ì ìœ¼ë¡œ `/etc/nginx/sites-enabled` ê²½ë¡œì— ìˆëŠ” íŒŒì¼ë“¤ì„ ì°¸ê³ í•˜ì—¬ ì„¤ì •íŒŒì¼ì— ì ìš©í•œë‹¤.

> `/etc/nginx/nginx.conf` íŒŒì¼ì˜ 60ë²ˆì§¸ ì¤„ ì°¸ê³ 
> 
> ![](.index_images/f4ceb33e.png)

ë‹¤ìŒ ê³¼ì •ì„ í†µí•´ ì„œë¸Œë„ë©”ì¸ ì„¤ì •ì„ í•´ë³´ì.

```shell
cd /etc/nginx/sites-available

sudo vi api_config
```

```shell
# api_config íŒŒì¼ ë‚´ìš©
server {
        listen 80;
        listen [::]:80;

        server_name api.pium.life;
        
        location / {
                proxy_set_header Host $host:$server_port;
                proxy_set_header X-Real-IP $remote_addr;
                proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;

                proxy_pass http://127.0.0.1:8080;
        }
}
```

`server_name` ì˜µì…˜ì„ í†µí•´ api.pium.life ë¼ëŠ” ë„ë©”ì¸ìœ¼ë¡œ ì ‘ê·¼í•˜ëŠ” ìš”ì²­ì„ í™•ì¸í•˜ê³ , ë§ë‹¤ë©´ 8080 í¬íŠ¸ë¡œ ë³€ê²½í•œë‹¤.

ìœ„ì™€ ê°™ì´ íŒŒì¼ì„ ì‘ì„±í–ˆìœ¼ë©´ `sites-enabled` ê²½ë¡œì— soft link(ë°”ë¡œê°€ê¸°)ë¥¼ ìƒì„±í•œë‹¤.

```shell
ln -s /etc/nginx/sites-available/api_config /etc/nginx/sites-enabled/api_config
```

ì´ì œ nginxë¥¼ ì¬ì‹œì‘í•˜ì—¬ ì„¤ì •ì„ ì ìš©í•´ë³´ì.

> ğŸ’¡ Tip : `nginx -t` ëª…ë ¹ì–´ë¥¼ í†µí•´ í˜„ì¬ ì„¤ì •íŒŒì¼ì´ ì •ìƒì ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆëŠ”ì§€ í™•ì¸í•  ìˆ˜ìˆë‹¤.
> 
> ![](.index_images/10d7627b.png)

![](.index_images/04601361.png)

http://api.pium.life ë¡œ ì ‘ì†í•˜ë©´ APIë¡œ ì—°ê²°ë˜ëŠ”ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.

## ì •ë¦¬

- 8080 í¬íŠ¸ì— API ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ì‹¤í–‰í•œë‹¤.
- ë„ë©”ì¸ êµ¬ì… ë° A ë ˆì½”ë“œ, CNAMEì„ ì„¤ì •í•œë‹¤.
- nginxë¥¼ ì„¤ì¹˜í•œë‹¤.
- í”„ë¡ íŠ¸ ë¹Œë“œ ì‚°ì¶œë¬¼ì„ `/var/www/html` ê²½ë¡œì— ì¤€ë¹„í•œë‹¤. (index.html, bundle.js, assets ë“±)
- ì„œë¸Œë„ë©”ì¸ ë° í¬íŠ¸í¬ì›Œë”© ì„¤ì •í•œë‹¤.

### nginx ì„¤ì • ëª…ë ¹ì–´ ë”°ë¼ê°€ê¸°

```shell
# nginx ì„¤ì¹˜
sudo apt install nginx

# default íŒŒì¼ ìˆ˜ì •
sudo vi /etc/nginx/sites-available/default
```

```shell
# /etc/nginx/sites-available/default íŒŒì¼ ë‚´ìš©
server {
        listen 80 default_server;
        listen [::]:80 default_server;

        root /var/www/html;

        index index.html;

        server_name pium.life;

        location / {
        }
}
```

```shell
# api_config íŒŒì¼ ì‘ì„±
sudo vi /etc/nginx/sites-available/api_config
```

```shell
# api_config íŒŒì¼ ë‚´ìš©
server {
        listen 80 default_server;
        listen [::]:80 default_server;

        root /var/www/html;

        index index.html;

        server_name pium.life;

        location / {
        }
}
```

```shell
# nginx ì¬ì‹œì‘ ë° ì„¤ì •ì ìš©
sudo systemctl restart nginx
```

## Reference

- https://jminie.tistory.com/110
- https://customer.gabia.com/manual/domain/287/1201