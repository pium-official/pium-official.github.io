{"componentChunkName":"component---src-templates-post-jsx","path":"/acceptance-test-resolve/","result":{"data":{"site":{"siteMetadata":{"title":"pium.log"}},"markdownRemark":{"id":"80aa708e-ef8a-5c79-9644-cb8c04d55a63","excerpt":"ì´ ê¸€ì€ ìš°í…Œì½” í”¼ì›€íŒ€ í¬ë£¨ 'ì£¼ë…¸'ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. ì„œë¡  ì¸ìˆ˜í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ë©´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤. RestAssuredë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤. ê° í…ŒìŠ¤íŠ¸ë³„ë¡œ (DB)ë°ì´í„°ê°€ ê²©ë¦¬ëœ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê³  ì‹¶ë‹¤. ì´ì— ë‹¤ìŒê³¼ ê°™ì€ ì‹œí–‰ì°©ì˜¤ë¥¼ ê±°ì³¤ë‹¤. ìµœì¢…ì ìœ¼ë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ ë³´ê³ ì‹¶ë‹¤ë©´ ìµœì¢…ì½”ë“œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”. ì‹œí–‰ì°©ì˜¤ JPAë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” í˜„ ì‹œì ì—ì„œâ€¦","html":"<blockquote>\n<p>ì´ ê¸€ì€ ìš°í…Œì½” í”¼ì›€íŒ€ í¬ë£¨ '<a href=\"https://github.com/Choi-JJunho\">ì£¼ë…¸</a>'ê°€ ì‘ì„±í–ˆìŠµë‹ˆë‹¤.</p>\n</blockquote>\n<h2>ì„œë¡ </h2>\n<p>ì¸ìˆ˜í…ŒìŠ¤íŠ¸ë¥¼ ì‘ì„±í•˜ë©´ì„œ ë‹¤ìŒê³¼ ê°™ì€ ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.</p>\n<ul>\n<li>RestAssuredë¥¼ ì‚¬ìš©í•˜ê³  ìˆë‹¤.</li>\n<li>ê° í…ŒìŠ¤íŠ¸ë³„ë¡œ (DB)ë°ì´í„°ê°€ ê²©ë¦¬ëœ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê³  ì‹¶ë‹¤.</li>\n</ul>\n<p>ì´ì— ë‹¤ìŒê³¼ ê°™ì€ ì‹œí–‰ì°©ì˜¤ë¥¼ ê±°ì³¤ë‹¤.</p>\n<blockquote>\n<p>ìµœì¢…ì ìœ¼ë¡œ ì‘ì„±ëœ ì½”ë“œë¥¼ ë³´ê³ ì‹¶ë‹¤ë©´ ìµœì¢…ì½”ë“œë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>\n</blockquote>\n<h2>ì‹œí–‰ì°©ì˜¤</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token annotation punctuation\">@SpringBootTest</span><span class=\"token punctuation\">(</span>webEnvironment <span class=\"token operator\">=</span> <span class=\"token class-name\">SpringBootTest<span class=\"token punctuation\">.</span>WebEnvironment</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RANDOM_PORT</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DictionaryPlantApiTest</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>JPAë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ” í˜„ ì‹œì ì—ì„œ<code class=\"language-text\">@Transactional</code>ì„ ì´ìš©í•´ì„œ í•˜ë‚˜ì˜ í…ŒìŠ¤íŠ¸(íŠ¸ëœì­ì…˜)ì´ ëë‚  ë•Œ ë°ì´í„°ê°€ ë¡¤ë°±ë˜ëŠ” í˜„ìƒì„ ê¸°ëŒ€í–ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Test</span>\n<span class=\"token keyword\">void</span> ì‚¬ì „_ì‹ë¬¼_ìƒì„¸ì •ë³´_ì¡°íšŒ_ì‹œ_ì‚¬ì „_ì‹ë¬¼_ì •ë³´_ë°˜í™˜<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token comment\">// dictionaryPlantRepository.save() ì— ëŒ€í•œ Fixture</span>\n    <span class=\"token class-name\">DictionaryPlant</span> <span class=\"token constant\">REQUEST</span> <span class=\"token operator\">=</span> dictionaryPlantSupport<span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">DictionaryPlantResponse</span> <span class=\"token constant\">RESPONSE</span> <span class=\"token operator\">=</span> <span class=\"token class-name\">RestAssured</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">given</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">when</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">get</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/dictionary-plants/{id}\"</span><span class=\"token punctuation\">,</span> <span class=\"token constant\">REQUEST</span><span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">all</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">statusCode</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HttpStatus</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OK</span><span class=\"token punctuation\">.</span><span class=\"token function\">value</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">extract</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">as</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DictionaryPlantResponse</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    \n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/6a7264de6762b8d1cca647aaf3a1fff8/06e4e/807f392f.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 33.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAz0lEQVR42o2QS4LEIAhEc5L4AY3amdhq7n+1moo9vZ1k8UQQCnDZi+JsBeP9Qqu0bUd/F7QjY9BP0cG55yxtT0jlQAwOSQ1q8Mgq9D+IZ6L3zwVLjnASoaoIRKyDMRaWj9ZarMZgXVfGzPTvJ6wJrbXJljhtzujjRC5lxvoY6OeJo9YZEzZ1/wgvOSl6/xPcNliuKIFF4mfxNbmGMO8iAn+z/mK54rXSRXAeI2zo+mEXijDpi3/yh9cxu5KNAo1CVePkID/kpYE2QJljbwR/AcR4xxodFiVIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='807f392f' title='' src='/static/6a7264de6762b8d1cca647aaf3a1fff8/ca1dc/807f392f.png' srcset='/static/6a7264de6762b8d1cca647aaf3a1fff8/e7570/807f392f.png 170w,\n/static/6a7264de6762b8d1cca647aaf3a1fff8/f46e7/807f392f.png 340w,\n/static/6a7264de6762b8d1cca647aaf3a1fff8/ca1dc/807f392f.png 680w,\n/static/6a7264de6762b8d1cca647aaf3a1fff8/02d09/807f392f.png 1020w,\n/static/6a7264de6762b8d1cca647aaf3a1fff8/9d567/807f392f.png 1360w,\n/static/6a7264de6762b8d1cca647aaf3a1fff8/06e4e/807f392f.png 2054w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>í•˜ì§€ë§Œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•  ë•Œ JPARepositoryë¡œ saveí•œ ê°’ì„ RestAssuredë¥¼ ì´ìš©í•´ ì¡°íšŒí•˜ë©´ ë°ì´í„°ê°€ ë°˜ì˜ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.</p>\n<h3>ë¬¸ì œ ì¸ì‹</h3>\n<p><a href=\"https://stackoverflow.com/questions/41763417/api-test-transactional-rollback\">Stack Overflow</a>ì˜ ë‹¤ìŒ ê¸€ì„ ì½ì–´ë³¸ ë’¤ ë‹¤ìŒê³¼ ê°™ì€ ì§€ì‹ì„ ì–»ì—ˆë‹¤.</p>\n<blockquote>\n<p>@Transactional only works within the same thread, and as such the rollback provided by Spring will only work on the objects that were persisted on the thread where the transaction was started.\nYour rest-assured test will perform an integration test and will hit your Spring context on another thread. So although your rest-assured test would be able to see the objects persisted in your test setup, Spring will never be able to cleanup resources persisted in your rest-assured test automatically.\nThe only way to tackle this is to delete the entities yourself in your test (Using an Junit Rule, or cleaning up any state in your test setup).</p>\n</blockquote>\n<p>ìš”ì•½í•˜ë©´ ë‹¤ìŒê³¼ ê°™ë‹¤.</p>\n<blockquote>\n<p>íŠ¸ëœì­ì…˜ì€ ë™ì¼í•œ ìŠ¤ë ˆë“œ ë‚´ì—ì„œ ë™ì‘í•œë‹¤.\nSpringì—ì„œ ì œê³µí•˜ëŠ” ë¡¤ë°±ì€ íŠ¸ëœì­ì…˜ì´ ì‹œì‘ëœ ìŠ¤ë ˆë“œ ë‚´ì—ì„œ ìƒê¸´ ê°ì²´ì— ëŒ€í•´ì„œë§Œ ë™ì‘í•œë‹¤.\nRestAssuredëŠ” ë³„ë„ì˜ ìŠ¤ë ˆë“œë¥¼ í†µí•´ Spring ì»¨í…ìŠ¤íŠ¸ë¥¼ ì´ìš©í•œë‹¤.\nì´ ë•Œë¬¸ì— RestAssuredëŠ” ì „ì—­ì ìœ¼ë¡œ ì„¤ì •ëœ ë°ì´í„° (Data.sqlê³¼ ê°™ì€ ì„¤ì •ìœ¼ë¡œ ìƒê¸´ ë°ì´í„°)ì—ëŠ” ì ‘ê·¼í•  ìˆ˜ ìˆìœ¼ë‚˜ Transactionê³¼ ê°™ì´ ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œë§Œ ì œê³µë˜ëŠ” ê°’ì— ëŒ€í•´ì„œëŠ” ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤.\n... (í•´ê²°ë°©ë²• í›„ëµ)</p>\n</blockquote>\n<p>ìœ„ì™€ ê°™ì´ ë³„ë„ì˜ RestAssuredì˜ ìš”ì²­ì´ ìŠ¤ë ˆë“œë¡œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— í•˜ë‚˜ì˜ íŠ¸ëœì­ì…˜ì—ì„œ ë³„ê°œë¡œ ì €ì¥í•œ ê°’ì— ì ‘ê·¼í•  ìˆ˜ ì—†ë‹¤ëŠ” ê²°ë¡ ì´ ë‚˜ì™”ë‹¤.</p>\n<blockquote>\n<p>ìì„¸í•œ ë‚´ìš©ì€ <a href=\"https://pium-official.github.io/transactional-not-in-restassured/\">í•˜ë§ˆë“œì˜ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê¸€</a>ì„ ì°¸ê³ í•´ì£¼ì„¸ìš”~</p>\n</blockquote>\n<h2>í•´ê²°ë°©ë²•</h2>\n<p>ì´ ë¬¸ì œì— ëŒ€í•´ì„œ ë‹¤ì–‘í•œ í•´ê²°ë°©ë²•ì´ ì¡´ì¬í•˜ê³  ê°ê°ì˜ ì¥ë‹¨ì ì„ ë¹„êµí•œ ë’¤ ìµœì¢…ì ìœ¼ë¡œ ì–´ë–¤ ë°©ì‹ì„ ì„ íƒí• ì§€ ê³ ë¯¼í•´ë³´ì.</p>\n<h3>1ï¸âƒ£ DirtiesContext ì‚¬ìš©í•˜ê¸°</h3>\n<p>ë§¤ í…ŒìŠ¤íŠ¸ë§ˆë‹¤ Contextë¥¼ ìƒˆë¡­ê²Œ ë„ì›Œì„œ ë°ì´í„°ë¥¼ ë§¤ë²ˆ ì´ˆê¸°í™”í•˜ëŠ” ë°©ë²•ì„ ìƒê°í•´ë³¼ ìˆ˜ ìˆë‹¤.</p>\n<h4>ì¥ì </h4>\n<p>ì»¨í…ìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ ë¡œë“œí•˜ë©´ì„œ í…ŒìŠ¤íŠ¸ê°„ ê²©ë¦¬ í™˜ê²½ì„ ëª…í™•í•˜ê²Œ êµ¬ë¶„í•  ìˆ˜ ìˆë‹¤.</p>\n<h4>ë‹¨ì </h4>\n<ul>\n<li>ë§¤ í…ŒìŠ¤íŠ¸ë§ˆë‹¤ ì»¨í…ìŠ¤íŠ¸ë¥¼ ë‹¤ì‹œ ë¡œë“œí•˜ê¸° ë•Œë¬¸ì— ì†ë„ê°€ ìƒëŒ€ì ìœ¼ë¡œ ëŠë¦¬ë‹¤.</li>\n<li>@Nested ë‚´ë¶€ì— ì •ì˜ë˜ì–´ìˆëŠ” í…ŒìŠ¤íŠ¸ì— ëŒ€í•´ DirtiesContextê°€ ì ìš©ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆë‹¤.\n<a href=\"https://docs.spring.io/spring-framework/reference/testing/testcontext-framework/support-classes.html#testcontext-junit-jupiter-nested-test-configuration\">Spring @Nested ê´€ë ¨ ê³µì‹ ë¬¸ì„œ</a>\n@Nested ë‚´ë¶€ì— ì •ì˜ëœ í…ŒìŠ¤íŠ¸ì— DirtiesContextë¥¼ ì „íŒŒí•˜ê¸° ìœ„í•´ ì•„ë˜ ì„¤ì •ì„ ì¶”ê°€í•´ì¤˜ì•¼í•œë‹¤.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// í´ë˜ìŠ¤ë ˆë²¨ì— ë‹¤ìŒ ì–´ë…¸í…Œì´ì…˜ì„ ì¶”ê°€í•´ì£¼ê±°ë‚˜</span>\n<span class=\"token annotation punctuation\">@NestedTestConfiguration</span><span class=\"token punctuation\">(</span>value <span class=\"token operator\">=</span> <span class=\"token class-name\">NestedTestConfiguration<span class=\"token punctuation\">.</span>EnclosingConfiguration</span><span class=\"token punctuation\">.</span><span class=\"token constant\">OVERRIDE</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p>í˜¹ì€ properteis ì„¤ì •ì„ ë³€ê²½í•´ì£¼ëŠ” ë°©ì‹ë„ ì¡´ì¬í•œë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"properties\"><pre class=\"language-properties\"><code class=\"language-properties\"><span class=\"token comment\"># properties íŒŒì¼ì— ë‹¤ìŒ ì„¤ì •ì„ ì¶”ê°€í•´ì£¼ì–´ ì „ì—­ì ìœ¼ë¡œ @Nested ê¸°ë³¸ ì „ëµì„ ì„¤ì •í•  ìˆ˜ ìˆë‹¤.</span>\n<span class=\"token key attr-name\">spring.test.enclosing.configuration</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">OVERRIDE</span></code></pre></div>\n<blockquote>\n<p>ì°¸ê³  ë¬¸ì„œ : <a href=\"https://docs.spring.io/spring-framework/reference/testing/annotations/integration-junit-jupiter.html#integration-testing-annotations-nestedtestconfiguration\">Changing the default enclosing configuration inheritance mode</a></p>\n</blockquote>\n<h3>2ï¸âƒ£ @SQL ì‚¬ìš©í•˜ê¸°</h3>\n<p>@SQL ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í•˜ì—¬ ë§¤ í…ŒìŠ¤íŠ¸ ì‹¤í–‰ ì „ SQL ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•˜ì—¬ í…Œì´ë¸”ì„ ë‹¤ì‹œ ë§Œë“¤ ìˆ˜ ìˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Sql</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"classpath:init.sql\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@SpringBootTest</span><span class=\"token punctuation\">(</span>webEnvironment <span class=\"token operator\">=</span> <span class=\"token class-name\">SpringBootTest<span class=\"token punctuation\">.</span>WebEnvironment</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RANDOM_PORT</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DictionaryPlantApiTest</span> <span class=\"token punctuation\">{</span>\n  <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>ì¥ì </h4>\n<ul>\n<li>ì—¬ëŸ¬ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ìˆ˜í–‰í•  ìˆ˜ ìˆë‹¤.</li>\n<li>ìŠ¤í‚¤ë§ˆ ì´ˆê¸°í™” í›„ í…Œì´í„°ë„ í•¨ê»˜ ë„£ì„ ìˆ˜ ìˆë‹¤.</li>\n</ul>\n<h4>ë‹¨ì </h4>\n<ul>\n<li>í…ŒìŠ¤íŠ¸ì— ì‚¬ìš©í•˜ëŠ” DBê°€ ë³€ê²½ë˜ì—ˆì„ ë•Œ í•´ë‹¹ ë²¤ë”ì‚¬ì˜ Dialectì— ë§ê²Œ SQLë¬¸ì„ ê³ ì³ì¤˜ì•¼í•œë‹¤.</li>\n<li>ì¿¼ë¦¬ë¥¼ í…ìŠ¤íŠ¸ë¡œ ê´€ë¦¬í•˜ë‹¤ë³´ë‹ˆ ì»´íŒŒì¼íƒ€ì„ì— ì˜¤ë¥˜ë¥¼ ì¡ê¸° ì–´ë µë‹¤.</li>\n<li>í…Œì´ë¸” ì—°ê´€ê´€ê³„ê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš° ì¿¼ë¦¬ë¬¸ ì‘ì„± ìˆœì„œì— ì‹ ê²½ì„ ë§ì´ ì¨ì•¼í•œë‹¤.</li>\n</ul>\n<h3>3ï¸âƒ£ InitializingBean ì‚¬ìš©í•˜ê¸°</h3>\n<p><code class=\"language-text\">InitializingBean</code>ì„ ì´ìš©í•˜ì—¬ ìŠ¤í”„ë§ Beanì´ ì´ˆê¸°í™”, ì†Œë©¸ ë  ë•Œ í–‰ìœ„ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// InitializingBeanì˜ ìƒê¹€ìƒˆ</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">InitializingBean</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">void</span> <span class=\"token function\">afterPropertiesSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ì´ë¥¼ ì´ìš©í•´ @Test ì–´ë…¸í…Œì´ì…˜ìœ¼ë¡œ Beanì´ ë“±ë¡ë  ë•Œ ë§ˆë‹¤ DBì„ ì´ˆê¸°í™”í•˜ëŠ” ìƒí™©ì„ ê¸°ëŒ€í•  ìˆ˜ ìˆë‹¤.</p>\n<p><strong>Entity Managerë¥¼ ì´ìš©í•´ DB ì´ˆê¸°í™”í•˜ê¸°</strong></p>\n<p>JPAë¥¼ ì‚¬ìš©í•˜ëŠ” ì…ì¥ìœ¼ë¡œ SQLë¬¸ì„ ì‘ì„±í•˜ê¸° ë³´ë‹¤ëŠ” EntityManagerë¥¼ ì´ìš©í•´ë³´ëŠ”ê²ƒì´ ì •ì ì¸ ì¿¼ë¦¬ ê´€ë¦¬ì— ë“¤ì´ëŠ” ì†Œìš”ê°€ ì ì„ ê²ƒì´ë¼ê³  ìƒê°ëœë‹¤.</p>\n<p>ì´ì— EntityManagerë¥¼ ì´ìš©í•˜ì—¬ DBë¥¼ ì´ˆê¸°í™”í•˜ëŠ” ë°©ë²•ì„ ì•Œì•„ë³´ì.</p>\n<blockquote>\n<p>ì•„ë˜ë¶€í„°ëŠ” <a href=\"https://ttl-blog.tistory.com/1407\">https://ttl-blog.tistory.com/1407</a> ë¥¼ ì°¸ê³ í•˜ì—¬ ì§„í–‰ëœ ê¸€ì…ë‹ˆë‹¤.</p>\n</blockquote>\n<h4>table ì´ë¦„ ì¡°íšŒí•˜ê¸°</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@Profile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseCleaner</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">InitializingBean</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token comment\">// í…Œì´ë¸” ì´ë¦„ë“¤ì„ ì €ì¥í•  List</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> tables <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ ì„ ì–¸í•œë‹¤</span>\n    <span class=\"token annotation punctuation\">@PersistenceContext</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">EntityManager</span> entityManager<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unchecked\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@PostConstruct</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">findDatabaseTableNames</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">List</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> tableInfos <span class=\"token operator\">=</span> entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">createNativeQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SHOW TABLES\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResultList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> tableInfo <span class=\"token operator\">:</span> tableInfos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">String</span> tableName <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> tableInfo<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            tableNames<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>tableName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>EntityManagerë¥¼ ì´ìš©í•˜ì—¬ ëª¨ë“  í…Œì´ë¸”ì˜ ì´ë¦„ì„ ê°€ì ¸ì˜¨ë‹¤.</p>\n<h4>í…Œì´ë¸” ì´ˆê¸°í™”í•˜ê¸° &#x26; ì‹¤í–‰í•˜ê¸°</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@Profile</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"test\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseCleaner</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">InitializingBean</span> <span class=\"token punctuation\">{</span>\n\n\t<span class=\"token comment\">// í…Œì´ë¸” ì´ë¦„ë“¤ì„ ì €ì¥í•  List</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> tables <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// ì—”í‹°í‹° ë§¤ë‹ˆì €ë¥¼ ì„ ì–¸í•œë‹¤</span>\n    <span class=\"token annotation punctuation\">@PersistenceContext</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">EntityManager</span> entityManager<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// í…Œì´ë¸” ì´ë¦„ì„ ì¡°íšŒí•œë‹¤</span>\n    <span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unchecked\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@PostConstruct</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">findDatabaseTableNames</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token punctuation\">}</span>\n    \n    <span class=\"token comment\">// í…Œì´ë¸”ì„ ì´ˆê¸°í™”í•œë‹¤</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">truncate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">createNativeQuery</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SET FOREIGN_KEY_CHECKS %d\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> tableName <span class=\"token operator\">:</span> tableNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">createNativeQuery</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TRUNCATE TABLE %s\"</span><span class=\"token punctuation\">,</span> tableName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">createNativeQuery</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SET FOREIGN_KEY_CHECKS %d\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">afterPropertiesSet</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token function\">findDatabaseTableNames</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">truncate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>truncateë¥¼ ìˆ˜í–‰í•˜ì—¬ ëª¨ë“  í…Œì´ë¸”ì˜ ë°ì´í„°ë¥¼ ì´ˆê¸°í™”í•˜ê³  ì‹¤í–‰í•œë‹¤.</p>\n<p>ê²°ê³¼ì ìœ¼ë¡œ ë´¤ì„ ë•Œ ë‹¤ìŒê³¼ ê°™ì€ íë¦„ìœ¼ë¡œ ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™”ê°€ ìˆ˜í–‰ëœë‹¤.</p>\n<ul>\n<li>Beanì´ ìƒì„±ëœ ì´í›„ Table ì´ë¦„ì„ ì°¾ëŠ”ë‹¤.</li>\n<li>ì˜ì†ì„± ì»¨í…ìŠ¤íŠ¸ì˜ 1ì°¨ ìºì‹œë¥¼ ë¹„ìš°ê³  í…Œì´ë¸”ì„ ì´ˆê¸°í™”í•œë‹¤.</li>\n</ul>\n<h4>í…ŒìŠ¤íŠ¸ì½”ë“œì— ì ìš©í•˜ê¸°</h4>\n<p>ì¸ìˆ˜í…ŒìŠ¤íŠ¸ë¥¼ <code class=\"language-text\">AcceptanceTest</code>ë¡œ ë¶„ë¦¬í•˜ê³  ìƒì†ë°›ëŠ” êµ¬ì¡°ë¡œ ë³€ê²½í–ˆë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@SpringBootTest</span><span class=\"token punctuation\">(</span>webEnvironment <span class=\"token operator\">=</span> <span class=\"token class-name\">SpringBootTest<span class=\"token punctuation\">.</span>WebEnvironment</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RANDOM_PORT</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AcceptanceTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@LocalServerPort</span>\n    <span class=\"token keyword\">int</span> port<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Autowired</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DatabaseCleaner</span> databaseCleaner<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@BeforeEach</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">setUp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">RestAssured</span><span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> port<span class=\"token punctuation\">;</span>\n        databaseCleaner<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ì‘ì—…í•œ ë‚´ìš©ì„ ì ìš©í•˜ë©´ ìœ„ì™€ ê°™ì´ ì½”ë“œë¥¼ ì‘ì„±í•  ìˆ˜ ìˆë‹¤.</p>\n<h4>ì¥ì </h4>\n<ul>\n<li>í…ŒìŠ¤íŠ¸ ì½”ë“œê°€ ì¿¼ë¦¬ì— ì˜ì¡´ì ì´ì§€ ì•Šë‹¤.</li>\n<li>ì„¤ì •ì„ ë¶„ë¦¬í•˜ì—¬ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.</li>\n</ul>\n<h4>ë‹¨ì </h4>\n<ul>\n<li>JPAì— ì¢…ì†ì ì¸ ì„¤ì •ì´ê¸° ë•Œë¬¸ì— JPAë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê±°ë‚˜ ORMì„ ì œì™¸í•˜ëŠ” ìƒí™©ì„ ê³ ë ¤í•œë‹¤ë©´ í•´ë‹¹ ë°©ì‹ì˜ ë„ì…ì„ ìƒê°í•´ë³¼ í•„ìš”ê°€ ìˆë‹¤.</li>\n<li>AcceptenceTest ì´ì™¸ì— ë‹¤ë¥¸ í†µí•©í…ŒìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•˜ë ¤ë©´ ì¤‘ë³µëœ ì½”ë“œë¥¼ ì‘ì„±í•´ì•¼í•œë‹¤.</li>\n<li>\n<p>Bean ìƒì„± ì£¼ê¸°ì— ëŒ€í•œ ì„¤ì •ì´ê¸° ë•Œë¬¸ì— í•´ë‹¹ í´ë˜ìŠ¤ë¥¼ í”„ë¡œë•ì…˜ì— ë‚¨ìš©í•  ìˆ˜ ìˆëŠ” ê°€ëŠ¥ì„±ì´ ì¡´ì¬í•œë‹¤.</p>\n<ul>\n<li>í…ŒìŠ¤íŠ¸ ì½”ë“œì§€ë§Œ í”„ë¡œë•ì…˜ì—ë„ ì ìš©ë  ìˆ˜ ìˆëŠ” ì„¤ì •ì´ ê·¸ë‹¥ ë§ˆìŒì— ë“¤ì§„ ì•ŠëŠ”ë‹¤.</li>\n</ul>\n</li>\n</ul>\n<h3>4ï¸âƒ£ JUnit5 Extension ì‚¬ìš©í•˜ê¸°</h3>\n<p>í˜„ì¬ ì½”ë“œëŠ” AcceptenceTestë¥¼ ì‚¬ìš©í•˜ëŠ” ì½”ë“œì— ëŒ€í•´ì„œë§Œ DB ì´ˆê¸°í™”ë¥¼ ì§„í–‰í•˜ê³ ìˆë‹¤.</p>\n<p>RestAssuredê°€ ë³„ë„ì˜ ìŠ¤ë ˆë“œì—ì„œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì— ìœ„ì™€ê°™ì´ êµ¬ì„±í–ˆì§€ë§Œ ë³„ë„ì˜ í†µí•© í…ŒìŠ¤íŠ¸ì—ì„œë„ DB ì´ˆê¸°í™” ì„¤ì •ì´ í•„ìš”í•  ìˆ˜ ìˆë‹¤.</p>\n<p>@BeforeEach ë‚´ë¶€ì— clearë¥¼ ì„ ì–¸í•˜ì§€ ì•Šê³ ë„ ê°„ë‹¨í•œ ì„¤ì •ë§Œìœ¼ë¡œ DB ì´ˆê¸°í™” ë¡œì§ì„ ì ìš©í•˜ë„ë¡ ê°œì„ í•´ë³´ì.</p>\n<p>ì´ë¥¼ ìœ„í•´ JUnit5ì˜ Extensionì„ ì‚¬ìš©í•˜ì—¬ í•´ë‹¹ ì„¤ì •ì„ ë¦¬íŒ©í„°ë§í•´ë³¼ ê²ƒì´ë‹¤.</p>\n<h4>JUnit5 Extensionì´ë€?</h4>\n<p>Junit5ì—ì„œ ì œê³µí•˜ëŠ” í…ŒìŠ¤íŠ¸ì˜ ìƒëª…ì£¼ê¸°ì— ëŒ€í•´ ê°ê°ì˜ í™˜ê²½ì— ëŒ€í•´ í™•ì¥í•  ìˆ˜ ìˆë„ë¡ ì œê³µí•˜ëŠ” ì¸í„°í˜ì´ìŠ¤ë‹¤.</p>\n<p>ë‹¤ìŒê³¼ ê°™ì€ ìƒì„±ì£¼ê¸°ì— ëŒ€í•œ í™•ì¥ì„ ì œê³µí•œë‹¤.</p>\n<ul>\n<li>BeforeAllCallback - @BeforeAll ì‹¤í–‰ ì „ì— ì‹¤í–‰ëœë‹¤.</li>\n<li>BeforeEachCallback - @BeforeEach ì‹¤í–‰ ì „ì— ì‹¤í–‰ëœë‹¤.</li>\n<li>BeforeTestExecutionCallback - ê° í…ŒìŠ¤íŠ¸ê°€ ì‹¤í–‰ë˜ê¸° ì§ì „ì— ì‹¤í–‰ëœë‹¤.</li>\n<li>AfterTestExecutionCallback : ê° í…ŒìŠ¤íŠ¸ê°€ ì¢…ë£Œëœ í›„ ì‹¤í–‰ëœë‹¤.</li>\n<li>AfterEachCallback : @AfterEach ì‹¤í–‰ ì´í›„ì— ì‹¤í–‰ëœë‹¤.</li>\n<li>AfterAllCallback : @AfterAll ì‹¤í–‰ ì´í›„ì— ì‹¤í–‰ëœë‹¤.</li>\n</ul>\n<blockquote>\n<p>Referenced By <a href=\"https://ttl-blog.tistory.com/1407\">https://ttl-blog.tistory.com/1407</a></p>\n</blockquote>\n<h4>BeforeEachCallback ì´ìš©í•˜ê¸°</h4>\n<p>í˜„ì¬ <code class=\"language-text\">@BeforeEach</code>ì—ì„œ DatabaseCleanerê°€ ìˆ˜í–‰ë˜ê³  ìˆìœ¼ë¯€ë¡œ <code class=\"language-text\">@BeforeEach</code> ì´ì „ì— ì‹¤í–‰ë  ìˆ˜ ìˆë„ë¡ <code class=\"language-text\">BeforeEachCallback</code>ì„ ì´ìš©í•´ë³´ì.</p>\n<p>Extensionì„ ì´ìš©í•˜ê¸° ìœ„í•´ ê¸°ì¡´ì— DatabaseCleanerì— ë¶™ì–´ìˆë˜ <code class=\"language-text\">implements InitializingBean</code>ì€ ì œê±°í•´ì¤¬ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseCleaner</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> tableNames <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@PersistenceContext</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">EntityManager</span> entityManager<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token comment\">// ë°”ë€ë¶€ë¶„ : ì˜ì¡´ì„± ì£¼ì…ì´í›„ ì´ˆê¸°í™” ìˆ˜í–‰ ì‹œ Tableì„ ì¡°íšŒí•œë‹¤.</span>\n    <span class=\"token annotation punctuation\">@PostConstruct</span>\n    <span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unchecked\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">findDatabaseTableNames</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">List</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> tableInfos <span class=\"token operator\">=</span> entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">createNativeQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SHOW TABLES\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResultList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> tableInfo <span class=\"token operator\">:</span> tableInfos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">String</span> tableName <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> tableInfo<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            tableNames<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>tableName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">truncate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">createNativeQuery</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SET FOREIGN_KEY_CHECKS %d\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> tableName <span class=\"token operator\">:</span> tableNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">createNativeQuery</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TRUNCATE TABLE %s\"</span><span class=\"token punctuation\">,</span> tableName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">createNativeQuery</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SET FOREIGN_KEY_CHECKS %d\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">truncate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ì´í›„ <code class=\"language-text\">DatabaseClearExtension</code> í´ë˜ìŠ¤ë¥¼ ë‹¤ìŒê³¼ ê°™ì´ ìƒì„±í•´ì¤€ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseClearExtension</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">BeforeEachCallback</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ExtensionContext</span> context<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">DatabaseCleaner</span> databaseCleaner <span class=\"token operator\">=</span> <span class=\"token function\">getDataCleaner</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        databaseCleaner<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DatabaseCleaner</span> <span class=\"token function\">getDataCleaner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ExtensionContext</span> extensionContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">SpringExtension</span><span class=\"token punctuation\">.</span><span class=\"token function\">getApplicationContext</span><span class=\"token punctuation\">(</span>extensionContext<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DatabaseCleaner</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h4>ê°„ê²°í•´ì§„ í…ŒìŠ¤íŠ¸ì½”ë“œ</h4>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@ExtendWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DatabaseClearExtension</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@SpringBootTest</span><span class=\"token punctuation\">(</span>webEnvironment <span class=\"token operator\">=</span> <span class=\"token class-name\">SpringBootTest<span class=\"token punctuation\">.</span>WebEnvironment</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RANDOM_PORT</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AcceptanceTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@LocalServerPort</span>\n    <span class=\"token keyword\">int</span> port<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@BeforeEach</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">setUp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">RestAssured</span><span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> port<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>ì´ì œ <code class=\"language-text\">@ExtendWith(DatabaseClearExtension.class)</code> ì–´ë…¸í…Œì´ì…˜ë§Œ ë¶™ì—¬ì£¼ë©´ í…ŒìŠ¤íŠ¸ë³„ë¡œ DBë¥¼ ì´ˆê¸°í™”í•  ìˆ˜ ìˆë‹¤.</p>\n<p>ê° í…ŒìŠ¤íŠ¸ë³„ë¡œ truncate ë¬¸ë„ ì˜ ìˆ˜í–‰ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.\n<span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/88196dd40428e63ada6cbdf9a9d9b518/0ea77/086045e1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 130.58823529411765%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAACfklEQVR42qWVx5LiYAyE/RhDMjmazJBzThOOe5j3fw6tPpXNQC0srpmDSr8NbkvdLdlZbjayP59ls9/L/nSSQrEoqVRK0un0j8IplUpSqVSk7Ec2m/0xmAHGYjFJxOOSTCbFdV1J/6I6AxyMx9JoNiUJ2C+ALoDdXk88z7MKuUEm4PEmwgJGIxEDOH9+yun9XQ5vb3JQkSazmZw+PuSo9+bLpZTL5VBiORWtzqtWpdVuS7PVMmGKqnShUJBiqXg5I1Ymk7GHgnwXcKZv3+x2MppMrCqqiKtQsWjUsp2DaxUP4RDRTSTuA7q+GLPFQpbrtUzmc2m/vtq5NxhIfziUqd5b60sX3Ov37b/8FvB+A0j5VAXIYDSyDA0AQQHR0XtDdQNg9UZDevob+R6nzny1ku3xKGNtl0qsZW0p8vJimZYRjmsXv9Kytus+sJmTy+WU/JK1MNQKTRhVtNXpiFerSU0DwQh7SDuiq8wjURI+0XBGpfD0qt5krsfTqQVnZj2UD0f6ACR3lZ+AaFqNqqq0FrTMdShAyIV0CEcIFkU+nzf/Bbnk3wu3HHy/rbZba22tGfCzTgkW2ikNf76+zAFQ8z9TGyDkYxWCtvM6FfyQ04qyKhgTkvPzMzADxF9Yh8y08ND1NHAmm1UeTMe/LevDCwVlBNngbCAWBDZCMF623m1tSTxbEA6kE51u11SuqUj4sqF+rKoHmRoy4nF+WiFv3RwO1jZehC+m4RL+fgzOTwHhLCD85ntyLUAIMb4nRYkO8+bQgIiAsdl5qaA9Qsm//hyEBmQRsJFr9fpFBDY4wnjBWUXLhGzbCdyPTeyDrwKxCPDkTidnq9fYh9ELU+lfMu735eWYN0YAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='086045e1' title='' src='/static/88196dd40428e63ada6cbdf9a9d9b518/ca1dc/086045e1.png' srcset='/static/88196dd40428e63ada6cbdf9a9d9b518/e7570/086045e1.png 170w,\n/static/88196dd40428e63ada6cbdf9a9d9b518/f46e7/086045e1.png 340w,\n/static/88196dd40428e63ada6cbdf9a9d9b518/ca1dc/086045e1.png 680w,\n/static/88196dd40428e63ada6cbdf9a9d9b518/0ea77/086045e1.png 682w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<h2>ğŸš€ ì •ë¦¬</h2>\n<p>ë‹¤ì–‘í•œ ë°©ë²•ì„ ì‹œë„í•´ë³´ë©´ì„œ ê²°ë¡ ì ìœ¼ë¡œ BeforeEachCallbackì„ ì‚¬ìš©í•˜ëŠ” ë°©ì‹ê¹Œì§€ ì ìš©í•´ë´¤ë‹¤.\nê¹”ë”í•˜ê²Œ ì •ë¦¬ëœ í…ŒìŠ¤íŠ¸ë¥¼ ë³´ë‹ˆ ê¸°ë¶„ì´ ì¢‹ë‹¤. ğŸ‘</p>\n<h3>ìµœì¢… ì½”ë“œ</h3>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 648px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/734e673304a268069acc4801e92b549c/244f0/21f5d279.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 129.99999999999997%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAaCAYAAAC3g3x9AAAACXBIWXMAAAsTAAALEwEAmpwYAAADXUlEQVR42p1V2XbaSBTkMxIQ6kVra2eVhFgtGbBPMjPJ5NgnXuZp/v8Xam6LwYfE2HH8UOd2Q3dRfZeik6cB0osSxV+fcHdzi2o+RxRFSNMUSZK8Gfp8GIboRMqDN8mQrZfY1ZfIsgye50Ep9dvQ9zpcCAjOMHHHmCVzBJGC67pgjIFz/gOEPvsLdI4Lx3GQxAO4ftCuLctqo23b7VpHKeXbCaXgCJIp4iHlMFBtPo750TnVUZP+SmnndMPp6X6QQqUFLMqH7flwfAXb98EtG6aQMOUJ6I4Gf4lQP0kTjqMMlW+jChWqwMdM+RgKhqTfQ2IaT0i52X7u0uv4WYWkwOp38UcSYv/lGy5nIzTlBHUxwm5RYL8osZvn2C9nuF5VKEMfV6yLuTTRo7vyOaGARSq3dLCZ5mgShToJ0KQH1LFCk4VP67krccW7yInQeE4oYZt9iOUF4tsHVJaJUheD8qq6XQS9HgKjB0Ux7BuIWJ++MxEJ/kpRCDYduCSF65wUDlyCh4vUeUKduag8gcKi3iU00sCEFPbPPlkeVH6NQ3y5/hN3qwD3dYr7TYzvqwPuNgkal6HqfkBp9vC3+IiF6L+UQyoKM3FDCm/rGg+Fi4dS4S73KPptvC+8Nj7S/tvExaPdxVIYLxNKZmBN7TLbbKnKCvtViqtNimYWUaUTbKsY23mMK/p8XUa4cExMSeGzouiNKTlWToZ/VYHS4yipqSsVYEDTEVExYsM4gNbH/YD60Dlp7h8UMipI7CoUyQhSTwqZhE1R0Cwzyq/O8TEe169OCqf8DaczXH7+ijgKMRgMoGjsBCmU/7/iHF6ZZUmOY6MsfPI2Hz6RaUN4i22dJWRMYjxysG0iMswQQRC086298V2E3BRI8wCL6zF872BhGtpw30fIBEKahHKdkMKgVait/Z2EuqkN8GkDtv0HCf3XRFQY33Pph9ibCvJModAX0wzWbAGu3dn1wBwXBuXRkFbbvD+DvVoUk2aU/O7x5jN2NH57sq6NZyM3yaKMjygozmgqjqgI6sRcxc+TYpDCHY3dcrHCiAxiOswI5OBphDIfY5xEiMmyYpqOkDAWJjbkNuwsoX4WOc2Omnm7+4TFOEVNzlzPCywnA9Tk1otRhiHvYyS09ZNfksIl4ZTwP0Yo+/6QNT1iAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='21f5d279' title='' src='/static/734e673304a268069acc4801e92b549c/244f0/21f5d279.png' srcset='/static/734e673304a268069acc4801e92b549c/e7570/21f5d279.png 170w,\n/static/734e673304a268069acc4801e92b549c/f46e7/21f5d279.png 340w,\n/static/734e673304a268069acc4801e92b549c/244f0/21f5d279.png 648w' sizes='(max-width: 648px) 100vw, 648px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>íŒ¨í‚¤ì§€ êµ¬ì¡°ëŠ” ìœ„ì™€ ê°™ì´ êµ¬ì„±ë˜ì—ˆê³  ê°ê°ì˜ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token comment\">// DatabaseCleaner.java</span>\n<span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseCleaner</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">></span></span> tableNames <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">ArrayList</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token punctuation\">></span></span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@PersistenceContext</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">EntityManager</span> entityManager<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@SuppressWarnings</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"unchecked\"</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@PostConstruct</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">findDatabaseTableNames</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">List</span><span class=\"token operator\">&lt;</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">></span> tableInfos <span class=\"token operator\">=</span> entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">createNativeQuery</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SHOW TABLES\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">getResultList</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">Object</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span> tableInfo <span class=\"token operator\">:</span> tableInfos<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            <span class=\"token class-name\">String</span> tableName <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">)</span> tableInfo<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span>\n            tableNames<span class=\"token punctuation\">.</span><span class=\"token function\">add</span><span class=\"token punctuation\">(</span>tableName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">void</span> <span class=\"token function\">truncate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">createNativeQuery</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SET FOREIGN_KEY_CHECKS %d\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token keyword\">for</span> <span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span> tableName <span class=\"token operator\">:</span> tableNames<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">createNativeQuery</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"TRUNCATE TABLE %s\"</span><span class=\"token punctuation\">,</span> tableName<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token punctuation\">}</span>\n        entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">createNativeQuery</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">String</span><span class=\"token punctuation\">.</span><span class=\"token function\">format</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SET FOREIGN_KEY_CHECKS %d\"</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">executeUpdate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        entityManager<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        <span class=\"token function\">truncate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// DatabaseClearExtension.java</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">DatabaseClearExtension</span> <span class=\"token keyword\">implements</span> <span class=\"token class-name\">BeforeEachCallback</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Override</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">beforeEach</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ExtensionContext</span> context<span class=\"token punctuation\">)</span> <span class=\"token keyword\">throws</span> <span class=\"token class-name\">Exception</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">DatabaseCleaner</span> databaseCleaner <span class=\"token operator\">=</span> <span class=\"token function\">getDataCleaner</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n        databaseCleaner<span class=\"token punctuation\">.</span><span class=\"token function\">clear</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">DatabaseCleaner</span> <span class=\"token function\">getDataCleaner</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ExtensionContext</span> extensionContext<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">return</span> <span class=\"token class-name\">SpringExtension</span><span class=\"token punctuation\">.</span><span class=\"token function\">getApplicationContext</span><span class=\"token punctuation\">(</span>extensionContext<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">getBean</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DatabaseCleaner</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token comment\">// AcceptanceTest.java</span>\n<span class=\"token annotation punctuation\">@ExtendWith</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">DatabaseClearExtension</span><span class=\"token punctuation\">.</span><span class=\"token keyword\">class</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@SpringBootTest</span><span class=\"token punctuation\">(</span>webEnvironment <span class=\"token operator\">=</span> <span class=\"token class-name\">SpringBootTest<span class=\"token punctuation\">.</span>WebEnvironment</span><span class=\"token punctuation\">.</span><span class=\"token constant\">RANDOM_PORT</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">AcceptanceTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@LocalServerPort</span>\n    <span class=\"token keyword\">int</span> port<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@BeforeEach</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">setUp</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">RestAssured</span><span class=\"token punctuation\">.</span>port <span class=\"token operator\">=</span> port<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n\n<span class=\"token comment\">// DictionaryPlantApiTest.java</span>\n\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">DictionaryPlantApiTest</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AcceptanceTest</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>Reference</h2>\n<p><a href=\"https://ttl-blog.tistory.com/1407\">https://ttl-blog.tistory.com/1407</a>\n<a href=\"https://mangkyu.tistory.com/264\">https://mangkyu.tistory.com/264</a>\n<a href=\"https://stackoverflow.com/questions/41763417/api-test-transactional-rollback\">https://stackoverflow.com/questions/41763417/api-test-transactional-rollback</a>\n<a href=\"https://stackoverflow.com/questions/62142428/dirtiescontext-does-not-work-with-nested-tests\">https://stackoverflow.com/questions/62142428/dirtiescontext-does-not-work-with-nested-tests</a>\n<a href=\"https://unluckyjung.github.io/testcode/2021/05/08/Independent-Test-Mehod/\">https://unluckyjung.github.io/testcode/2021/05/08/Independent-Test-Mehod/</a>\n<a href=\"https://www.baeldung.com/junit-5-extensions\">https://www.baeldung.com/junit-5-extensions</a></p>","frontmatter":{"title":"ì¸ìˆ˜í…ŒìŠ¤íŠ¸ ë°ì´í„° ì´ˆê¸°í™”í•˜ê¸°","date":"August 03, 2023","update":"August 03, 2023","tags":["ì¸ìˆ˜í…ŒìŠ¤íŠ¸","RestDocs","í…ŒìŠ¤íŠ¸"],"series":null},"fields":{"slug":"/acceptance-test-resolve/","readingTime":{"minutes":13.81}}},"seriesList":{"edges":[{"node":{"id":"28f1d87e-d3fc-5567-8531-57649652864f","fields":{"slug":"/sprint-idea/"},"frontmatter":{"title":"êµ¬ê¸€ ìŠ¤í”„ë¦°íŠ¸ ê¸°ë°˜ ì•„ì´ë””ì–´ ë„ì¶œ"}}},{"node":{"id":"4a9246fb-171b-5973-88fc-864034e78afd","fields":{"slug":"/blog-starter/"},"frontmatter":{"title":"í”¼ì›€ ë¸”ë¡œê·¸ ìƒì„±ê³¼ì •"}}},{"node":{"id":"a387bf4f-567f-50e7-b6a7-99a1a1c8971b","fields":{"slug":"/jpa-notnull-nullable/"},"frontmatter":{"title":"@NotNullê³¼ nullable = falseëŠ” ì–´ë–¤ ì°¨ì´ê°€ ìˆì„ê¹Œ?"}}},{"node":{"id":"c826ce0e-1ea7-517c-8d19-84e90a59a798","fields":{"slug":"/jenkins-setting/"},"frontmatter":{"title":"ì  í‚¨ìŠ¤ ì„¤ì¹˜í•˜ê¸°"}}},{"node":{"id":"a78e224b-b711-5071-8e90-013d6f4bebc3","fields":{"slug":"/pium-deploy-step/"},"frontmatter":{"title":"í”¼ì›€ì˜ ë°°í¬ê³¼ì •"}}},{"node":{"id":"ce07fbab-1ed5-5f1e-8e2f-eb430879b56a","fields":{"slug":"/fe-tanstack-query/"},"frontmatter":{"title":"í”„ë¡ íŠ¸ì—”ë“œ: Tanstack Query ì‚¬ìš©ì— ëŒ€í•˜ì—¬"}}},{"node":{"id":"159c943b-1a50-57dd-aa71-7557364752a5","fields":{"slug":"/ci-cd-setting/"},"frontmatter":{"title":"Jenkinsì™€ Github Webhookì„ ì´ìš©í•´ CI/CD êµ¬ì¶•í•˜ê¸°"}}},{"node":{"id":"dea45a4a-bfde-5fbb-8a97-42d3a3e77a0b","fields":{"slug":"/jenkins-hook-by-label/"},"frontmatter":{"title":"PR ë¼ë²¨ë¡œ ì  í‚¨ìŠ¤ ë¹Œë“œìœ ë°œì„ êµ¬ë¶„í•˜ê¸°"}}},{"node":{"id":"cecbc8b9-db00-562b-aa0b-06c406cfc44a","fields":{"slug":"/bundle-analyze/"},"frontmatter":{"title":"bundle-analyzeë¥¼ í†µí•œ bundle í¬ê¸° ë¶„ì„"}}},{"node":{"id":"1a03734e-d413-553f-9152-1dad2fc4acca","fields":{"slug":"/apply-https/"},"frontmatter":{"title":"ë‚´ ì„œë²„ì— HTTPS ì„¤ì •í•˜ê¸°"}}},{"node":{"id":"707f8ffb-1409-5c27-b15a-5661b235c226","fields":{"slug":"/db-drop-stop/"},"frontmatter":{"title":"Table Drop ëª»í•˜ê²Œ ë§‰ì•„ë²„ë¦¬ê¸°"}}},{"node":{"id":"fe4b591a-4dd5-5dd2-b18a-b318afd1e9e3","fields":{"slug":"/transactional-not-in-restassured/"},"frontmatter":{"title":"[íŠ¸ëŸ¬ë¸”ìŠˆíŒ…] @SpringbootTestì˜ RANDOM_PORT í™˜ê²½ì—ì„œ @Transactional ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í–ˆì„ ë•Œ, RestAssured GET ìš”ì²­ì´ ìˆ˜í–‰ë˜ì§€ ì•ŠëŠ” ê²½ìš°(íŠ¸ëœì­ì…˜ ê²©ë¦¬ ì´í•´í•˜ê¸°)"}}},{"node":{"id":"80aa708e-ef8a-5c79-9644-cb8c04d55a63","fields":{"slug":"/acceptance-test-resolve/"},"frontmatter":{"title":"ì¸ìˆ˜í…ŒìŠ¤íŠ¸ ë°ì´í„° ì´ˆê¸°í™”í•˜ê¸°"}}},{"node":{"id":"15def1d5-c20f-5d07-b46e-24a14661365f","fields":{"slug":"/react-setting-without-cra/"},"frontmatter":{"title":"webpackìœ¼ë¡œë§Œ React ì„¤ì •í•˜ê¸° (without CRA)"}}},{"node":{"id":"66383c86-e2c8-533a-90e0-2effae572742","fields":{"slug":"/stylelint-and-husky/"},"frontmatter":{"title":"stylelintì™€ huskyë¥¼ í†µí•´ ì»¨ë²¤ì…˜ í†µì¼í•˜ê¸°"}}},{"node":{"id":"ed5951d5-beda-5a8f-adb2-07c2fcb38d5e","fields":{"slug":"/OAuth2.0/"},"frontmatter":{"title":"ë‚´ê°€ ì´í•´í•œ OAuth2.0"}}},{"node":{"id":"45eeb9a3-557d-5704-8fd9-925283e1e27b","fields":{"slug":"/restdocs-start/"},"frontmatter":{"title":"RestDocsë¡œ API ë¬¸ì„œí™”í•˜ê¸°"}}}]},"previous":{"fields":{"slug":"/transactional-not-in-restassured/"},"frontmatter":{"title":"[íŠ¸ëŸ¬ë¸”ìŠˆíŒ…] @SpringbootTestì˜ RANDOM_PORT í™˜ê²½ì—ì„œ @Transactional ì–´ë…¸í…Œì´ì…˜ì„ ì‚¬ìš©í–ˆì„ ë•Œ, RestAssured GET ìš”ì²­ì´ ìˆ˜í–‰ë˜ì§€ ì•ŠëŠ” ê²½ìš°(íŠ¸ëœì­ì…˜ ê²©ë¦¬ ì´í•´í•˜ê¸°)"}},"next":{"fields":{"slug":"/react-setting-without-cra/"},"frontmatter":{"title":"webpackìœ¼ë¡œë§Œ React ì„¤ì •í•˜ê¸° (without CRA)"}}},"pageContext":{"id":"80aa708e-ef8a-5c79-9644-cb8c04d55a63","series":null,"previousPostId":"fe4b591a-4dd5-5dd2-b18a-b318afd1e9e3","nextPostId":"15def1d5-c20f-5d07-b46e-24a14661365f"}},"staticQueryHashes":[],"slicesMap":{}}