{"componentChunkName":"component---src-templates-post-jsx","path":"/http-cache/","result":{"data":{"site":{"siteMetadata":{"title":"pium.log"}},"markdownRemark":{"id":"eafed74f-ff11-5af1-a589-e9dd2ccb5c8e","excerpt":"이 글은 우아한테크코스 5기, 피움팀 크루 '쵸파'가 작성했습니다. 서론 피움 서비스는 기존에 EC2 + Nginx로 FE 정적 파일 서빙과 백엔드 API 응답을 하나의 EC2에서 하고 있었습니다. 백엔드와의 관심사 분리를 위해 EC2에서 S3로 FE 정적 파일을 옮기고,\n보안과 CDN 캐시를 적용하기 위해 CloudFront를 통해 배포하였습니다. 더 …","html":"<blockquote>\n<p>이 글은 우아한테크코스 5기, 피움팀 크루 '<a href=\"https://github.com/bassyu\">쵸파</a>'가 작성했습니다.</p>\n</blockquote>\n<h2>서론</h2>\n<p>피움 서비스는 기존에 EC2 + Nginx로 FE 정적 파일 서빙과 백엔드 API 응답을 하나의 EC2에서 하고 있었습니다.</p>\n<p>백엔드와의 <strong>관심사 분리</strong>를 위해 EC2에서 <strong>S3</strong>로 FE 정적 파일을 옮기고,\n<strong>보안과 CDN 캐시</strong>를 적용하기 위해 <strong>CloudFront</strong>를 통해 배포하였습니다.</p>\n<p>더 나아가서, 같은 리소스는 더 빠르게 접근하고 네트워크 트래픽을 줄이기 위해 <strong>HTTP 캐시</strong>를 적용했습니다.</p>\n<p>해당 과정을 어떻게 적용하였는지 공유하고자 합니다.</p>\n<h2>S3 + CloudFront 배포</h2>\n<p>이미 S3와 CloudFront로 배포하는 방법은 <a href=\"https://blog.pium.life/aws-s3-apply/\">피움 블로그</a>에 잘 기록되어 있습니다!\n이외의 프론트엔드 배포를 위한 차이점만 다루었습니다.</p>\n<h3>S3 업로드 자동화 하기</h3>\n<h4>aws cli 설치</h4>\n<p>가장 좋은 방법은 <a href=\"https://docs.aws.amazon.com/ko_kr/cli/latest/userguide/getting-started-install.html\">공식 문서의 설치 방법</a>을 그대로 따라 하는 것이었습니다.\n피움의 빌드 EC2 환경은 Linux ARM 이어서 해당 명령어를 그대로 따라 해 설치했습니다.</p>\n<h4>파이프라인 구성</h4>\n<p>아래의 명령어는 빌드 후 dist 폴더의 파일들을 S3 버킷에 동기화하는(옮기는) 명령어입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">aws s3 sync ./dist s3://{프로젝트 S3 버킷 경로} --delete</code></pre></div>\n<p>이 1줄만 젠킨스 파이프라인에서 실행하면 됩니다.</p>\n<h4>빌드 EC2에 권한 주기</h4>\n<p>이때, 빌드 EC2에서 S3에 업로드할 수 있도록 권한을 줘야 합니다.\n인스턴스 > 작업 > 보안 > IAM역할 수정\n에서 권한을 줄 수 있습니다.</p>\n<h3>CloudFront</h3>\n<h4>오류 페이지</h4>\n<p>SPA로 정적 페이지를 배포하면 최상위뿐만 아니라 다른 path로 이동할 때가 많습니다.\n다른 path에 접근하더라도 index.html을 받을 수 있도록 오류 페이지를 설정해 줍니다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/5f98c07b753b77ef35dae3e9779697bd/9d567/1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 38.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABnUlEQVR42j1Ry47UMBDM/3Fl+RY+BWnhyAU4wE9w4SEusxLLaGc3k8dMEjuxHT8SO1N0e1haasXudFdXlYuqbiDGEceqhpwmlMcKyhjc1RK7SkLPJv+73z9AyBFNe0JZHjGIgc4NjNHQWl2T5goG0fOMXogM3A8CzfmM34cyZ3vuMEiZv5L+87nTASoAo9tgVkAvgKKczIzi3HWoiaXSGj4E+GWBdQ7OWlg757P1HuFf3fuAsP8M8e0Nxp/vIH7cQny/hf71Fk61KO7/7LHb3WGk7RxxXZFiRNoStm1DSgmzdbnOoGtMiF9fo3z/AvXHV2g+3aD6cIPpy0usco+CQaZJ4fHxCQ+HA/kk830gC+qmxUAWOGKmlMpe1nWLXiqENcFYj1MvcOoE2eZhZosiEhs2kyU757EQixhXkmvznVkxS7aDl4zjRLId1SI9iKHH0HnhygrCguJyuTKcCZ3jwgUKQwaz5Ofggaqq0NIrM4mrsikv/t9D9cyQhy35lAggEpuNkhu5gdlt5Gcghn0/QJIlC4HzYmb3PMd9rOYvslReAT0ajTgAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='error_page' title='' src='/static/5f98c07b753b77ef35dae3e9779697bd/ca1dc/1.png' srcset='/static/5f98c07b753b77ef35dae3e9779697bd/e7570/1.png 170w,\n/static/5f98c07b753b77ef35dae3e9779697bd/f46e7/1.png 340w,\n/static/5f98c07b753b77ef35dae3e9779697bd/ca1dc/1.png 680w,\n/static/5f98c07b753b77ef35dae3e9779697bd/02d09/1.png 1020w,\n/static/5f98c07b753b77ef35dae3e9779697bd/9d567/1.png 1360w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>error_page</figcaption>\n  </figure></p>\n<h2>HTTP 캐시를 위한 응답 헤더 정책</h2>\n<p>FE 배포는 성공적으로 마무리되었습니다.\n이제 더 나은 사용자 경험을 위해 <strong>HTTP 캐시</strong>를 적용하고자 합니다.</p>\n<h3>HTTP 캐시를 적용하는 이유</h3>\n<p>똑같은 리소스는 웹페이지에 들어갈 때마다 새로 요청할 필요가 없습니다.\n디스크에 저장해 두었다가 새로운 버전만 요청하면 훨씬 더 빠르지 않을까요?\n네트워크 통신 비용도 크게 줄일 수 있습니다.</p>\n<p><a href=\"https://developer.mozilla.org/ko/docs/Web/HTTP/Caching\">HTTP 캐시</a>를 활용하면 같은 리소스는 네트워크를 거치지 않고 디스크나 메모리에서 바로 사용할 수 있습니다!</p>\n<h3>Cache-Control 헤더</h3>\n<p>리소스 <strong>응답 헤더의 Cache-Control 필드</strong>를 통해 HTTP캐시를 설정할 수 있습니다.\n그중 Cache-Control: \"max-age=<second>\" 값으로 몇 초간 캐시 할지 설정할 수 있습니다.</p>\n<p>피움 서비스에서는 '같은 리소스에 대해 한 달은 캐싱한다'는 정책을 주기 위해 아래와 같이 CloudFront의 응답 헤더 정책을 만들었습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/3729943c9ba25c16c2b9860332ff06c0/eb638/2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 22.352941176470587%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAnklEQVR42oWP2Q7CIBRE+f/Pa4320aXRlhY1TdkuywjEVuuLNzkBhskwsJ5zVFWNQ9Og3u3BnzOstX8hItCPprUGk0phlhIqHaRU0IbgnFvx3sOHUNZvnRI2h9LHb4wBm0uIQYyxsEzea202wct45zGMAkI8ENJjq548bJomdF1fUKlteLfJCHHH9dbh0rbgfFjvcpPj6ZxCx40/f/sFStU2yuhlzdAAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='2' title='' src='/static/3729943c9ba25c16c2b9860332ff06c0/ca1dc/2.png' srcset='/static/3729943c9ba25c16c2b9860332ff06c0/e7570/2.png 170w,\n/static/3729943c9ba25c16c2b9860332ff06c0/f46e7/2.png 340w,\n/static/3729943c9ba25c16c2b9860332ff06c0/ca1dc/2.png 680w,\n/static/3729943c9ba25c16c2b9860332ff06c0/02d09/2.png 1020w,\n/static/3729943c9ba25c16c2b9860332ff06c0/9d567/2.png 1360w,\n/static/3729943c9ba25c16c2b9860332ff06c0/eb638/2.png 1422w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>그리고 동작에 추가합니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/587b8c13d9dd6575bdaec5fefb316887/69083/3.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 22.352941176470587%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAoklEQVR42o3P2w6DIBBFUf//G1svYEVAe5FWQdRd9LkxnWRl3s6cyZRqqYRAyBrVaspK4NybuCyEEA7btvHvZMZaZH2j1YYmhdc3hTY27QaZaNPhfSDGeCrMM5P3ZLbruVxz8rygLCu01pgU3qa2u3Gajstraryu60/7B/snw+DI1PNDaV4UZkD2b+rHhHp55H1EJOo5UnWO3LrUIjKfiHHhC6fONAXwg2aIAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='3' title='' src='/static/587b8c13d9dd6575bdaec5fefb316887/ca1dc/3.png' srcset='/static/587b8c13d9dd6575bdaec5fefb316887/e7570/3.png 170w,\n/static/587b8c13d9dd6575bdaec5fefb316887/f46e7/3.png 340w,\n/static/587b8c13d9dd6575bdaec5fefb316887/ca1dc/3.png 680w,\n/static/587b8c13d9dd6575bdaec5fefb316887/02d09/3.png 1020w,\n/static/587b8c13d9dd6575bdaec5fefb316887/69083/3.png 1158w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>이제 CDN이 보내주는 리소스 헤더에 Cach-Control이 더해져서 HTTP 캐시가 적용됩니다! 🎉</p>\n<h3>캐시 버스팅</h3>\n<p>클라이언트는 설정해 준 시간이 지나지 않으면 동일한 URL의 GET 요청에는 항상 캐시가 적용됩니다.\n새로운 버전이 업데이트되면 원래의 캐시를 어떻게 지울까요?</p>\n<p>피움은 <strong>새로운 버전의 URL이 바뀔 수 있도록 번들에 해시</strong>를 줘서 캐시 버스팅을 적용했습니다.</p>\n<p>아래는 번들 파일에 해시를 주는 webpack.config 설정입니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">// webpack.config.js\n\noutput: {\n  path: path.join(__dirname, 'dist'),\n  filename: '[name].[contenthash].bundle.js',\n  chunkFilename: '[name].[chunkhash].chunk.bundle.js',\n}</code></pre></div>\n<p>이후 빌드된 번들에 해시가 들어간 모습입니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 512px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/3f48d51bfe664acf174d6e396c9b72b8/06341/4.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 38.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABhElEQVR42pVQyUrEQBSMnvwAFxSXmDiTdMcsk6SzJzOjDipuiCjuoAfnIoIn0Ys3T/rNZb8eFU+Ch6Lqhfeqq6JN9IaYX7/D0/AV/PgZGw/vmNt9hCauMV7cYCz/H7SZdB+zyQG2D8+Q7J3AHlxgqT7CVLKHaYnJeBeT4hfiPzjegeYwC23bw+0Rx8fLJhw3RF0W6DcNvFUHpq5jxTAkltGSTGib5o/+gWnAaq1AY4xhybCx1bNxdeigzQKEUQTPCxBFAkHQkRwjDCN0OqGcQ7iuD9/vIKD565vn+bAsGxpnNhZ0hvMdA4+XujSMUMqEQiRomq7UpeQGVVUrXZYViqKQGOk0zZDnBbIsU6aazTgsU4dVHcBaO0focrmUq1Sjg1Qd5HmujpMkVWnpQTKhmUD7nDvfhgZYNoA7OAW3WvIgVlVpUQihTMlgBDLIEMdCYrRHmh5xXU9W5jbmFhmGxybe7pfR5rJqXal0ZEDpqC4dU81+fw11XStNv4L2ut2eYt8P8AlNNQNxRb5xqgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='4' title='' src='/static/3f48d51bfe664acf174d6e396c9b72b8/06341/4.png' srcset='/static/3f48d51bfe664acf174d6e396c9b72b8/e7570/4.png 170w,\n/static/3f48d51bfe664acf174d6e396c9b72b8/f46e7/4.png 340w,\n/static/3f48d51bfe664acf174d6e396c9b72b8/06341/4.png 512w' sizes='(max-width: 512px) 100vw, 512px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>그런데 webpack.config를 자세히 보면 chunkhash와 contenthash가 있는 것을 알 수 있습니다.\n둘은 어떤 차이일까요?</p>\n<h4>webpack 해시의 종류</h4>\n<p>우선 하나의 엔트리 포인트에서 나온 파일들을 청크라고 부릅니다.\nwebpack 설정으로 청크를 어떻게 나눌지는 커스텀할 수 있습니다.</p>\n<p>chunkhash는 청크를 기준으로 해시값을 주고, contenthash는 청크가 같더라도 각 파일의 내용을 기준으로 해시값을 줍니다.</p>\n<p>만약 하나의 청크에 하나의 파일이 나온다면 chunkhash를 줘도 무방합니다.\n하나의 청크에서 .js .css 처럼 여러 파일이 나온다면 contenthash로 더욱 뾰족하게 해싱할 수 있습니다.</p>\n<h3>index.html은 예외</h3>\n<p>index.html 파일은 해시를 주면 안됩니다.\n유저가 저희의 서비스를 들어올 때 'www.pium.life/index.hash.html'이런 식으로 요청하지 않기 때문입니다.</p>\n<p>다른 리소스와는 달리 파일이 신선하지 않음을 URL로 판단하기 힘들기 때문에\nCloudFront의 동작으로 예외처리해서 해결했습니다.</p>\n<h4>새로운 동작 생성</h4>\n<p>index.html을 위한 동작을 위해 경로 패턴에 '/index.html'을 적어줍니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/daf0356cb6fe61c361ccfb626936443b/64756/5.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 47.64705882352941%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA1ElEQVR42q3SSXKDMBAFUN3/ZE4WHjdxCB4KE+yABEIMag3+6fgGQBaveqWuX/0ltrs9Vm/v2O0PMF2H1phFxHdR4OP4ifR0/p+FUkr4EOC9h7V2MbHebGGJ4JxbjJgInIzIgnhGTvqMcbbIRHK6oiglck2wPsKF5yzEb/+I5F7jkGbYHM9I8hIPQ5NVvcfXvUH6o7nlUuH2qJAz3fNhA9C7MAtxUnG5XJFlGbtBceMdf50Q/CQxBozj8OpCqEajaVvUWqNSClLVr7amcFxoazoMw4hfJ48F3ZE6Q40AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='5' title='' src='/static/daf0356cb6fe61c361ccfb626936443b/ca1dc/5.png' srcset='/static/daf0356cb6fe61c361ccfb626936443b/e7570/5.png 170w,\n/static/daf0356cb6fe61c361ccfb626936443b/f46e7/5.png 340w,\n/static/daf0356cb6fe61c361ccfb626936443b/ca1dc/5.png 680w,\n/static/daf0356cb6fe61c361ccfb626936443b/02d09/5.png 1020w,\n/static/daf0356cb6fe61c361ccfb626936443b/64756/5.png 1200w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>캐시 정책은 CachingDisabled를 사용합니다.\n그리고 응답 헤더 정책은 주지 않습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/8cb1e8730f62dd45ab74fc633f16d8dc/af70e/6.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 41.76470588235294%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAABYlAAAWJQFJUiTwAAABCklEQVR42p1Ry26DQAzk//+r7TFCVdsLoSFJJSA89s3CAtO1SdVLyaGWRt61YeyZTbI8x9v7B9L0FU/PLzgcUpRVhXGaMAweg/ew1sE6B+e2TPV1XfFXJD42ldaQSkNFSKniWcEYw0TGWu5RXWsDce8ve4RX4dH2En3fQwjBue06tG2LptnQ8b1DXdfoYv9RJI00yD9PKIoCxyg/y458dneJPyCZWx4eE4YQWB59vK4LlmXDfyPxfsTl+oVTcWa/jLHsHflFXvVCQsfaPP8O2wM9FG94uzVMytLPF1izvaZiUs2DwhQQwryLcZxAyyV0KcuKNyQyIq7iANqQJ8fN5pl+CrugvovekrpvEftrfZT8c/YAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='6' title='' src='/static/8cb1e8730f62dd45ab74fc633f16d8dc/ca1dc/6.png' srcset='/static/8cb1e8730f62dd45ab74fc633f16d8dc/e7570/6.png 170w,\n/static/8cb1e8730f62dd45ab74fc633f16d8dc/f46e7/6.png 340w,\n/static/8cb1e8730f62dd45ab74fc633f16d8dc/ca1dc/6.png 680w,\n/static/8cb1e8730f62dd45ab74fc633f16d8dc/02d09/6.png 1020w,\n/static/8cb1e8730f62dd45ab74fc633f16d8dc/af70e/6.png 1184w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>완성된 모습입니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/1b4637919ace76ee198291e378358d80/39d99/7.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 52.352941176470594%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABhUlEQVR42m1SCY7bMAz0/79XYFGgBdIkTmzLsnzLZzKdYeLtYlECA4kUjyGp5J7nuGc5qrrGOU1RVh4/fp/x65zCh4A/l6vBhxquqnC+pqZX1DPncLpcEJoGyuO8RzLNM4R+HO1sux51HYga3fCyCQPfhxg/9ZH38a0PY0ScIt9HJKfTCR8fP/F8PrFtGx6PnXgSD+z7jp22dV3tbXvfl2VlscH0aZrQdB06FpSeNKTrfYWBDn3/Bll2RCtHnjFODJw/EZlEjGUXy56xptOeKKBkQsH7gCx3BulF6XG7ZxjZkljN8/IPy4LVWO9vbOaTLHpgGwPnFbiEkZWkN02LqgoWvK4L5PcdNbsLdcN5vyCWyTGfpm1xud7Qtp0lyfIC1/RmLW7bakW+YuYy8sJZB9pwertbrDHU8BWoRUi0ILEtioJwpn+HRAlyFtZIjjgy3LAz0cKqOuUqBP4zJdOsDttXSDR/V5ZcTjTbwxLaV3l9kaOyRDMsuZSD9f+k75nQlbbdQ/4CPagEiTgQb5EAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='7' title='' src='/static/1b4637919ace76ee198291e378358d80/ca1dc/7.png' srcset='/static/1b4637919ace76ee198291e378358d80/e7570/7.png 170w,\n/static/1b4637919ace76ee198291e378358d80/f46e7/7.png 340w,\n/static/1b4637919ace76ee198291e378358d80/ca1dc/7.png 680w,\n/static/1b4637919ace76ee198291e378358d80/02d09/7.png 1020w,\n/static/1b4637919ace76ee198291e378358d80/39d99/7.png 1102w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>이제 index.html도 최신 버전으로 잘 받아옵니다. 🎉🎉</p>\n<h4>s-maxage + 무효화</h4>\n<p>HTML에 캐시를 안주는 방법만 있는 것은 아닙니다.\n응답 헤더 정책에서 Cache-Control의 s-maxage를 통해 CDN에서만 캐싱을 적용하고, 배포할 때 무효화를 해줄 수 있습니다.</p>\n<p>다만 무효화를 자동으로 하기 위해서는 추가적인 IAM 권한이 필요하고, 속도 차이가 크지 않음을 확인해서 아직 적용하지 않았습니다.</p>\n<h3>HTTP 캐시를 한 달로 설정한 이유</h3>\n<p>설정을 한 달로 하면 한달 후에는 같은 리소스도 다시 검증해야합니다.\n왜 캐싱하는 시간을 최댓값인 1년으로 하지 않았을까요?</p>\n<p>HTTP 캐시는 사용자의 디스크나 메모리에 리소스를 저장합니다.\n만약 max-age를 최댓값인 1년으로 설정하면 새로운 버전의 해시가 배포되어도 사용자는 이전 버전의 리소스를 1년간 가지고 있게 됩니다.</p>\n<p>그래서 서비스 배포 주기에 맞는 적절한 기간을 논의하여 한 달로 설정하였습니다.\n소중한 고객님이 불필요한 리소스를 1년간 저장할 필요는 없으니까요!</p>\n<h2>정리</h2>\n<p>HTTP 캐시는 처음 접해보는 분야이고 index.html은 예외를 줘야 한다는 점이 흥미로웠습니다!\n캐시 기간도 길다고 무조건 좋은 게 아니었습니다.\n결과적으로 네트워크 트래픽을 줄이고 더 빠른 사용자 경험을 줄 수 있어서 뿌듯한 경험이 되었습니다.</p>\n<h3>참고한 자료</h3>\n<p><a href=\"https://toss.tech/article/smart-web-service-cache\">웹 서비스 캐시 똑똑하게 다루기</a></p>","frontmatter":{"title":"CloudFront와 HTTP 캐시","date":"September 21, 2023","update":"September 21, 2023","tags":["CloudFront","HTTP Cache"],"series":null},"fields":{"slug":"/http-cache/","readingTime":{"minutes":9.155}}},"seriesList":{"edges":[{"node":{"id":"28f1d87e-d3fc-5567-8531-57649652864f","fields":{"slug":"/sprint-idea/"},"frontmatter":{"title":"구글 스프린트 기반 아이디어 도출"}}},{"node":{"id":"4a9246fb-171b-5973-88fc-864034e78afd","fields":{"slug":"/blog-starter/"},"frontmatter":{"title":"피움 블로그 생성과정"}}},{"node":{"id":"c826ce0e-1ea7-517c-8d19-84e90a59a798","fields":{"slug":"/jenkins-setting/"},"frontmatter":{"title":"젠킨스 설치하기"}}},{"node":{"id":"a387bf4f-567f-50e7-b6a7-99a1a1c8971b","fields":{"slug":"/jpa-notnull-nullable/"},"frontmatter":{"title":"@NotNull과 nullable = false는 어떤 차이가 있을까?"}}},{"node":{"id":"a78e224b-b711-5071-8e90-013d6f4bebc3","fields":{"slug":"/pium-deploy-step/"},"frontmatter":{"title":"피움의 배포과정"}}},{"node":{"id":"ce07fbab-1ed5-5f1e-8e2f-eb430879b56a","fields":{"slug":"/fe-tanstack-query/"},"frontmatter":{"title":"프론트엔드: Tanstack Query 사용에 대하여"}}},{"node":{"id":"159c943b-1a50-57dd-aa71-7557364752a5","fields":{"slug":"/ci-cd-setting/"},"frontmatter":{"title":"Jenkins와 Github Webhook을 이용해 CI/CD 구축하기"}}},{"node":{"id":"dea45a4a-bfde-5fbb-8a97-42d3a3e77a0b","fields":{"slug":"/jenkins-hook-by-label/"},"frontmatter":{"title":"PR 라벨로 젠킨스 빌드유발을 구분하기"}}},{"node":{"id":"1a03734e-d413-553f-9152-1dad2fc4acca","fields":{"slug":"/apply-https/"},"frontmatter":{"title":"내 서버에 HTTPS 설정하기"}}},{"node":{"id":"cecbc8b9-db00-562b-aa0b-06c406cfc44a","fields":{"slug":"/bundle-analyze/"},"frontmatter":{"title":"bundle-analyze를 통한 bundle 크기 분석"}}},{"node":{"id":"707f8ffb-1409-5c27-b15a-5661b235c226","fields":{"slug":"/db-drop-stop/"},"frontmatter":{"title":"Table Drop 못하게 막아버리기"}}},{"node":{"id":"fe4b591a-4dd5-5dd2-b18a-b318afd1e9e3","fields":{"slug":"/transactional-not-in-restassured/"},"frontmatter":{"title":"[트러블슈팅] @SpringbootTest의 RANDOM_PORT 환경에서 @Transactional 어노테이션을 사용했을 때, RestAssured GET 요청이 수행되지 않는 경우(트랜잭션 격리 이해하기)"}}},{"node":{"id":"80aa708e-ef8a-5c79-9644-cb8c04d55a63","fields":{"slug":"/acceptance-test-resolve/"},"frontmatter":{"title":"인수테스트 데이터 초기화하기"}}},{"node":{"id":"15def1d5-c20f-5d07-b46e-24a14661365f","fields":{"slug":"/react-setting-without-cra/"},"frontmatter":{"title":"webpack으로만 React 설정하기 (without CRA)"}}},{"node":{"id":"66383c86-e2c8-533a-90e0-2effae572742","fields":{"slug":"/stylelint-and-husky/"},"frontmatter":{"title":"stylelint와 husky를 통해 컨벤션 통일하기"}}},{"node":{"id":"ed5951d5-beda-5a8f-adb2-07c2fcb38d5e","fields":{"slug":"/OAuth2.0/"},"frontmatter":{"title":"내가 이해한 OAuth2.0"}}},{"node":{"id":"45eeb9a3-557d-5704-8fd9-925283e1e27b","fields":{"slug":"/restdocs-start/"},"frontmatter":{"title":"RestDocs로 API 문서화하기"}}},{"node":{"id":"663b560a-734d-51a9-a6dc-3c4f50716c74","fields":{"slug":"/spring-event-apply/"},"frontmatter":{"title":"Spring Event 적용하기"}}},{"node":{"id":"503e9e71-eda3-53d7-8142-7c309faf213e","fields":{"slug":"/why_we_applied_querydsl/"},"frontmatter":{"title":"피움 서비스의 Querydsl 도입 이유"}}},{"node":{"id":"55ae8038-3f65-5a59-8db3-c7405e7fc125","fields":{"slug":"/github-actions-cypress/"},"frontmatter":{"title":"피움 Cypress 자동화 구축기"}}},{"node":{"id":"5c865dcb-cefd-58be-8968-b5edf6c8080c","fields":{"slug":"/server-logging/"},"frontmatter":{"title":"Logback을 이용해 운영 환경 별 로그 남기기"}}},{"node":{"id":"709124d0-5b05-5530-804d-e90ec9856a13","fields":{"slug":"/querydsl_apply_procedure/"},"frontmatter":{"title":"피움 서비스의 Querydsl 적용 과정"}}},{"node":{"id":"8269f166-d041-533c-9d44-332d8d8c3dca","fields":{"slug":"/server-monitoring/"},"frontmatter":{"title":"CloudWatch를 이용한 모니터링 환경 구성"}}},{"node":{"id":"0faec7ad-3bd1-5f5e-9222-115f771df8ed","fields":{"slug":"/tanstack-query-cache-trouble-shooting/"},"frontmatter":{"title":"InfinityQuery에서 fetch가 제대로 이루어지지 않는다?!?!"}}},{"node":{"id":"c77f7199-7fc6-53a3-a1fb-0792e05655a7","fields":{"slug":"/OAuth2.0-backend/"},"frontmatter":{"title":"OAuth 2.0 로그인 구현하기 (카카오)"}}},{"node":{"id":"12e4480d-386b-5d0e-bd69-4209fed36066","fields":{"slug":"/OAuth-test-backend/"},"frontmatter":{"title":"외부 API 를 의존하는 OAuth 로그인 테스트하기"}}},{"node":{"id":"ff40e109-cc92-5d83-a213-ca9d07136d95","fields":{"slug":"/aws-s3-apply/"},"frontmatter":{"title":"AWS S3로 정적 이미지 배포하기"}}},{"node":{"id":"e343af80-72dd-5173-bbb5-5069a17d1200","fields":{"slug":"/search_in_spring_data_jpa/"},"frontmatter":{"title":"Spring Data Jpa를 활용한 검색 기능 개발하기"}}},{"node":{"id":"af344dd8-ea77-5fde-9452-a97952ce60be","fields":{"slug":"/submodule-apply/"},"frontmatter":{"title":"Git submodule을 이용한 민감정보 관리"}}},{"node":{"id":"08c9daf0-2344-52a9-8c68-31ac04c24ff0","fields":{"slug":"/tomcat-thread-config/"},"frontmatter":{"title":"톰캣 스레드 설정하기"}}},{"node":{"id":"eafed74f-ff11-5af1-a589-e9dd2ccb5c8e","fields":{"slug":"/http-cache/"},"frontmatter":{"title":"CloudFront와 HTTP 캐시"}}},{"node":{"id":"dbe47289-01f4-571d-9506-fbb92016f547","fields":{"slug":"/optimize-frontend/"},"frontmatter":{"title":"피움 최적화하기"}}},{"node":{"id":"7b830fe6-e2df-564a-926e-7f7800380336","fields":{"slug":"/query-analysis/"},"frontmatter":{"title":"서비스 내에서 발생하는 쿼리를 분석하고 개선하기"}}},{"node":{"id":"37437d15-a63e-52ef-b031-6ee1bc6fa8bc","fields":{"slug":"/image-resize/"},"frontmatter":{"title":"서버에서 이미지 리사이징하기"}}},{"node":{"id":"216f4636-4125-5765-83d8-a6a610692a41","fields":{"slug":"/dont-stop-deploy/"},"frontmatter":{"title":"무중단 배포 환경 구성하기"}}},{"node":{"id":"dd095976-5a96-51b5-9686-8956dc60cd24","fields":{"slug":"/hikaricp-connection-pool-setting/"},"frontmatter":{"title":"HikariCp Connection Pool 값 설정"}}}]},"previous":{"fields":{"slug":"/tomcat-thread-config/"},"frontmatter":{"title":"톰캣 스레드 설정하기"}},"next":{"fields":{"slug":"/optimize-frontend/"},"frontmatter":{"title":"피움 최적화하기"}}},"pageContext":{"id":"eafed74f-ff11-5af1-a589-e9dd2ccb5c8e","series":null,"previousPostId":"08c9daf0-2344-52a9-8c68-31ac04c24ff0","nextPostId":"dbe47289-01f4-571d-9506-fbb92016f547"}},"staticQueryHashes":[],"slicesMap":{}}