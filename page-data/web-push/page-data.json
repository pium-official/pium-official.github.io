{"componentChunkName":"component---src-templates-post-jsx","path":"/web-push/","result":{"data":{"site":{"siteMetadata":{"title":"pium.log"}},"markdownRemark":{"id":"ac7012e4-5b85-5040-b65e-c068968d7979","excerpt":"이 글은 우테코 피움팀 크루 '클린'가 작성했습니다. PWA를 통해서 설치도 했고 Service Worker를 세팅함으로써 오프라인과 백그라운드 상황에서 이벤트에 대한 처리 역시 마칠 수 있었습니다. 이번에는 푸시 알림에 대해 알아보고 구현까지 해보려고 합니다. 푸시 알림은 말 그대로 가만히 있는데 알림을 밀어 넣어 준다는 것을 의미합니다. 푸시 기능과 …","html":"<blockquote>\n<p>이 글은 우테코 피움팀 크루 '<a href=\"https://github.com/hozzijeong\">클린</a>'가 작성했습니다.</p>\n</blockquote>\n<p>PWA를 통해서 설치도 했고 Service Worker를 세팅함으로써 오프라인과 백그라운드 상황에서 이벤트에 대한 처리 역시 마칠 수 있었습니다. 이번에는 푸시 알림에 대해 알아보고 구현까지 해보려고 합니다.</p>\n<p>푸시 알림은 말 그대로 가만히 있는데 알림을 밀어 넣어 준다는 것을 의미합니다. 푸시 기능과 알림은 서로 다른 맥락을 갖고 있지만, 둘을 합치면 우리가 상상하는 그 기능이 됩니다. 브라우저가 닫혀 있는 상황에서 서버에서 알림을 보냈을 때 푸시 기능을 통해 알림을 표시할 수 있습니다. 어떤 기술을 통해 알림이 허용되는지 보기에 앞서 어떤 원리로 웹 브라우저에서 푸시 알림 기능이 가능한지 먼저 살펴보겠습니다.</p>\n<h3>웹 푸시</h3>\n<blockquote>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Glossary/User_agent\">user agent</a>는 브라우저를, web page는 클라이언트 서비스를 의미한다.</p>\n</blockquote>\n<img width='694' alt='스크린샷 2023-11-01 오후 9 14 14' src='https://github.com/pium-official/pium-official.github.io/assets/50974359/de44e011-8320-4ff9-a46d-f406e06f2475'>\n<p>웹 푸시에 대한 대략적인 그림을 보기 전에 용어 정리 먼저 하겠습니다.</p>\n<p><a href=\"https://developer.mozilla.org/ko/docs/Web/API/Notifications_API\">Notifications API</a>: Notifications API 는 웹 페이지가 일반 사용자에게 시스템 알림 표시를 제어할 수 있게 해줍니다.</p>\n<p><a href=\"https://developer.mozilla.org/ko/docs/Web/API/Push_API\">Push API</a>: Push API는 웹 애플리케이션이 사용자 에이전트에서 웹 앱이 활성 상태에 있는지 또는 현재 로드 중인지 여부와 관계없이 서버로부터 푸시 메시지를 수신할 수 있는 기능을 제공합니다.</p>\n<p><code class=\"language-text\">push service</code>: 푸시 서비스는 서버에서 전송한 푸시 알림을 클라이언트로 전송하는 중간자 역할을 합니다. 대표적으로 구글의 <a href=\"https://firebase.google.com/docs/cloud-messaging?hl=ko\">FCM</a>과 애플의 <a href=\"https://developer.apple.com/documentation/usernotifications/setting_up_a_remote_notification_server/sending_notification_requests_to_apns\">APNs</a>가 있습니다. </p>\n<p>클라이언트에서는 Notification API를 통해 알림 허용을 받고, Push API를 통해서 푸시 알림을 구독한 뒤 서버로 부터 전송받은 푸시 알림을 푸시 서비스를 통해서 전달 받는 동작을 하고 있습니다.</p>\n<h3>VAPID 키</h3>\n<blockquote>\n<p>모든 브라우저에서 푸시를 사용하려면 <a href=\"https://tools.ietf.org/html/draft-thomson-webpush-vapid\">VAPID</a>(애플리케이션 서버 키라고도 함)를 사용해야 합니다. VAPID는 기본적으로 애플리케이션이 사용자에게 메시지를 보낼 수 있음을 증명하는 값으로 헤더를 설정해야 합니다. 푸시 메시지를 사용하여 데이터를 전송하려면 데이터를 <a href=\"https://tools.ietf.org/html/draft-ietf-webpush-encryption\">암호화</a>하고 특정 헤더를 추가하여 브라우저가 메시지를 올바르게 복호화할 수 있도록 해야 합니다. - <a href=\"https://web.dev/articles/sending-messages-with-web-push-libraries?hl=ko\">web.dev</a></p>\n</blockquote>\n<p>위에 있는 다이어그램 처럼 클라이언트 - 푸시 서비스 - 서버 간 통신을 하기 위해서는 VAPID 키가 필요합니다. 이 <code class=\"language-text\">public</code> - <code class=\"language-text\">private</code> 쌍을 가지고 푸시 서비스는 서버를 식별하고 전달 받은 알림 데이터의 유효성 검증을 합니다.</p>\n<ul>\n<li>서버에서는 알림 정보가 담긴 JWT를 <code class=\"language-text\">private</code>키를 통해 암호화 해서 푸시 서비스로 알림 요청을 보냅니다.</li>\n<li>푸시 서비스에서는 <code class=\"language-text\">public</code>키를 통해 전달 받은 데이터를 복호화 하고 유효성을 검증합니다.</li>\n<li><code class=\"language-text\">public</code>키로 구독한 디바이스에 알맞게 알림을 푸시합니다</li>\n</ul>\n<p><strong>VAPID 키 생성</strong></p>\n<p>(프로젝트가 이미 생성되어 있다고 가정하겠습니다) FCM을 사용하게 된다면 손쉽게 VAPID키를 만들 수 있습니다. </p>\n<p>FCM 콘솔로 이동 > 프로젝트 선택 > 프로젝트 설정 > 클라우드 메세징 > 웹 푸시 인증서 > Generate key pair</p>\n<img width='973' alt='클라우드 콘솔' src='https://github.com/pium-official/pium-official.github.io/assets/50974359/79e4e8eb-61e9-4d3d-a1b1-1532cff9bb5d'>\n<p>다음 버튼을 클릭한다면 public키와 private키가 생성이 됩니다. 여기서 생성된 값을 각각 서버와 클라이언트에 저장해서 사용하면 됩니다.</p>\n<p>public키는 클라이언트에서 푸시서비스에 구독을 할 때 사용이되고, private키는 서버에서 푸시 서비스로 알림을 보낼때 함께 동봉되어 날라가게 됩니다.</p>\n<h3>Service Worker Registration</h3>\n<p>서비스 워커 등록 과정은 <a href=\"https://blog.pium.life/serviceworker/\">이전 포스트</a>에서 다뤘기 때문에 간략적으로 보고 가겠습니다. service worker를 <code class=\"language-text\">register</code> 하고  <code class=\"language-text\">install activate</code> 등의 과정을 거쳐서 서비스 워커를 등록할 수 있습니다.</p>\n<h3>Create Push Subscription</h3>\n<img width='790' alt='스크린샷 2023-11-01 오후 9 05 37' src='https://github.com/pium-official/pium-official.github.io/assets/50974359/1900fde7-b613-4a5a-935e-678bb689e8ba'>\n<p>Push Suscription이란 <strong><em>푸시 서비스와 구독 정보를 주고 받는것</em></strong> 입니다. Push Subscription을 주고 받는 과정은 아래와 같습니다. </p>\n<ul>\n<li>Notification API를 통해 권한 요청</li>\n<li>user agent에서 push service로 subscribe 요청</li>\n<li>subscribe로 얻은 구독 정보(Push Subscription)를 얻고, 해당 정보를 서버에 전송 (Distribute Subsription)</li>\n</ul>\n<p><strong>Notification을 통한 권한 요청</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">async</span> <span class=\"token keyword\">function</span> <span class=\"token function\">notifyMe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token comment\">// Notification API를 지원하는지 확인한다.</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Notification\"</span> <span class=\"token keyword\">in</span> window<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token function\">alert</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"This browser does not support desktop notification\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span> \n\n\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Notification<span class=\"token punctuation\">.</span>permission <span class=\"token operator\">===</span> <span class=\"token string\">'granted'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t  <span class=\"token comment\">// 기존에 브라우저가 알림 허용했는지 확인    </span>\n      <span class=\"token keyword\">const</span> notification <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Notification</span><span class=\"token punctuation\">(</span><span class=\"token string\">'hello?'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\t<span class=\"token comment\">// 기본 설정 값이 알림을 거부하지 않았다면</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>Notification<span class=\"token punctuation\">.</span>permission <span class=\"token operator\">!==</span> <span class=\"token string\">'denied'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token comment\">// 권한 승인 요청</span>\n\t\t\t<span class=\"token keyword\">const</span> permission <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> Notification<span class=\"token punctuation\">.</span><span class=\"token function\">requestPermission</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>permission <span class=\"token operator\">===</span> <span class=\"token string\">'granted'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">const</span> notification <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Notification</span><span class=\"token punctuation\">(</span><span class=\"token string\">'subscribe On'</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이제 권한 요청을 수락했다면 서비스 워커에서 알림을 받을 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">'sw.js'</span><span class=\"token punctuation\">)</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">showNotification</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    Notification<span class=\"token punctuation\">.</span><span class=\"token function\">requestPermission</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">result</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t\t<span class=\"token comment\">// 요청을 수락했다면</span>\n        <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span>result <span class=\"token operator\">===</span> <span class=\"token string\">'granted'</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n            navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span>ready<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">registration</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n                registration<span class=\"token punctuation\">.</span><span class=\"token function\">showNotification</span><span class=\"token punctuation\">(</span><span class=\"token string\">'Vibration Sample'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n                    <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> <span class=\"token string\">'Buzz! Buzz!'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">icon</span><span class=\"token operator\">:</span> <span class=\"token string\">'../images/touch/chrome-touch-icon-192x192.png'</span><span class=\"token punctuation\">,</span>\n                    <span class=\"token literal-property property\">tag</span><span class=\"token operator\">:</span> <span class=\"token string\">'vibration-sample'</span><span class=\"token punctuation\">,</span>\n                <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span></code></pre></div>\n<p><strong>push service로 subscribe 요청</strong></p>\n<p>push service로 구독 요청하기 위해서는 <code class=\"language-text\">[pushManager</code> 인터페이스](<a href=\"https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration/pushManager\">https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorkerRegistration/pushManager</a>)에서 <code class=\"language-text\">subscribe</code> 메서드를 통해서 구독을 할 수 있습니다. 구독하는 과정에 앞서 FCM에서 생성한 public VAPID키가 필요합니다. 해당 public키를 <code class=\"language-text\">subscribe()</code>의 옵션으로 설정한다면 그 결과로 <code class=\"language-text\">pushSubscription</code>을 받을 수 있습니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span><span class=\"token function\">register</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"serviceworker.js\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\">// Use serviceWorker.ready to ensure that you can subscribe for push</span>\nnavigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span>ready<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">serviceWorkerRegistration</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">userVisibleOnly</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    applicationServerKey<span class=\"token punctuation\">,</span> <span class=\"token comment\">// public키 입니다.</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  serviceWorkerRegistration<span class=\"token punctuation\">.</span>pushManager<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">pushSubscription</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span>pushSubscription<span class=\"token punctuation\">.</span>endpoint<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\t<span class=\"token comment\">// subscribe에 성공했다면 pushSubscription이라는 객체를 반환해 줍니다. </span>\n\t\t\t<span class=\"token comment\">// 이제 이 정보를 서버에 저장하면 됩니다. </span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Distribute Subscription</h3>\n<p>푸시 서비스에 구독을 설정함으로써 전달 받은 pushSubsription을 서버에 보냄으로써 서버에서는 어떤 <code class=\"language-text\">endpoint</code>와 정보를 푸시 서비스에 보내는지 확인할 수 있습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span>ready<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">serviceWorkerRegistration</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">const</span> options <span class=\"token operator\">=</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">userVisibleOnly</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    applicationServerKey<span class=\"token punctuation\">,</span> <span class=\"token comment\">// public키 입니다.</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  serviceWorkerRegistration<span class=\"token punctuation\">.</span>pushManager<span class=\"token punctuation\">.</span><span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">pushSubscription</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token comment\">// 여기서 얻은 pushSubscription을 서버에 전송하면 됩니다.</span>\n\t\t\t<span class=\"token function\">subscribe</span><span class=\"token punctuation\">(</span>pushSubscription<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">(</span><span class=\"token parameter\">error</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      console<span class=\"token punctuation\">.</span><span class=\"token function\">error</span><span class=\"token punctuation\">(</span>error<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h3>Send Push Message</h3>\n<img width='804' alt='스크린샷 2023-11-01 오후 9 05 45' src='https://github.com/pium-official/pium-official.github.io/assets/50974359/afa9d56f-9080-461f-8c4d-d4865b6648ab'>\n<p>서버에서 전달받은 <code class=\"language-text\">pushSubscription</code>와 <code class=\"language-text\">private</code>키를 통해 푸시 서비스로 알림을 보낼수 있습니다. 서비스 워커에서는 푸시 이벤트를 감지하고 해당 이벤트에 알맞는 행동을 하게 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token comment\">// serviceWorker.js</span>\nself<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"push\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span><span class=\"token punctuation\">(</span>self<span class=\"token punctuation\">.</span>Notification <span class=\"token operator\">&amp;&amp;</span> self<span class=\"token punctuation\">.</span>Notification<span class=\"token punctuation\">.</span>permission <span class=\"token operator\">===</span> <span class=\"token string\">\"granted\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n\n  <span class=\"token keyword\">const</span> data <span class=\"token operator\">=</span> event<span class=\"token punctuation\">.</span>data<span class=\"token operator\">?.</span><span class=\"token function\">json</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span> <span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> title <span class=\"token operator\">=</span> data<span class=\"token punctuation\">.</span>title <span class=\"token operator\">||</span> <span class=\"token string\">\"Something Has Happened\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> message <span class=\"token operator\">=</span>\n    data<span class=\"token punctuation\">.</span>message <span class=\"token operator\">||</span> <span class=\"token string\">\"Here's something you might want to check out.\"</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">const</span> icon <span class=\"token operator\">=</span> <span class=\"token string\">\"images/new-notification.png\"</span><span class=\"token punctuation\">;</span>\n\n  <span class=\"token keyword\">const</span> notification <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">self<span class=\"token punctuation\">.</span>Notification</span><span class=\"token punctuation\">(</span>title<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">body</span><span class=\"token operator\">:</span> message<span class=\"token punctuation\">,</span>\n    <span class=\"token literal-property property\">tag</span><span class=\"token operator\">:</span> <span class=\"token string\">\"simple-push-demo-notification\"</span><span class=\"token punctuation\">,</span>\n    icon<span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n  notification<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    clients<span class=\"token punctuation\">.</span><span class=\"token function\">openWindow</span><span class=\"token punctuation\">(</span>\n      <span class=\"token string\">\"https://example.blog.com/2015/03/04/something-new.html\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>push 이벤트에는 데이터가 같이 담겨져서 옵니다 <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/PushEvent\">pushEvent 객체에 대한 인터페이스</a>를 보면 좀 더 자세히 알 수 있습니다.</p>\n<h3>Remove Push Subscription</h3>\n<p>이제 구독중인 <code class=\"language-text\">pushSubscription</code>을 제거해 볼 차례입니다. 구독중인 푸시 서비스를 구독 해제한다고 보시면 됩니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">navigator<span class=\"token punctuation\">.</span>serviceWorker<span class=\"token punctuation\">.</span>ready<span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">reg</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  reg<span class=\"token punctuation\">.</span>pushManager<span class=\"token punctuation\">.</span><span class=\"token function\">getSubscription</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">subscription</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    subscription\n      <span class=\"token punctuation\">.</span><span class=\"token function\">unsubscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">then</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">successful</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 푸시 서비스 구독 취소 한다면 서버에서도 구독 취소를 같이 해줘야 함</span>\n\t\t\t\t<span class=\"token function\">unsubscribe</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> \n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span>\n      <span class=\"token punctuation\">.</span><span class=\"token function\">catch</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token parameter\">e</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// Unsubscribing failed</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p><code class=\"language-text\">pushManager</code>에 있는 <code class=\"language-text\">subscription</code> 정보를 얻어오고, 해당 정보에서 <code class=\"language-text\">unsubscribe</code>를 하면 간단하게 할 수 있습니다. 푸시 서비스 구독 취소에 성공하게 된다면 서버에 저장되어 있는 구독 취소 API를 호출함으로써 이제 클라이언트 - 푸시 서비스 - 서버의 관계를 끊어낼 수 있습니다.</p>\n<hr>\n<h3>참조</h3>\n<p><a href=\"https://www.w3.org/TR/push-api/#subscription-refreshes\">https://www.w3.org/TR/push-api/#subscription-refreshes</a></p>\n<p><a href=\"https://web.dev/articles/sending-messages-with-web-push-libraries?hl=ko\">https://web.dev/articles/sending-messages-with-web-push-libraries?hl=ko</a></p>\n<p><a href=\"https://developer.mozilla.org/ko/docs/Web/API/Push_API\">https://developer.mozilla.org/ko/docs/Web/API/Push_API</a></p>\n<p><a href=\"https://developer.mozilla.org/ko/docs/Web/API/Notifications_API\">https://developer.mozilla.org/ko/docs/Web/API/Notifications_API</a></p>","frontmatter":{"title":"브라우저에서 알림 구현하기","date":"November 01, 2023","update":"November 01, 2023","tags":["PWA","web-push","Notifications API","Push API","FCM"],"series":null},"fields":{"slug":"/web-push/","readingTime":{"minutes":10.65}}},"seriesList":{"edges":[{"node":{"id":"28f1d87e-d3fc-5567-8531-57649652864f","fields":{"slug":"/sprint-idea/"},"frontmatter":{"title":"구글 스프린트 기반 아이디어 도출"}}},{"node":{"id":"4a9246fb-171b-5973-88fc-864034e78afd","fields":{"slug":"/blog-starter/"},"frontmatter":{"title":"피움 블로그 생성과정"}}},{"node":{"id":"c826ce0e-1ea7-517c-8d19-84e90a59a798","fields":{"slug":"/jenkins-setting/"},"frontmatter":{"title":"젠킨스 설치하기"}}},{"node":{"id":"a387bf4f-567f-50e7-b6a7-99a1a1c8971b","fields":{"slug":"/jpa-notnull-nullable/"},"frontmatter":{"title":"@NotNull과 nullable = false는 어떤 차이가 있을까?"}}},{"node":{"id":"a78e224b-b711-5071-8e90-013d6f4bebc3","fields":{"slug":"/pium-deploy-step/"},"frontmatter":{"title":"피움의 배포과정"}}},{"node":{"id":"ce07fbab-1ed5-5f1e-8e2f-eb430879b56a","fields":{"slug":"/fe-tanstack-query/"},"frontmatter":{"title":"프론트엔드: Tanstack Query 사용에 대하여"}}},{"node":{"id":"159c943b-1a50-57dd-aa71-7557364752a5","fields":{"slug":"/ci-cd-setting/"},"frontmatter":{"title":"Jenkins와 Github Webhook을 이용해 CI/CD 구축하기"}}},{"node":{"id":"dea45a4a-bfde-5fbb-8a97-42d3a3e77a0b","fields":{"slug":"/jenkins-hook-by-label/"},"frontmatter":{"title":"PR 라벨로 젠킨스 빌드유발을 구분하기"}}},{"node":{"id":"707f8ffb-1409-5c27-b15a-5661b235c226","fields":{"slug":"/db-drop-stop/"},"frontmatter":{"title":"Table Drop 못하게 막아버리기"}}},{"node":{"id":"1a03734e-d413-553f-9152-1dad2fc4acca","fields":{"slug":"/apply-https/"},"frontmatter":{"title":"내 서버에 HTTPS 설정하기"}}},{"node":{"id":"cecbc8b9-db00-562b-aa0b-06c406cfc44a","fields":{"slug":"/bundle-analyze/"},"frontmatter":{"title":"bundle-analyze를 통한 bundle 크기 분석"}}},{"node":{"id":"fe4b591a-4dd5-5dd2-b18a-b318afd1e9e3","fields":{"slug":"/transactional-not-in-restassured/"},"frontmatter":{"title":"[트러블슈팅] @SpringbootTest의 RANDOM_PORT 환경에서 @Transactional 어노테이션을 사용했을 때, RestAssured GET 요청이 수행되지 않는 경우(트랜잭션 격리 이해하기)"}}},{"node":{"id":"80aa708e-ef8a-5c79-9644-cb8c04d55a63","fields":{"slug":"/acceptance-test-resolve/"},"frontmatter":{"title":"인수테스트 데이터 초기화하기"}}},{"node":{"id":"15def1d5-c20f-5d07-b46e-24a14661365f","fields":{"slug":"/react-setting-without-cra/"},"frontmatter":{"title":"webpack으로만 React 설정하기 (without CRA)"}}},{"node":{"id":"66383c86-e2c8-533a-90e0-2effae572742","fields":{"slug":"/stylelint-and-husky/"},"frontmatter":{"title":"stylelint와 husky를 통해 컨벤션 통일하기"}}},{"node":{"id":"ed5951d5-beda-5a8f-adb2-07c2fcb38d5e","fields":{"slug":"/OAuth2.0/"},"frontmatter":{"title":"내가 이해한 OAuth2.0"}}},{"node":{"id":"45eeb9a3-557d-5704-8fd9-925283e1e27b","fields":{"slug":"/restdocs-start/"},"frontmatter":{"title":"RestDocs로 API 문서화하기"}}},{"node":{"id":"663b560a-734d-51a9-a6dc-3c4f50716c74","fields":{"slug":"/spring-event-apply/"},"frontmatter":{"title":"Spring Event 적용하기"}}},{"node":{"id":"503e9e71-eda3-53d7-8142-7c309faf213e","fields":{"slug":"/why_we_applied_querydsl/"},"frontmatter":{"title":"피움 서비스의 Querydsl 도입 이유"}}},{"node":{"id":"55ae8038-3f65-5a59-8db3-c7405e7fc125","fields":{"slug":"/github-actions-cypress/"},"frontmatter":{"title":"피움 Cypress 자동화 구축기"}}},{"node":{"id":"709124d0-5b05-5530-804d-e90ec9856a13","fields":{"slug":"/querydsl_apply_procedure/"},"frontmatter":{"title":"피움 서비스의 Querydsl 적용 과정"}}},{"node":{"id":"5c865dcb-cefd-58be-8968-b5edf6c8080c","fields":{"slug":"/server-logging/"},"frontmatter":{"title":"Logback을 이용해 운영 환경 별 로그 남기기"}}},{"node":{"id":"8269f166-d041-533c-9d44-332d8d8c3dca","fields":{"slug":"/server-monitoring/"},"frontmatter":{"title":"CloudWatch를 이용한 모니터링 환경 구성"}}},{"node":{"id":"0faec7ad-3bd1-5f5e-9222-115f771df8ed","fields":{"slug":"/tanstack-query-cache-trouble-shooting/"},"frontmatter":{"title":"InfinityQuery에서 fetch가 제대로 이루어지지 않는다?!?!"}}},{"node":{"id":"c77f7199-7fc6-53a3-a1fb-0792e05655a7","fields":{"slug":"/OAuth2.0-backend/"},"frontmatter":{"title":"OAuth 2.0 로그인 구현하기 (카카오)"}}},{"node":{"id":"12e4480d-386b-5d0e-bd69-4209fed36066","fields":{"slug":"/OAuth-test-backend/"},"frontmatter":{"title":"외부 API 를 의존하는 OAuth 로그인 테스트하기"}}},{"node":{"id":"ff40e109-cc92-5d83-a213-ca9d07136d95","fields":{"slug":"/aws-s3-apply/"},"frontmatter":{"title":"AWS S3로 정적 이미지 배포하기"}}},{"node":{"id":"e343af80-72dd-5173-bbb5-5069a17d1200","fields":{"slug":"/search_in_spring_data_jpa/"},"frontmatter":{"title":"Spring Data Jpa를 활용한 검색 기능 개발하기"}}},{"node":{"id":"af344dd8-ea77-5fde-9452-a97952ce60be","fields":{"slug":"/submodule-apply/"},"frontmatter":{"title":"Git submodule을 이용한 민감정보 관리"}}},{"node":{"id":"08c9daf0-2344-52a9-8c68-31ac04c24ff0","fields":{"slug":"/tomcat-thread-config/"},"frontmatter":{"title":"톰캣 스레드 설정하기"}}},{"node":{"id":"eafed74f-ff11-5af1-a589-e9dd2ccb5c8e","fields":{"slug":"/http-cache/"},"frontmatter":{"title":"CloudFront와 HTTP 캐시"}}},{"node":{"id":"dbe47289-01f4-571d-9506-fbb92016f547","fields":{"slug":"/optimize-frontend/"},"frontmatter":{"title":"피움 최적화하기"}}},{"node":{"id":"7b830fe6-e2df-564a-926e-7f7800380336","fields":{"slug":"/query-analysis/"},"frontmatter":{"title":"서비스 내에서 발생하는 쿼리를 분석하고 개선하기"}}},{"node":{"id":"37437d15-a63e-52ef-b031-6ee1bc6fa8bc","fields":{"slug":"/image-resize/"},"frontmatter":{"title":"서버에서 이미지 리사이징하기"}}},{"node":{"id":"216f4636-4125-5765-83d8-a6a610692a41","fields":{"slug":"/dont-stop-deploy/"},"frontmatter":{"title":"무중단 배포 환경 구성하기"}}},{"node":{"id":"dd095976-5a96-51b5-9686-8956dc60cd24","fields":{"slug":"/hikaricp-connection-pool-setting/"},"frontmatter":{"title":"HikariCp Connection Pool 값 설정"}}},{"node":{"id":"625ad76f-acb1-56cc-9baa-3d6f1a954ac2","fields":{"slug":"/pwa/"},"frontmatter":{"title":"PWA를 도입해보자"}}},{"node":{"id":"6a12651c-e6b8-5fa6-9c57-766772d32680","fields":{"slug":"/serviceworker/"},"frontmatter":{"title":"Service Worker에 대한 대략적인 이해"}}},{"node":{"id":"b9709447-61dc-52f0-95a5-8670a3fbaaf4","fields":{"slug":"/installPrompt/"},"frontmatter":{"title":"홈화면에 추가 안내 prompt 만들기"}}},{"node":{"id":"ac7012e4-5b85-5040-b65e-c068968d7979","fields":{"slug":"/web-push/"},"frontmatter":{"title":"브라우저에서 알림 구현하기"}}}]},"previous":{"fields":{"slug":"/installPrompt/"},"frontmatter":{"title":"홈화면에 추가 안내 prompt 만들기"}},"next":null},"pageContext":{"id":"ac7012e4-5b85-5040-b65e-c068968d7979","series":null,"previousPostId":"b9709447-61dc-52f0-95a5-8670a3fbaaf4","nextPostId":null}},"staticQueryHashes":[],"slicesMap":{}}