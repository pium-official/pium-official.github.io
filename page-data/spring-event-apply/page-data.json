{"componentChunkName":"component---src-templates-post-jsx","path":"/spring-event-apply/","result":{"data":{"site":{"siteMetadata":{"title":"pium.log"}},"markdownRemark":{"id":"663b560a-734d-51a9-a6dc-3c4f50716c74","excerpt":"이 글은 우테코 피움팀 크루 '주노'가 작성했습니다. 사건의 발단 물주기, 반려 식물 정보 등록 및 수정과 같은 행동에 대한 History를 기록해야한다. 이 과정에서 History를 기록하는 코드가 ReminderService, PetPlantService에 침투하는 상황이 발생했다. History라는 도메인이 Reminder, PetPlant 그리고 …","html":"<blockquote>\n<p>이 글은 우테코 피움팀 크루 '<a href=\"https://github.com/Choi-JJunho\">주노</a>'가 작성했습니다.</p>\n</blockquote>\n<h2>사건의 발단</h2>\n<p>물주기, 반려 식물 정보 등록 및 수정과 같은 행동에 대한 History를 기록해야한다.</p>\n<p>이 과정에서 History를 기록하는 코드가 ReminderService, PetPlantService에 침투하는 상황이 발생했다.</p>\n<p>History라는 도메인이 Reminder, PetPlant 그리고 앞으로 생겨날 히스토리가 필요한 로직들에 대해 강한 의존성을 가지게 될 것을 우려했다.</p>\n<p>실제로 다음과 같은 코드가 작성되면서 그 심각성은 더욱 가깝게 다가왔다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Transactional</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">water</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ReminderCreateRequest</span> reminderCreateRequest<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> petPlantId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Member</span> member<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token class-name\">PetPlant</span> petPlant <span class=\"token operator\">=</span> petPlantRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>petPlantId<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NoSuchElementException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"일치하는 반려 식물이 존재하지 않습니다. id: \"</span> <span class=\"token operator\">+</span> petPlantId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">checkOwner</span><span class=\"token punctuation\">(</span>petPlant<span class=\"token punctuation\">,</span> member<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token class-name\">LocalDate</span> prevDate <span class=\"token operator\">=</span> petPlant<span class=\"token punctuation\">.</span><span class=\"token function\">getLastWaterDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    petPlant<span class=\"token punctuation\">.</span><span class=\"token function\">water</span><span class=\"token punctuation\">(</span>reminderCreateRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getWaterDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">HistoryCategory</span> historyCategory <span class=\"token operator\">=</span> historyCategoryRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByHistoryType</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HistoryType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAST_WATER_DATE</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span>\n                    <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NoSuchElementException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"존재하지 않는 히스토리 타입입니다. type: \"</span> <span class=\"token operator\">+</span> <span class=\"token class-name\">HistoryType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">LAST_WATER_DATE</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token class-name\">History</span> history <span class=\"token operator\">=</span> <span class=\"token class-name\">History</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">petPlant</span><span class=\"token punctuation\">(</span>petPlant<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span>reminderCreateRequest<span class=\"token punctuation\">.</span><span class=\"token function\">getWaterDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">historyCategory</span><span class=\"token punctuation\">(</span>historyCategory<span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">historyContent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HistoryContent</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">previous</span><span class=\"token punctuation\">(</span>prevDate<span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">current</span><span class=\"token punctuation\">(</span>petPlant<span class=\"token punctuation\">.</span><span class=\"token function\">getLastWaterDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">toString</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                    <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n            <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    historyRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>history<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>이렇게 개발을 진행하다가는 모든 코드에 HistoryRepository, HistoryCategoryRepository들이 침투하게된다.</p>\n<p>아무리 개발이 급해도 이건 아니다 싶어서 <code class=\"language-text\">History를 기록한다</code> 라는 행위에 대한 관심사를 분리하는 방법을 찾아봤다.</p>\n<h2>관심사 분리</h2>\n<p>관심사를 분리하는 방법으로 다음 두가지 방법을 찾았다.</p>\n<p><code class=\"language-text\">1. AOP를 사용한다.</code></p>\n<p>AOP의 <code class=\"language-text\">@Around</code>어노테이션을 이용하여 History 기록이 필요한 부분에 대해 기록하는 동작을 수행할 수 있다.</p>\n<p>해당 방식은 다음과 같은 특징을 가진다.</p>\n<ul>\n<li>포인트컷 표현식으로 대상 메소드 혹은 클래스를 지정할 수 있다.</li>\n<li>메소드의 파라미터값, 반환값, 이름 등의 정보를 구할 수 있다.</li>\n<li>내부에서 선언된 변수에 대해서는 접근할 수 없다.</li>\n<li>선언된 메소드와 동일한 트랜잭션 주기를 가진다.</li>\n</ul>\n<p><code class=\"language-text\">2. Spring Event를 사용한다.</code></p>\n<p>Spring에서 제공하는 Event 기능을 사용할 수도 있다.</p>\n<p>History와 관련된 Repository나 Service에 의존하지 않고 EventPublisher를 의존하게 하여 패키지간 의존성을 해결할 수 있다.</p>\n<ul>\n<li>서비스간의 강한 의존성을 줄일 수 있다.</li>\n<li>이벤트로 분리된 부분을 비동기 방식으로 처리할 수 있다.</li>\n</ul>\n<p>AOP와 Event 두가지 방식을 알아봤다.</p>\n<p>AOP를 사용하면 프로덕션 코드 내에서 History에 대해 아예 몰라도 된다는 이점이 있었지만 History 생성 간 내부 값이 필요한 경우 이에 대처하기 어렵다는 문제가 있었다.</p>\n<p>이에 내부 값을 History에 맞는 양식으로 변환한 뒤 EventListener에게 위임하는 형태를 사용하기로 했다.</p>\n<h2>Event 흐름</h2>\n<p>Event의 흐름 자체는 간단하다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/0341988b6ce821dca6455e3437516ffe/dac1b/5ba5ff42.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABaElEQVR42o2SuQrCQBCGt0qhaOUFGo/gw2knvoNG1BcQBC/yCMFCxaQRBAsLz8Kk8UwrKKLxlxkwlYUDHzswy8z8/6643+84n89wHIe5XC5e/ng88I33++3huu5PqCY6nQ4CgQAikQjC4TCi0SgjSRL6/T5erxdutxtf/idEq9VCLBZDJpNhstksUqkUD9F1Hfv9HuPxGLPZDIfDAavVCo1GA71eD+1224P6HI9HiMlkglwuh2KxiEKhwFCez+exXC55Ksk5nU7Y7Xao1Wrw+/2sJh6PIxQK8UI+nw+DwQBiOp2iVCqhXq/z5S/VapUnkmTLsrBYLLDdblEulxEMBllFIpFAMplkqPFwOISoVCo8UVEU9k6WZS6Sh4ZhYL1eYz6fw7Zt9nKz2aDZbELTNJbd7Xb5JEiFUFWV1yX/qFk6nebptAXZQUFb/huCTB+NRrwNQQ9Ap2mauF6vnoffV6b8+Xz+hL7NBzbI3uR/Ic/7AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='5ba5ff42' title='' src='/static/0341988b6ce821dca6455e3437516ffe/ca1dc/5ba5ff42.png' srcset='/static/0341988b6ce821dca6455e3437516ffe/e7570/5ba5ff42.png 170w,\n/static/0341988b6ce821dca6455e3437516ffe/f46e7/5ba5ff42.png 340w,\n/static/0341988b6ce821dca6455e3437516ffe/ca1dc/5ba5ff42.png 680w,\n/static/0341988b6ce821dca6455e3437516ffe/dac1b/5ba5ff42.png 703w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>기존의 서비스 로직이 History라는 도메인에 대한 의존성을 가지게 되는 구조였다면</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/63b46f4172e2c3f1f1bf4958247806c8/85c72/aebfae33.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 57.05882352941176%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB9klEQVR42o1STYvpcRSmrEQKJS9lhhqMbDRlxZKa1CysxFew4gvYyScYFjTbWbEgL7NVYmGBIYSSsSCvZWHwzD1ncrtu997uU0+d/v9znt85zzkC/MBms0Gr1cL7+zva7TbH3W4Xh8MBF5xOJ/T7fTSbTc6h3E6nw7nb7ZZzzuczBBS8vr5CJpNBo9FAq9VCoVDg7u4O9Xod4/EYg8GAix8eHiCXy6FWq6FUKqFSqSCVSrmecDwevwUzmQxMJhPsdjvTZrPB6XSiVqthNpthOp1iOBzC7XbzP8qxWq0cUx3VXwmu12tunUa5sNfrXY1M45AoddpoNPD29sad0+i73e565L+BfCNSIvECemg0Gv0U+RWCarWK5+dnpNNppFIpJJNJZLPZq6Tfi/4pGA6HIRaLodPpmBKJhP2jMWir5CEV0SaXyyXbs1gs+AroOujbarXC5+fnt2AikcDj4yP8fj/z6ekJ9AiBxKgTKvZ4PLi5uYHFYmGazWbc39/zcug7ecqC5XIZ0WgU8XgcsViM45eXF/bu4+MDk8mEt+1yuaDX62E0GmEwGFjk9vaWt0xnlM/nvwVDoRCEQiHfFFEkEsHhcPCItMH5fI79fo9KpYJcLodSqYRisci8xIVCgW1gQVqI1+tFMBhEIBCAz+dDJBL5o+H/gy/x+qfhqftryQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='aebfae33' title='' src='/static/63b46f4172e2c3f1f1bf4958247806c8/ca1dc/aebfae33.png' srcset='/static/63b46f4172e2c3f1f1bf4958247806c8/e7570/aebfae33.png 170w,\n/static/63b46f4172e2c3f1f1bf4958247806c8/f46e7/aebfae33.png 340w,\n/static/63b46f4172e2c3f1f1bf4958247806c8/ca1dc/aebfae33.png 680w,\n/static/63b46f4172e2c3f1f1bf4958247806c8/85c72/aebfae33.png 863w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>다음과 같이 History 도메인에 의존하지 않는 구조로 개선될 수 있다.</p>\n<h2>Event 구현하기</h2>\n<p>Spring Event를 구현하기 위해서는 크게 3가지 요소가 필요하다.</p>\n<h3>Event Class</h3>\n<blockquote>\n<p>해당 실습은 SpringBoot 3.1(Spring Framework 6) 환경에서 진행됩니다. </p>\n<p>(Spring Framework 4.2 이전 버전은 설정이 상이하니 이점 유의해주시기 바랍니다.)</p>\n</blockquote>\n<p>우선 이벤트 클래스다.</p>\n<p>이벤트 클래스는 이벤트를 처리하기 위해 필요한 데이터를 가지고있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Getter</span>\n<span class=\"token annotation punctuation\">@Validated</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HistoryEvent</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">Long</span> petPlantId<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> previous<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">String</span> current<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">HistoryType</span> historyType<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">LocalDate</span> date<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>Event Publisher</h3>\n<p>다음은 이벤트를 발행하는 publisher다.</p>\n<p>Spring에서는 ApplicationEventPublisher의 publish() 메소드를 사용하여 Context에 이벤트를 발행할 수 있다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Service</span>\n<span class=\"token annotation punctuation\">@Transactional</span><span class=\"token punctuation\">(</span>readOnly <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ReminderService</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">ApplicationEventPublisher</span> publisher<span class=\"token punctuation\">;</span>\n    \n    <span class=\"token annotation punctuation\">@Transactional</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">water</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ReminderCreateRequest</span> reminderCreateRequest<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Long</span> petPlantId<span class=\"token punctuation\">,</span> <span class=\"token class-name\">Member</span> member<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token comment\">// 반려 식물 물주기 수행</span>\n        publisher<span class=\"token punctuation\">.</span><span class=\"token function\">publishEvent</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">HistoryEvent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h3>EventListener</h3>\n<p>마지막으로 이벤트 리스너다.</p>\n<p>발행된 이벤트를 컨텍스트에서 잡아서 수행하는 역할을 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Component</span>\n<span class=\"token annotation punctuation\">@RequiredArgsConstructor</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">HistoryEventListener</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">PetPlantRepository</span> petPlantRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">HistoryRepository</span> historyRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">HistoryCategoryRepository</span> historyCategoryRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token comment\">// 히스토리를 저장한다.</span>\n    <span class=\"token annotation punctuation\">@EventListener</span>\n    <span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">savePetPlantHistory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HistoryEvent</span> historyEvent<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\n        <span class=\"token class-name\">PetPlant</span> petPlant <span class=\"token operator\">=</span> petPlantRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>historyEvent<span class=\"token punctuation\">.</span><span class=\"token function\">getPetPlantId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NoSuchElementException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"일치하는 반려 식물이 존재하지 않습니다. id: \"</span> <span class=\"token operator\">+</span> historyEvent<span class=\"token punctuation\">.</span><span class=\"token function\">getPetPlantId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">HistoryCategory</span> historyCategory <span class=\"token operator\">=</span> historyCategoryRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByHistoryType</span><span class=\"token punctuation\">(</span>historyEvent<span class=\"token punctuation\">.</span><span class=\"token function\">getHistoryType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">orElseThrow</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">-></span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">NoSuchElementException</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"존재하지 않는 히스토리 타입입니다. type: \"</span> <span class=\"token operator\">+</span> historyEvent<span class=\"token punctuation\">.</span><span class=\"token function\">getHistoryType</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">History</span> history <span class=\"token operator\">=</span> <span class=\"token class-name\">History</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">petPlant</span><span class=\"token punctuation\">(</span>petPlant<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">date</span><span class=\"token punctuation\">(</span>historyEvent<span class=\"token punctuation\">.</span><span class=\"token function\">getDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">historyCategory</span><span class=\"token punctuation\">(</span>historyCategory<span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">historyContent</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">HistoryContent</span><span class=\"token punctuation\">.</span><span class=\"token function\">builder</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">previous</span><span class=\"token punctuation\">(</span>historyEvent<span class=\"token punctuation\">.</span><span class=\"token function\">getPrevious</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">current</span><span class=\"token punctuation\">(</span>historyEvent<span class=\"token punctuation\">.</span><span class=\"token function\">getCurrent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                        <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span>\n                <span class=\"token punctuation\">.</span><span class=\"token function\">build</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        historyRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>history<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2>결론</h2>\n<p>Spring Event를 도입하여 도메인간의 결합도를 줄여봤다.</p>\n<p>이벤트를 다루면 비동기 처리에 대한 이야기가 많이 보이는 것 같은데 아직 해당 작업이 비동기처리가 필요할 만큼 오래 걸리는 작업이라는 판단을 내리지 못했다.</p>\n<p>비동기 처리는 나중에 추가로 다뤄보도록 하자.</p>\n<h2>Reference</h2>\n<ul>\n<li><a href=\"https://wildeveloperetrain.tistory.com/217\">https://wildeveloperetrain.tistory.com/217</a></li>\n<li><a href=\"https://mangkyu.tistory.com/292\">https://mangkyu.tistory.com/292</a></li>\n</ul>","frontmatter":{"title":"Spring Event 적용하기","date":"August 13, 2023","update":"August 13, 2023","tags":["이벤트","Spring"],"series":null},"fields":{"slug":"/spring-event-apply/","readingTime":{"minutes":6.405}}},"seriesList":{"edges":[{"node":{"id":"28f1d87e-d3fc-5567-8531-57649652864f","fields":{"slug":"/sprint-idea/"},"frontmatter":{"title":"구글 스프린트 기반 아이디어 도출"}}},{"node":{"id":"4a9246fb-171b-5973-88fc-864034e78afd","fields":{"slug":"/blog-starter/"},"frontmatter":{"title":"피움 블로그 생성과정"}}},{"node":{"id":"c826ce0e-1ea7-517c-8d19-84e90a59a798","fields":{"slug":"/jenkins-setting/"},"frontmatter":{"title":"젠킨스 설치하기"}}},{"node":{"id":"a387bf4f-567f-50e7-b6a7-99a1a1c8971b","fields":{"slug":"/jpa-notnull-nullable/"},"frontmatter":{"title":"@NotNull과 nullable = false는 어떤 차이가 있을까?"}}},{"node":{"id":"a78e224b-b711-5071-8e90-013d6f4bebc3","fields":{"slug":"/pium-deploy-step/"},"frontmatter":{"title":"피움의 배포과정"}}},{"node":{"id":"ce07fbab-1ed5-5f1e-8e2f-eb430879b56a","fields":{"slug":"/fe-tanstack-query/"},"frontmatter":{"title":"프론트엔드: Tanstack Query 사용에 대하여"}}},{"node":{"id":"159c943b-1a50-57dd-aa71-7557364752a5","fields":{"slug":"/ci-cd-setting/"},"frontmatter":{"title":"Jenkins와 Github Webhook을 이용해 CI/CD 구축하기"}}},{"node":{"id":"dea45a4a-bfde-5fbb-8a97-42d3a3e77a0b","fields":{"slug":"/jenkins-hook-by-label/"},"frontmatter":{"title":"PR 라벨로 젠킨스 빌드유발을 구분하기"}}},{"node":{"id":"1a03734e-d413-553f-9152-1dad2fc4acca","fields":{"slug":"/apply-https/"},"frontmatter":{"title":"내 서버에 HTTPS 설정하기"}}},{"node":{"id":"cecbc8b9-db00-562b-aa0b-06c406cfc44a","fields":{"slug":"/bundle-analyze/"},"frontmatter":{"title":"bundle-analyze를 통한 bundle 크기 분석"}}},{"node":{"id":"707f8ffb-1409-5c27-b15a-5661b235c226","fields":{"slug":"/db-drop-stop/"},"frontmatter":{"title":"Table Drop 못하게 막아버리기"}}},{"node":{"id":"fe4b591a-4dd5-5dd2-b18a-b318afd1e9e3","fields":{"slug":"/transactional-not-in-restassured/"},"frontmatter":{"title":"[트러블슈팅] @SpringbootTest의 RANDOM_PORT 환경에서 @Transactional 어노테이션을 사용했을 때, RestAssured GET 요청이 수행되지 않는 경우(트랜잭션 격리 이해하기)"}}},{"node":{"id":"80aa708e-ef8a-5c79-9644-cb8c04d55a63","fields":{"slug":"/acceptance-test-resolve/"},"frontmatter":{"title":"인수테스트 데이터 초기화하기"}}},{"node":{"id":"15def1d5-c20f-5d07-b46e-24a14661365f","fields":{"slug":"/react-setting-without-cra/"},"frontmatter":{"title":"webpack으로만 React 설정하기 (without CRA)"}}},{"node":{"id":"66383c86-e2c8-533a-90e0-2effae572742","fields":{"slug":"/stylelint-and-husky/"},"frontmatter":{"title":"stylelint와 husky를 통해 컨벤션 통일하기"}}},{"node":{"id":"ed5951d5-beda-5a8f-adb2-07c2fcb38d5e","fields":{"slug":"/OAuth2.0/"},"frontmatter":{"title":"내가 이해한 OAuth2.0"}}},{"node":{"id":"45eeb9a3-557d-5704-8fd9-925283e1e27b","fields":{"slug":"/restdocs-start/"},"frontmatter":{"title":"RestDocs로 API 문서화하기"}}},{"node":{"id":"663b560a-734d-51a9-a6dc-3c4f50716c74","fields":{"slug":"/spring-event-apply/"},"frontmatter":{"title":"Spring Event 적용하기"}}},{"node":{"id":"55ae8038-3f65-5a59-8db3-c7405e7fc125","fields":{"slug":"/github-actions-cypress/"},"frontmatter":{"title":"피움 Cypress 자동화 구축기"}}},{"node":{"id":"503e9e71-eda3-53d7-8142-7c309faf213e","fields":{"slug":"/why_we_applied_querydsl/"},"frontmatter":{"title":"피움 서비스의 Querydsl 도입 이유"}}},{"node":{"id":"709124d0-5b05-5530-804d-e90ec9856a13","fields":{"slug":"/querydsl_apply_procedure/"},"frontmatter":{"title":"피움 서비스의 Querydsl 적용 과정"}}},{"node":{"id":"5c865dcb-cefd-58be-8968-b5edf6c8080c","fields":{"slug":"/server-logging/"},"frontmatter":{"title":"Logback을 이용해 운영 환경 별 로그 남기기"}}},{"node":{"id":"8269f166-d041-533c-9d44-332d8d8c3dca","fields":{"slug":"/server-monitoring/"},"frontmatter":{"title":"CloudWatch를 이용한 모니터링 환경 구성"}}},{"node":{"id":"0faec7ad-3bd1-5f5e-9222-115f771df8ed","fields":{"slug":"/tanstack-query-cache-trouble-shooting/"},"frontmatter":{"title":"InfinityQuery에서 fetch가 제대로 이루어지지 않는다?!?!"}}},{"node":{"id":"c77f7199-7fc6-53a3-a1fb-0792e05655a7","fields":{"slug":"/OAuth2.0-backend/"},"frontmatter":{"title":"OAuth 2.0 로그인 구현하기 (카카오)"}}},{"node":{"id":"12e4480d-386b-5d0e-bd69-4209fed36066","fields":{"slug":"/OAuth-test-backend/"},"frontmatter":{"title":"외부 API 를 의존하는 OAuth 로그인 테스트하기"}}},{"node":{"id":"ff40e109-cc92-5d83-a213-ca9d07136d95","fields":{"slug":"/aws-s3-apply/"},"frontmatter":{"title":"AWS S3로 정적 이미지 배포하기"}}},{"node":{"id":"e343af80-72dd-5173-bbb5-5069a17d1200","fields":{"slug":"/search_in_spring_data_jpa/"},"frontmatter":{"title":"Spring Data Jpa를 활용한 검색 기능 개발하기"}}},{"node":{"id":"af344dd8-ea77-5fde-9452-a97952ce60be","fields":{"slug":"/submodule-apply/"},"frontmatter":{"title":"Git submodule을 이용한 민감정보 관리"}}},{"node":{"id":"08c9daf0-2344-52a9-8c68-31ac04c24ff0","fields":{"slug":"/tomcat-thread-config/"},"frontmatter":{"title":"톰캣 스레드 설정하기"}}},{"node":{"id":"dbe47289-01f4-571d-9506-fbb92016f547","fields":{"slug":"/optimize-frontend/"},"frontmatter":{"title":"피움 최적화하기"}}},{"node":{"id":"eafed74f-ff11-5af1-a589-e9dd2ccb5c8e","fields":{"slug":"/http-cache/"},"frontmatter":{"title":"CloudFront와 HTTP 캐시"}}},{"node":{"id":"7b830fe6-e2df-564a-926e-7f7800380336","fields":{"slug":"/query-analysis/"},"frontmatter":{"title":"서비스 내에서 발생하는 쿼리를 분석하고 개선하기"}}},{"node":{"id":"37437d15-a63e-52ef-b031-6ee1bc6fa8bc","fields":{"slug":"/image-resize/"},"frontmatter":{"title":"서버에서 이미지 리사이징하기"}}},{"node":{"id":"216f4636-4125-5765-83d8-a6a610692a41","fields":{"slug":"/dont-stop-deploy/"},"frontmatter":{"title":"무중단 배포 환경 구성하기"}}}]},"previous":{"fields":{"slug":"/restdocs-start/"},"frontmatter":{"title":"RestDocs로 API 문서화하기"}},"next":{"fields":{"slug":"/github-actions-cypress/"},"frontmatter":{"title":"피움 Cypress 자동화 구축기"}}},"pageContext":{"id":"663b560a-734d-51a9-a6dc-3c4f50716c74","series":null,"previousPostId":"45eeb9a3-557d-5704-8fd9-925283e1e27b","nextPostId":"55ae8038-3f65-5a59-8db3-c7405e7fc125"}},"staticQueryHashes":[],"slicesMap":{}}