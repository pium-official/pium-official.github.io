{"componentChunkName":"component---src-templates-post-jsx","path":"/installPrompt/","result":{"data":{"site":{"siteMetadata":{"title":"pium.log"}},"markdownRemark":{"id":"b9709447-61dc-52f0-95a5-8670a3fbaaf4","excerpt":"이 글은 우테코 피움팀 크루 '클린'가 작성했습니다. 바로가기 prompt 만들기  설정을 했다면 홈 화면에 바로가기를 추가할 수 있습니다. 보통은 “홈 화면에 바로가기 추가”를 통해 바로가기를 등록할 수 있지만 모든 사용자가 이 방법을 알고 있는 것도 아니고 접근성이 떨어지게 됩니다. 추가적으로 화면에 바로 들어왔을 때 아래와 같이 바로 알림이 나타난다…","html":"<blockquote>\n<p>이 글은 우테코 피움팀 크루 '<a href=\"https://github.com/hozzijeong\">클린</a>'가 작성했습니다.</p>\n</blockquote>\n<h1>바로가기 prompt 만들기</h1>\n<p><code class=\"language-text\">manifest</code> 설정을 했다면 홈 화면에 바로가기를 추가할 수 있습니다. 보통은 “홈 화면에 바로가기 추가”를 통해 바로가기를 등록할 수 있지만 모든 사용자가 이 방법을 알고 있는 것도 아니고 접근성이 떨어지게 됩니다. 추가적으로 화면에 바로 들어왔을 때 아래와 같이 바로 알림이 나타난다면 그닥 이쁘지는 않고 이게 뭐지? 라는 생각이 들 수 있습니다.</p>\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 648px; '>\n      <a class='gatsby-resp-image-link' href='/static/664fe5eb7f3ac3d5de831459a54d573b/244f0/prompt.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 54.70588235294118%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAABYlAAAWJQFJUiTwAAABuklEQVR42o1SwUobURQdXHRdcIwvk0zmvXkzTiaRkE2T1IJKAgkxCQlJIHZXiEUtrhRBXZUuuiuU7rt0K+gH+AsiuBH8A8VfON77aDUoShaHB+/dd+45514rn88jk8kglUqZ03XdR6TTaXieZ+611giC4FVEUYRcLgeLi2u1GkajERqNBrrdLprNJtrtNgaDAarVKlqtFrixlBK+778A31cqFVNjsRIm2trewnA4NOj3+wbj8RidTsfgLcJHkAuLrbDdeTsBRyThOI75yFaFEMY2vyul3ib7B6OwVCrh5PwUB98P4bkZLH1aQrlcNqTckDENmVJE6FD31eUVXN/f4PffP5Cuh3q9bsDZZbPZ19WFwRNoMEoqWGyPFRQLRcTZ2BTytOI4NmTP1an/OVKTMJGEnptHYBOSFAtb1prYfWXWhC1ysSc9k+PkECZXY4H+6GIB74++QfzYhf1zH/bGOjS5s8IwnCpwVsqqu70eijna3Y8fMHN5hrXbKyzcXeDd8S9o4bDl6abHhNw8ohgiUusXFmHvfEFi7ytm9zchPvfg00CJkC3KqSAnTknxqISApAzVnIBKOvSm8AB5b06Efu7buAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='스크린샷 2023-10-31 오후 9 46 51' title='' src='/static/664fe5eb7f3ac3d5de831459a54d573b/244f0/prompt.png' srcset='/static/664fe5eb7f3ac3d5de831459a54d573b/e7570/prompt.png 170w,\n/static/664fe5eb7f3ac3d5de831459a54d573b/f46e7/prompt.png 340w,\n/static/664fe5eb7f3ac3d5de831459a54d573b/244f0/prompt.png 648w' sizes='(max-width: 648px) 100vw, 648px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>스크린샷 2023-10-31 오후 9 46 51</figcaption>\n  </figure>\n<p>그래서 사용자의 접근성을 높이기 위해 바로가기 prompt를 만들려고 합니다. 원하는 결과는 아래와 같습니다. 바로가기 추가 안내를 통해 설치를 유도해보겠습니다.</p>\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 604px; '>\n      <a class='gatsby-resp-image-link' href='/static/fa3d5d604bb7047b8378abf9c65cf8b0/1994c/install_prompt.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 105.88235294117648%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAVCAYAAABG1c6oAAAACXBIWXMAABYlAAAWJQFJUiTwAAACoUlEQVR42p1US2/TQBDOz+HAz0CcEEhcOMBv4HEEIUQ5gJAA0R+AEBLPAxKFigMHkKjUgkBJa5S4jkniVx524sRO4riuvfuxu86WpA1C6VifdmZ29vN4ZryFYrEI3/fR6/XQ7XaFLm0J6ZP7s3GDwQC6rkPTNOEv2LYNSimazSaCIEC73YbneYKIr9zmMaZpisOO44i9TqcjznBfvV4XMVwYoYMoirC5uQlVVbGxsQFFUVAqlQQZBycxbBOO20K18Ruu76FhG6iZdTheCx1mR3GUE1qWJRSeDf8Efpi/lWd7HCnIVHmWYRii0Wig1WqhVquJ7IIwAI1TvPd/4JK2iiv1J7htvcZ14zluGC9wrf4UF6ur+DTY/kvIa8izc10XOzs7osgKW03bQpt9DmLgmfcFJ0qXcaq8ggvaQ5yp3MVZ9R5Ol+/g5PZVvOx+zQkNwxAKIUQQLxIz9qBPWkKn/JnG0SmEznyc46CGMog7M0qE/i3U8MBZwy3zFd7537HGoETTBA6RSuIjhHlwTvixX8Q59lmPmmv4HChYsd5gvf9zLuZIUxYRShllMfrpGMaeBzVycJNl+mFKSEGXJ5w9OGDE53fv462/JezsOBlyMoL8YJhFeNxcx9ZQm6vh0hkuIzyBpQj/VTfZbr5bMBnhGAl6+yG6+wFDuDzSEH42EnUtaIYOM+uiMekczNWyksQJ3GEPAYlQ0I0aXBLCiF0xJmMJsje/zvolmB3RBP1xgObQw4jEeQ1T1slRNhGdHLKgEZlMETN7IiD1Rb4h4S+KFzeF8n+aUD4XoFmuC2TTle2z4DzuUCPp7NhkJJ83fnVVKhUY7IYul8uwHVvcyMovBaZlQt1VwS+Uql4Ve//9l/mapimyLJtDkiTCL28licOD/QeRSD2be1IpzAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='스크린샷 2023-10-31 오후 9 48 25' title='' src='/static/fa3d5d604bb7047b8378abf9c65cf8b0/1994c/install_prompt.png' srcset='/static/fa3d5d604bb7047b8378abf9c65cf8b0/e7570/install_prompt.png 170w,\n/static/fa3d5d604bb7047b8378abf9c65cf8b0/f46e7/install_prompt.png 340w,\n/static/fa3d5d604bb7047b8378abf9c65cf8b0/1994c/install_prompt.png 604w' sizes='(max-width: 604px) 100vw, 604px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>스크린샷 2023-10-31 오후 9 48 25</figcaption>\n  </figure>\n<p>설치 prompt를 띄우기 위해서는 <code class=\"language-text\">beforeinstallprompt</code>라는 window이벤트를 통해 띄울 수 있습니다. 그렇다면 해당 이벤트가 모든 브라우저에서 지원하는지 먼저 확인해 보겠습니다.</p>\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/f33adb370afb9d4e76342ab4a10a5957/ff716/before_install_prompt.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 45.294117647058826%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAABYlAAAWJQFJUiTwAAAB8ElEQVR42k2QWW/TUBBGnbQgIZBoKVltx/FybcdOvGR1GlqWVFUDRUiIJ4QQPPHQZ1ohfgAIVQLEIvFrD9c3KeLh6Ju5890ZzWifpxXWVPm23OX70V3Fl/k1fq7a/H5qSTr8ee7x69Tgx6qlapeHN/n6aIfLezf4NKlwOatwkW+hnadVSt7/x3m2xcVwWxq2leljcUuh8uGG0lMi6+WfD1mVs+Q6mqXX6UhsU2LUlHaNOkZjF6O5Rq/fRm/sYDbvSHYVV7XS55g1nE4NYe6hLUYO96cuk8xnLBklQuIQiyau1fiHp7S+oSEH1+iHFqEwSKSOcxffbcmGWY2DcYOeLPQDU2kv0Bn3WwR2k1CaQreNcJv43joOJD1PV3GpV4PKoVrhezwMAuaBTc83SWSzI2GRuCahzGd5StSzeJymLPshmWywiD0e7KfMMo8i95gNA/YnkdpSm65s9l8HnJy4vBUmb+IOhy8ELwtbNjawR21eRV2OT22SA5t5bLMqugwHgtXCZRnrTHyLYRoyCG207rMuzSemXLvL+bjPWerhz03mkTSKFs6kxbuBw3Daxh3ZZLlATHXyJCAoLIqozSJ0yLMeSeSiDXxDrTGKHIpJLKfI3DWI/fKmBqlnMNhoIn0D0V6/+aXqyhfLM4V2HcfY4y9CrRKANXF3iAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='스크린샷 2023-10-31 오후 9 59 11' title='' src='/static/f33adb370afb9d4e76342ab4a10a5957/ca1dc/before_install_prompt.png' srcset='/static/f33adb370afb9d4e76342ab4a10a5957/e7570/before_install_prompt.png 170w,\n/static/f33adb370afb9d4e76342ab4a10a5957/f46e7/before_install_prompt.png 340w,\n/static/f33adb370afb9d4e76342ab4a10a5957/ca1dc/before_install_prompt.png 680w,\n/static/f33adb370afb9d4e76342ab4a10a5957/02d09/before_install_prompt.png 1020w,\n/static/f33adb370afb9d4e76342ab4a10a5957/9d567/before_install_prompt.png 1360w,\n/static/f33adb370afb9d4e76342ab4a10a5957/ff716/before_install_prompt.png 2578w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>스크린샷 2023-10-31 오후 9 59 11</figcaption>\n  </figure>\n<p>전 세계적으로 72%가 사용이 가능하다고 하지만 충격적이게도 IOS와 FireFox에서는 지원하지 않는 기능입니다. 일단은 지원한다는 가정하에 코드를 작성해 보겠습니다.</p>\n<h3>Vanilla Javascript</h3>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>button</span> <span class=\"token attr-name\">id</span><span class=\"token attr-value\"><span class=\"token punctuation attr-equals\">=</span><span class=\"token punctuation\">\"</span>install<span class=\"token punctuation\">\"</span></span> <span class=\"token attr-name\">hidden</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">Install</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;/</span>button</span><span class=\"token punctuation\">></span></span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">let</span> installPrompt <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n<span class=\"token keyword\">const</span> installButton <span class=\"token operator\">=</span> document<span class=\"token punctuation\">.</span><span class=\"token function\">querySelector</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"#install\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\nwindow<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"beforeinstallprompt\"</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\">event</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  installPrompt <span class=\"token operator\">=</span> event<span class=\"token punctuation\">;</span>\n  installButton<span class=\"token punctuation\">.</span><span class=\"token function\">removeAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hidden\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>제일 처음 접속했을 때 <code class=\"language-text\">beforeinstallpromptEvent</code>객체를 전달 받아서 <code class=\"language-text\">installPrompt</code>에 event를 할당할 수 있습니다. 그리고 이벤트 할당이 완료된다면 <code class=\"language-text\">install</code>버튼의 <code class=\"language-text\">hidden</code>속성을 제거해서 설치 버튼을 나타나게 할 수 있습니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">installButton<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"click\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">async</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>installPrompt<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n  <span class=\"token keyword\">const</span> result <span class=\"token operator\">=</span> <span class=\"token keyword\">await</span> installPrompt<span class=\"token punctuation\">.</span><span class=\"token function\">prompt</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  console<span class=\"token punctuation\">.</span><span class=\"token function\">log</span><span class=\"token punctuation\">(</span><span class=\"token template-string\"><span class=\"token template-punctuation string\">`</span><span class=\"token string\">Install prompt was: </span><span class=\"token interpolation\"><span class=\"token interpolation-punctuation punctuation\">${</span>result<span class=\"token punctuation\">.</span>outcome<span class=\"token interpolation-punctuation punctuation\">}</span></span><span class=\"token template-punctuation string\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  installPrompt <span class=\"token operator\">=</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">;</span>\n  installButton<span class=\"token punctuation\">.</span><span class=\"token function\">setAttribute</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"hidden\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>그리고 해당 버튼에 click 이벤트를 걸어서 바로가기 추가를 만든 다음에 다시 버튼을 가리는 방식으로 사용할 수 있습니다. </p>\n<h3>React + TypeScript</h3>\n<p>대략적인 흐름은 위와 같고 피움에서 <code class=\"language-text\">React</code> + <code class=\"language-text\">TypeScript</code>를 통해 어떻게 구현했는지 한번 보겠습니다. 요약하자면 다음과 같습니다.</p>\n<ul>\n<li><code class=\"language-text\">deferredPrompt</code>라는 상태 필요</li>\n<li>useEffect를 통해 window에 <code class=\"language-text\">beforeInstallPrompt</code> 이벤트 부착</li>\n<li>이벤트 핸들러 에서 <code class=\"language-text\">deferredPrompt</code>상태에 값을 set 함.</li>\n<li><code class=\"language-text\">defferdPrompt</code> 상태에 따라 installPrompt 조건부 렌더링</li>\n<li>설치 버튼에서 사용자 응답에 따라 설치 진행</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">declare global <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">interface</span> <span class=\"token class-name\">WindowEventMap</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">beforeinstallprompt</span><span class=\"token operator\">:</span> BeforeInstallPromptEvent<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">interface</span> <span class=\"token class-name\">BeforeInstallPromptEvent</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">Event</span> <span class=\"token punctuation\">{</span>\n  readonly platforms<span class=\"token operator\">:</span> Array<span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>string</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">;\n  readonly userChoice: Promise&lt;</span><span class=\"token punctuation\">{</span>\n    <span class=\"token literal-property property\">outcome</span><span class=\"token operator\">:</span> <span class=\"token string\">'accepted'</span> <span class=\"token operator\">|</span> <span class=\"token string\">'dismissed'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token literal-property property\">platform</span><span class=\"token operator\">:</span> string<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token plain-text\">>;\n  prompt(): Promise</span><span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>void</span><span class=\"token punctuation\">></span></span><span class=\"token plain-text\">;\n}</span></code></pre></div>\n<p>우선 window에 있는 <code class=\"language-text\">beforeinstallpromptEvent</code>라는 타입이 존재하지 않기 때문에 <code class=\"language-text\">interface</code>로 선언한 뒤 전역 타입으로 추가를 해야 했습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token punctuation\">[</span>deferredPrompt<span class=\"token punctuation\">,</span> setDeferredPrompt<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> useState<span class=\"token operator\">&lt;</span>BeforeInstallPromptEvent <span class=\"token operator\">|</span> <span class=\"token keyword\">null</span><span class=\"token operator\">></span><span class=\"token punctuation\">(</span><span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>렌더링이 완료된 다음에 window객체에 이벤트를 부착하겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> <span class=\"token function-variable function\">beforeInstallPromptHandler</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token literal-property property\">event</span><span class=\"token operator\">:</span> BeforeInstallPromptEvent</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    event<span class=\"token punctuation\">.</span><span class=\"token function\">preventDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">const</span> showPrompt <span class=\"token operator\">=</span> <span class=\"token constant\">JSON</span><span class=\"token punctuation\">.</span><span class=\"token function\">parse</span><span class=\"token punctuation\">(</span><span class=\"token function\">getCookie</span><span class=\"token punctuation\">(</span><span class=\"token string\">'PromptVisible'</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">??</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>showPrompt<span class=\"token punctuation\">)</span> <span class=\"token keyword\">return</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token function\">setDeferredPrompt</span><span class=\"token punctuation\">(</span>event<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n <span class=\"token function\">useEffect</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    window<span class=\"token punctuation\">.</span><span class=\"token function\">addEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'beforeinstallprompt'</span><span class=\"token punctuation\">,</span> beforeInstallPromptHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n      window<span class=\"token punctuation\">.</span><span class=\"token function\">removeEventListener</span><span class=\"token punctuation\">(</span><span class=\"token string\">'beforeinstallprompt'</span><span class=\"token punctuation\">,</span> beforeInstallPromptHandler<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>처음에 handler에서 <code class=\"language-text\">defferdPrompt</code>를 set한 다음에 다음 값을 렌더링 할 수 있습니다. 그 다음은 딱히 다를 것이 없습니다. <code class=\"language-text\">installApp</code>메서드를 통해 설치 완료시에 <code class=\"language-text\">prompt</code>를 띄워주고, 설치를 원하지 않는다면 <code class=\"language-text\">defferdPrompt</code>의 값을 null로 set 해주는 방식으로 작성 했습니다.</p>\n<p>여기서 사용자가 처음에 설치를 거절했다면 그 상태를 cookie에 저장하도록 했습니다. localStorage에 값을 저장한다면 사용자가 비우지 않는한 혹은 브라우저를 바꾸지 않는 한 영원히 뜨지 않기 때문에… 서비스 입장에서도 좋지 않고 사용자도 혹시 원할지도 모른다는 생각이 들었습니다. 따라서  일정 시간이 지나면 다시 <code class=\"language-text\">prompt</code>를 띄우기 위해서 <code class=\"language-text\">cookie</code>를 활용했습니다.</p>\n<h3>If not Support Browser</h3>\n<p>만약에 지원하지 않는 브라우저라면 (특히 ios라면) 약간은 다르게 접근을 했습니다. 애초에 홈 화면 바로가기가 지원되지 않는 상황에서 다른 방식으로 안내를 할 수 있습니다. </p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token keyword\">const</span> isIos <span class=\"token operator\">=</span> <span class=\"token regex\"><span class=\"token regex-delimiter\">/</span><span class=\"token regex-source language-regex\">iPhone|iPod|iPad</span><span class=\"token regex-delimiter\">/</span><span class=\"token regex-flags\">i</span></span><span class=\"token punctuation\">.</span><span class=\"token function\">test</span><span class=\"token punctuation\">(</span>navigator<span class=\"token punctuation\">.</span>userAgent<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">return</span> isIos <span class=\"token operator\">?</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">IOSGuide</span></span><span class=\"token punctuation\">/></span></span> <span class=\"token operator\">:</span> <span class=\"token tag\"><span class=\"token tag\"><span class=\"token punctuation\">&lt;</span>buttonComponent</span><span class=\"token punctuation\">/></span></span></code></pre></div>\n<p>아래와 같이 <code class=\"language-text\">beforeInstallPrompt</code>를 지원하는 여부에 따라 다르게 안내를 할 수있습니다.</p>\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/8d7a24fb468b405be953e92001b6c6de/fb3ea/ios_prompt.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 50%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAABYlAAAWJQFJUiTwAAABl0lEQVR42pVSSU/CUBDmp+PNH2C8eFaiF70YTbzYUAiFiKVlKXtboJZF2QtdPztDFEkk0ZdM3ryZb77ZXmK5XIJOFEX47/mKGY1GGI/HrCfW6zVc18VgMMBwOOSbhAC9Xo9ttm3DMAy0221MJhO29/t9xpCvWCzCsqwdoeM4mM/nUFUVzWaTnZIkodFooFqtQlEUvlutFjRN48BarQZd15mwXC6zz/O8fYXb7ZYzU2WdToeDZFlmUnpTS38dS2K1WjFwOp1ypYvFAmTbbDYs1AG9Z7MZ+6kA0qkAEtqB7/t7QgogYzab5VYFQUA+n+fWdUOHoirIxfa0mMar/AqtrkHMiIwhPI2EEh9USEup1+vIZDIQRZFBhUIBWjwrRVaQz0noxAspKSUm7Zkm+yuVCrrdLoIg4C5JEtQiHTJSJiIPwiAeGHD/8YJkN4VL6xnFZRtXbwJSloCVF49i7TA2DEOWb8Lf/mGEnX73LuHMesCF/QRhXsa5/YjTwS3cyD/AHSzlJ+GxLXoxgRO4ODFvkDSvEUThUcJPEaTtJZ2fcT0AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='스크린샷 2023-10-31 오후 11 19 20' title='' src='/static/8d7a24fb468b405be953e92001b6c6de/ca1dc/ios_prompt.png' srcset='/static/8d7a24fb468b405be953e92001b6c6de/e7570/ios_prompt.png 170w,\n/static/8d7a24fb468b405be953e92001b6c6de/f46e7/ios_prompt.png 340w,\n/static/8d7a24fb468b405be953e92001b6c6de/ca1dc/ios_prompt.png 680w,\n/static/8d7a24fb468b405be953e92001b6c6de/fb3ea/ios_prompt.png 742w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>스크린샷 2023-10-31 오후 11 19 20</figcaption>\n  </figure>\n<h3>Challenage</h3>\n<p><code class=\"language-text\">beforeinstallprompt</code>이벤트가 url이 <code class=\"language-text\">/</code>인 경우에만 부착이 되는 문제가 있었습니다. 저희 서비스는 로그인을 한 사용자를 상대로 바로가기 추가를 안내하고 있었고, 로그인이 완료 된다면 리마인데 페이지로 바로 이동하기 때문에 <code class=\"language-text\">/reminder</code> 경로에 <code class=\"language-text\">installPrompt</code> 컴포넌트를 렌더링 하도록 했는데 이게 잘 작동하지 않는 문제가 있었습니다. </p>\n<p>심지어 홈으로 돌아간 다음에 새로고침을 해야지 <code class=\"language-text\">prompt</code>가 나타나는 상황이 있는데, 이 문제의 원인을 잘 모르겠어서 골머리를 썩히고 있습니다. 혹시 짐작가시는게 있다면 댓글로 공유 부탁드립니다!</p>","frontmatter":{"title":"홈화면에 추가 안내 prompt 만들기","date":"November 01, 2023","update":"November 01, 2023","tags":["PWA","beforeInstallPromptEvent"],"series":null},"fields":{"slug":"/installPrompt/","readingTime":{"minutes":6.835}}},"seriesList":{"edges":[{"node":{"id":"28f1d87e-d3fc-5567-8531-57649652864f","fields":{"slug":"/sprint-idea/"},"frontmatter":{"title":"구글 스프린트 기반 아이디어 도출"}}},{"node":{"id":"4a9246fb-171b-5973-88fc-864034e78afd","fields":{"slug":"/blog-starter/"},"frontmatter":{"title":"피움 블로그 생성과정"}}},{"node":{"id":"c826ce0e-1ea7-517c-8d19-84e90a59a798","fields":{"slug":"/jenkins-setting/"},"frontmatter":{"title":"젠킨스 설치하기"}}},{"node":{"id":"a387bf4f-567f-50e7-b6a7-99a1a1c8971b","fields":{"slug":"/jpa-notnull-nullable/"},"frontmatter":{"title":"@NotNull과 nullable = false는 어떤 차이가 있을까?"}}},{"node":{"id":"a78e224b-b711-5071-8e90-013d6f4bebc3","fields":{"slug":"/pium-deploy-step/"},"frontmatter":{"title":"피움의 배포과정"}}},{"node":{"id":"ce07fbab-1ed5-5f1e-8e2f-eb430879b56a","fields":{"slug":"/fe-tanstack-query/"},"frontmatter":{"title":"프론트엔드: Tanstack Query 사용에 대하여"}}},{"node":{"id":"159c943b-1a50-57dd-aa71-7557364752a5","fields":{"slug":"/ci-cd-setting/"},"frontmatter":{"title":"Jenkins와 Github Webhook을 이용해 CI/CD 구축하기"}}},{"node":{"id":"dea45a4a-bfde-5fbb-8a97-42d3a3e77a0b","fields":{"slug":"/jenkins-hook-by-label/"},"frontmatter":{"title":"PR 라벨로 젠킨스 빌드유발을 구분하기"}}},{"node":{"id":"707f8ffb-1409-5c27-b15a-5661b235c226","fields":{"slug":"/db-drop-stop/"},"frontmatter":{"title":"Table Drop 못하게 막아버리기"}}},{"node":{"id":"1a03734e-d413-553f-9152-1dad2fc4acca","fields":{"slug":"/apply-https/"},"frontmatter":{"title":"내 서버에 HTTPS 설정하기"}}},{"node":{"id":"cecbc8b9-db00-562b-aa0b-06c406cfc44a","fields":{"slug":"/bundle-analyze/"},"frontmatter":{"title":"bundle-analyze를 통한 bundle 크기 분석"}}},{"node":{"id":"fe4b591a-4dd5-5dd2-b18a-b318afd1e9e3","fields":{"slug":"/transactional-not-in-restassured/"},"frontmatter":{"title":"[트러블슈팅] @SpringbootTest의 RANDOM_PORT 환경에서 @Transactional 어노테이션을 사용했을 때, RestAssured GET 요청이 수행되지 않는 경우(트랜잭션 격리 이해하기)"}}},{"node":{"id":"80aa708e-ef8a-5c79-9644-cb8c04d55a63","fields":{"slug":"/acceptance-test-resolve/"},"frontmatter":{"title":"인수테스트 데이터 초기화하기"}}},{"node":{"id":"15def1d5-c20f-5d07-b46e-24a14661365f","fields":{"slug":"/react-setting-without-cra/"},"frontmatter":{"title":"webpack으로만 React 설정하기 (without CRA)"}}},{"node":{"id":"66383c86-e2c8-533a-90e0-2effae572742","fields":{"slug":"/stylelint-and-husky/"},"frontmatter":{"title":"stylelint와 husky를 통해 컨벤션 통일하기"}}},{"node":{"id":"ed5951d5-beda-5a8f-adb2-07c2fcb38d5e","fields":{"slug":"/OAuth2.0/"},"frontmatter":{"title":"내가 이해한 OAuth2.0"}}},{"node":{"id":"45eeb9a3-557d-5704-8fd9-925283e1e27b","fields":{"slug":"/restdocs-start/"},"frontmatter":{"title":"RestDocs로 API 문서화하기"}}},{"node":{"id":"663b560a-734d-51a9-a6dc-3c4f50716c74","fields":{"slug":"/spring-event-apply/"},"frontmatter":{"title":"Spring Event 적용하기"}}},{"node":{"id":"55ae8038-3f65-5a59-8db3-c7405e7fc125","fields":{"slug":"/github-actions-cypress/"},"frontmatter":{"title":"피움 Cypress 자동화 구축기"}}},{"node":{"id":"503e9e71-eda3-53d7-8142-7c309faf213e","fields":{"slug":"/why_we_applied_querydsl/"},"frontmatter":{"title":"피움 서비스의 Querydsl 도입 이유"}}},{"node":{"id":"709124d0-5b05-5530-804d-e90ec9856a13","fields":{"slug":"/querydsl_apply_procedure/"},"frontmatter":{"title":"피움 서비스의 Querydsl 적용 과정"}}},{"node":{"id":"5c865dcb-cefd-58be-8968-b5edf6c8080c","fields":{"slug":"/server-logging/"},"frontmatter":{"title":"Logback을 이용해 운영 환경 별 로그 남기기"}}},{"node":{"id":"8269f166-d041-533c-9d44-332d8d8c3dca","fields":{"slug":"/server-monitoring/"},"frontmatter":{"title":"CloudWatch를 이용한 모니터링 환경 구성"}}},{"node":{"id":"0faec7ad-3bd1-5f5e-9222-115f771df8ed","fields":{"slug":"/tanstack-query-cache-trouble-shooting/"},"frontmatter":{"title":"InfinityQuery에서 fetch가 제대로 이루어지지 않는다?!?!"}}},{"node":{"id":"c77f7199-7fc6-53a3-a1fb-0792e05655a7","fields":{"slug":"/OAuth2.0-backend/"},"frontmatter":{"title":"OAuth 2.0 로그인 구현하기 (카카오)"}}},{"node":{"id":"12e4480d-386b-5d0e-bd69-4209fed36066","fields":{"slug":"/OAuth-test-backend/"},"frontmatter":{"title":"외부 API 를 의존하는 OAuth 로그인 테스트하기"}}},{"node":{"id":"ff40e109-cc92-5d83-a213-ca9d07136d95","fields":{"slug":"/aws-s3-apply/"},"frontmatter":{"title":"AWS S3로 정적 이미지 배포하기"}}},{"node":{"id":"e343af80-72dd-5173-bbb5-5069a17d1200","fields":{"slug":"/search_in_spring_data_jpa/"},"frontmatter":{"title":"Spring Data Jpa를 활용한 검색 기능 개발하기"}}},{"node":{"id":"af344dd8-ea77-5fde-9452-a97952ce60be","fields":{"slug":"/submodule-apply/"},"frontmatter":{"title":"Git submodule을 이용한 민감정보 관리"}}},{"node":{"id":"08c9daf0-2344-52a9-8c68-31ac04c24ff0","fields":{"slug":"/tomcat-thread-config/"},"frontmatter":{"title":"톰캣 스레드 설정하기"}}},{"node":{"id":"eafed74f-ff11-5af1-a589-e9dd2ccb5c8e","fields":{"slug":"/http-cache/"},"frontmatter":{"title":"CloudFront와 HTTP 캐시"}}},{"node":{"id":"dbe47289-01f4-571d-9506-fbb92016f547","fields":{"slug":"/optimize-frontend/"},"frontmatter":{"title":"피움 최적화하기"}}},{"node":{"id":"7b830fe6-e2df-564a-926e-7f7800380336","fields":{"slug":"/query-analysis/"},"frontmatter":{"title":"서비스 내에서 발생하는 쿼리를 분석하고 개선하기"}}},{"node":{"id":"37437d15-a63e-52ef-b031-6ee1bc6fa8bc","fields":{"slug":"/image-resize/"},"frontmatter":{"title":"서버에서 이미지 리사이징하기"}}},{"node":{"id":"216f4636-4125-5765-83d8-a6a610692a41","fields":{"slug":"/dont-stop-deploy/"},"frontmatter":{"title":"무중단 배포 환경 구성하기"}}},{"node":{"id":"dd095976-5a96-51b5-9686-8956dc60cd24","fields":{"slug":"/hikaricp-connection-pool-setting/"},"frontmatter":{"title":"HikariCp Connection Pool 값 설정"}}},{"node":{"id":"625ad76f-acb1-56cc-9baa-3d6f1a954ac2","fields":{"slug":"/pwa/"},"frontmatter":{"title":"PWA를 도입해보자"}}},{"node":{"id":"6a12651c-e6b8-5fa6-9c57-766772d32680","fields":{"slug":"/serviceworker/"},"frontmatter":{"title":"Service Worker에 대한 대략적인 이해"}}},{"node":{"id":"ac7012e4-5b85-5040-b65e-c068968d7979","fields":{"slug":"/web-push/"},"frontmatter":{"title":"브라우저에서 알림 구현하기"}}},{"node":{"id":"b9709447-61dc-52f0-95a5-8670a3fbaaf4","fields":{"slug":"/installPrompt/"},"frontmatter":{"title":"홈화면에 추가 안내 prompt 만들기"}}},{"node":{"id":"09501eea-fa70-5c42-9ee1-f25a5ab08bb5","fields":{"slug":"/pium-apply-pwa/"},"frontmatter":{"title":"피움의 PWA 적용기"}}}]},"previous":{"fields":{"slug":"/web-push/"},"frontmatter":{"title":"브라우저에서 알림 구현하기"}},"next":{"fields":{"slug":"/pium-apply-pwa/"},"frontmatter":{"title":"피움의 PWA 적용기"}}},"pageContext":{"id":"b9709447-61dc-52f0-95a5-8670a3fbaaf4","series":null,"previousPostId":"ac7012e4-5b85-5040-b65e-c068968d7979","nextPostId":"09501eea-fa70-5c42-9ee1-f25a5ab08bb5"}},"staticQueryHashes":[],"slicesMap":{}}