{"componentChunkName":"component---src-templates-post-jsx","path":"/transactional-not-in-restassured/","result":{"data":{"site":{"siteMetadata":{"title":"pium.log"}},"markdownRemark":{"id":"fe4b591a-4dd5-5dd2-b18a-b318afd1e9e3","excerpt":"이 글은 우테코 피움팀 크루 '하마드'가 작성했습니다. 개요 우아한테크코스 5기 피움 서비스의 인수 테스트를 작성하던 도중, 실제 포트에 애플리케이션을 구동시켜 테스트를 하는 \n환경에서 테스트를 할 때, 테스트 메소드에서 분명히 해당 리소스를 저장했는데도 RestAssured의 GET 요청이 수행되지 않는 경우가 있었다. 이 이유를 파악하고 해결 과정을 …","html":"<blockquote>\n<p>이 글은 우테코 피움팀 크루 '<a href=\"https://github.com/rawfishthelgh\">하마드</a>'가 작성했습니다.</p>\n</blockquote>\n<h2>개요</h2>\n<p>우아한테크코스 5기 피움 서비스의 인수 테스트를 작성하던 도중, 실제 포트에 애플리케이션을 구동시켜 테스트를 하는 <code class=\"language-text\">@SpringBootTest(webEnvironment = SpringBootTest.WebEnvironment.RANDOM_PORT)</code>\n환경에서 테스트를 할 때, 테스트 메소드에서 분명히 해당 리소스를 저장했는데도 RestAssured의 GET 요청이 수행되지 않는 경우가 있었다. 이 이유를 파악하고 해결 과정을 정리한다</p>\n<h2>상황</h2>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 612px; '>\n      <a class='gatsby-resp-image-link' href='/static/3b1906144ab7bcc604f65124969f17bf/dbf98/img.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 44.11764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABP0lEQVR42pWS23KDMAxE+ZiG4gu2DAbiQJnc89L//53tGtKmfWg7eTgjIewdeaVimkpM0wbz2wZ994q69sTBuUzODbxXEFGMGs7X8BKYe9bCck6cwBPHe8VlLnGg4GV+wTwL9ucb5sMJ+9MVaZwRgkFKJcZdiaEv0Q9hqfdDwnY3IcYBqR0xtAmx6VE0uQNrEUzupIE0kSKMxLKutYFS9huaVEStUasvNCm0NYidUMDyeRVbVzBG86dmNAvWrjy+7ZrfozV2IeeFdxrHqcJ+8kjbCsNQ0guzdPYp8AyFzU+1NLrOT3QsZuyji2cF8xS73qONDqElQVBVq0c6o/Ud9cOGXwWFq3DmlN8vGrejo589p8eppZGT3KLj5MQHRIlom4a+/SO47Br9ElcjeFknzP3KLPt23y/Pc8Ldy1b8xQePMxWKeSYlywAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img.png' title='' src='/static/3b1906144ab7bcc604f65124969f17bf/dbf98/img.png' srcset='/static/3b1906144ab7bcc604f65124969f17bf/e7570/img.png 170w,\n/static/3b1906144ab7bcc604f65124969f17bf/f46e7/img.png 340w,\n/static/3b1906144ab7bcc604f65124969f17bf/dbf98/img.png 612w' sizes='(max-width: 612px) 100vw, 612px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img.png</figcaption>\n  </figure></p>\n<p>당시 다음과 같은 인수 테스트 환경에서 테스트를 수행하고 있었다. 각 테스트 메소드가 끝난 후 트랜잭션을 롤백시켜 격리를 보장하기 위해 클래스 레벨에 <code class=\"language-text\">@Transactional</code> 어노테이션을 선언했었다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/ca7f5b43bee99b38af5cf3a2048a5422/be814/img_1.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 81.17647058823529%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB+ElEQVR42pVU2W7bMBD071jiLVLULUpy4iRI0P//mukuZddtUNTqw0DwYjmag/IphIixqzDNLYaxgQ8edeXg65oQYayDUQpKlCjL5zi5UMNaheANtHHQ2kBJAS01lNIQpUBRFCjKo4SkwlqBGEo4Z3dF1kIrQ8psJi4PkmXCykdUVqIOBtYFCKlwPhc4kyp+/g/ZjbCGlBLeiWzbGUXqBKwh20rui2z5hqeEnkphQmdKNMGSdUPkGtFRrhSBFFQIl6J13jtUihCCljV87BC7gTAihBa+iqQ65qK0IWjOs3hCSJYFv5nscKttP1KWVA6pFLLMRFyUpGwPWb4T8jI/h3FCoOad96h8oBvgcpZH7P5RSil2NW3bIjZkl6JgOEeE8n5AHMkwUoYyq+OsQmzR9AO6dkRqVzRtj5ow9QumdqF8O1Ks/6GQCNkSF8O269hgXDZs6xs+lx9I2wvGtGJZX3FNH9i2N/QD5WxsPvMdJ7Zl6e6xbR6w3XFZsS5XfKQvpHUnnAivCxGma/7Ne0ru2f6OvRSxB84KQ91gSAuW9Ir3+RMzEU6kuJtmrDR7md4xs+p52a9R8RfL9wZ3woieDs/zBVc6PNDBKW3ox5nmCWm6YB42pHTJL2Kllr99Q38mWj1avmdQCvGrUSkeV0Xc5vkj+DYX4tH+T70P9csXQSMNAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_1.png' title='' src='/static/ca7f5b43bee99b38af5cf3a2048a5422/ca1dc/img_1.png' srcset='/static/ca7f5b43bee99b38af5cf3a2048a5422/e7570/img_1.png 170w,\n/static/ca7f5b43bee99b38af5cf3a2048a5422/f46e7/img_1.png 340w,\n/static/ca7f5b43bee99b38af5cf3a2048a5422/ca1dc/img_1.png 680w,\n/static/ca7f5b43bee99b38af5cf3a2048a5422/02d09/img_1.png 1020w,\n/static/ca7f5b43bee99b38af5cf3a2048a5422/be814/img_1.png 1199w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_1.png</figcaption>\n  </figure></p>\n<p>AcceptanceTest 클래스를 상속받아 사전 식물의 조회를 테스트하는 인수 테스트를 작성했다.\n37번째 줄의 <code class=\"language-text\">DictionaryPlant REQUEST = dictionaryPlantSupport.builder().build();</code> 는\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/7769cb4beb02f5aecd8ee8bd8c479f8d/d8785/img_2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 114.70588235294117%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAXCAYAAAALHW+jAAAACXBIWXMAAAsTAAALEwEAmpwYAAACO0lEQVR42p1V2XLbMAzM51giCfCW6CNxmqOd6bT//zdbgJYzidvEch92SI+lJbC7oO5irng8WsGANlvEOGAcFSOMMTfjLs0TjvcFz8eMl9c92nZCSAk+BCE1GM3YyTvM9UPuYqkg5xCdAckL7EMnVOieiQUenkJfrbFfE4ZUwUyYEiN6RggRISakFJFiAAkJn+FYCK9VKBoSOVRvMOeIaW5ouwO22xm7VmGdvbFlIXREcPIiWQNnLazAWHfCraYoIQthjQpGYnE65Y6UM4hZHhxvcLloWw6BDEqgriE7Wto0b+3eVKGV1jxZBDHFsYivkL33rldIfN3ddxVOUiHBuxGHzNiJKWqMVprj4rqg67qe0HVSVmPMgGEYsBk2At1v+uSsbrlMrZMlNmglIFepsM7Y1iS5jJIA36tbq+NbhfqDpe2SCrbtgP3uoa9ZJsZJTkkO/VfbdonZ+b8PhMbY3p7O8ePzd0wS7FRk7JKXGEVZZfwCnxAXLHt9xrG7JDzFxIsJD08vyHPp1ZnlklgZm0mm5CMhe4/74xOm3dxPVsL1OSyfED4+Y/9wRBSj1kamE2YhrIn6jUM60xLyXCtef//Ct58/UA9yP+aTdl710qATfYquoVscPEMvi1gKamuoGnRZWcaSPP317CVOo+cub5URw0ZCvdlgbnKLH7YIlZFb6CP5laYnl5dr6qyVaqo6GtFzajsU+UxQkHmXG6m7fi3YSnCGmqIVa3Tsu0N6VSumpROq0JdO/u9X7w+6HMK31cY5UAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_2.png' title='' src='/static/7769cb4beb02f5aecd8ee8bd8c479f8d/ca1dc/img_2.png' srcset='/static/7769cb4beb02f5aecd8ee8bd8c479f8d/e7570/img_2.png 170w,\n/static/7769cb4beb02f5aecd8ee8bd8c479f8d/f46e7/img_2.png 340w,\n/static/7769cb4beb02f5aecd8ee8bd8c479f8d/ca1dc/img_2.png 680w,\n/static/7769cb4beb02f5aecd8ee8bd8c479f8d/02d09/img_2.png 1020w,\n/static/7769cb4beb02f5aecd8ee8bd8c479f8d/d8785/img_2.png 1021w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_2.png</figcaption>\n  </figure>\n다음과 같은 형태로 repository에 테스트용 엔티티 객체를 save하는 과정을 간편하게 하기 위해 작성된 DictionarySupport 클래스와 코드이다. 즉 37번 라인을 사용하면 임의의 객체 정보를 dB에 저장하는 insert 작업이 일어난다.</p>\n<p>즉, 현재 테스트 메소드는 repository에 사전 식물 객체를 저장하고, 이를 RestAssured를 활용하여 실제 서버에서 요청을 보내 저장된 사전 식물이 조회되는지를 확인하는 과정이다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/f2b0fbb841ccdb7ac66fbb5af7d00017/5205e/img_3.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 62.35294117647059%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABjklEQVR42p1T2XKCQBDkaxKVaxeWS1ZQIgSjVpL//5hJ9wrEVMWH5KGrB4bpOfHquhZrrZRlKUVRiFJKoij6gTiOHWgHQSC+7zt7/vbe51GsaRpp21byPHeOzWbjggja93j0fvZ5qTFigCzLloxhGC6Bf4UXIVhDKIaQ1tqBov8WrBHcAGSDGaSAmuYUPMLk/1VwnyTygpbJdRTLLlZSco5wPmEuz8DqDmtivV7mNtuLYJWm8ortjpjhHq13SgNKDuBe32wLrgCLpNu8kLKqhLPnzDkiVvy9FDz0cFyTVEadyDsSfKQGbBx/IvCS3jDiCjok3+HELBnCW9gU5+m4szFob4DQlZWCL2CKXpDgLZneo/pDlotFMMX2ENpBvFC4z8B3S1WwXYUGWz6i7BOCh4nPFIPQaeKBlUGkRVUW4i2ejSnkWZeyUuDISKgSSfGtl6NUtsqWWekIQYqwpZwC+JOOfS9d17mZcQnhvOkgXBA4oOXMtaydKFseJ1HijGoGtDiiuiNmyAsopgt4dDZfOs56o8n5OYsAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_3.png' title='' src='/static/f2b0fbb841ccdb7ac66fbb5af7d00017/ca1dc/img_3.png' srcset='/static/f2b0fbb841ccdb7ac66fbb5af7d00017/e7570/img_3.png 170w,\n/static/f2b0fbb841ccdb7ac66fbb5af7d00017/f46e7/img_3.png 340w,\n/static/f2b0fbb841ccdb7ac66fbb5af7d00017/ca1dc/img_3.png 680w,\n/static/f2b0fbb841ccdb7ac66fbb5af7d00017/02d09/img_3.png 1020w,\n/static/f2b0fbb841ccdb7ac66fbb5af7d00017/5205e/img_3.png 1222w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_3.png</figcaption>\n  </figure></p>\n<p>그런데, 200 OK를 기대했던 테스트의 결과가 404 not found가 응답되고 사전 식물이 존재하지 않는다는 예외 메세지가 뜨는 것을 확인하게 되었다.</p>\n<p>뭘까? insert 쿼리가 날아가지 않은 걸까? 로그를 확인해 보았다.\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/53bd1215f3b30f53aa9578bb03b24e6d/cd35d/img_4.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 27.058823529411764%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAs0lEQVR42m2PaxKDIAyEvU5FQ6C+EXS8/522LpbW6fTHNyQ7ybKpvPfo+x6qCuccrLUQkQzr31710vTGpWueqeZ5RggB67piGIbMNE1YliUP8EPW1MYT9U/IuWwaudHCGJOpUkrYtg3HcWAcx7y873vu+SvTs97PmRATanGoW4eHFDxMK1/DGCNoShMaMnHpeUrXdbmmxivUCpqGy/VF/X6LIdOVhOXUfwk5Q307UXUfg19eAqWgtd77uY4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_4.png' title='' src='/static/53bd1215f3b30f53aa9578bb03b24e6d/ca1dc/img_4.png' srcset='/static/53bd1215f3b30f53aa9578bb03b24e6d/e7570/img_4.png 170w,\n/static/53bd1215f3b30f53aa9578bb03b24e6d/f46e7/img_4.png 340w,\n/static/53bd1215f3b30f53aa9578bb03b24e6d/ca1dc/img_4.png 680w,\n/static/53bd1215f3b30f53aa9578bb03b24e6d/02d09/img_4.png 1020w,\n/static/53bd1215f3b30f53aa9578bb03b24e6d/9d567/img_4.png 1360w,\n/static/53bd1215f3b30f53aa9578bb03b24e6d/cd35d/img_4.png 2035w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_4.png</figcaption>\n  </figure>\n그러나, 로그에는 정확히 우리가 DictionarySupport에서 지정한 저장 메소드의 Insert 쿼리가 날아가는 것을 보고 있었다. 심지어 value 값도 모두 정확히 들어갔다.\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 342px; '>\n      <a class='gatsby-resp-image-link' href='/static/294f14641caf877174683d3cedcc9f93/28260/img_5.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 161.76470588235296%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAgCAYAAAASYli2AAAACXBIWXMAAAsTAAALEwEAmpwYAAACQklEQVR42p2WWZaCMBBF3YwjCs7zPKHufz/V3LSPk0agwY8cSEFuXg0paIzHY4vvd7vdbnY8Hu1yudhoNLJer2dBENQejSiKLAxDm06nDna9Xm0+n1un0/kK2ggTYLfbdVBAm83GttutoXw2m1m/368FdkBNWq2WTSYT5zrQ8/ns5oPBIB2VgCiQElTt93tbrVZuKAyHw8Gp/09tCgwSIK4TSxYDU5K4B/Z4PFwoyqB/FAJEIa7iMmDud7udU8mIJKAqUApRhDqAhCCO45ouJ5M8l5/Pp63XawerUp+5QBQBOZ1OruC1geJZOyk+EJdJBjHFbeBfJ0VAVGFXKVWuQwFRgUJcvCfnnILmmcZXSSEJXKVSz79OCkCyLChz7Mw59zSPWkBiBQgoAxtKCQOFXnRiCpNCDHVCtAF2NsG+WCzqJUUKSQoK2YDyAdput9M1lVwWQAnhhPCM9iYY87w4FhZ2notspLpU88iqLG1fLCaGSgRwQMvl0nV3NiHjfnJygSzEZRSpuQIE5n9r8uryIynsDIi6IyEAUaISAo7t9Xq5d7InpzApvAxEan2VKnDshQqzSfEbLDEDIAg21BPnUoX+R0oLUYvL2GRnI/okm5fGkBrjSMllKVT3ltvY9In9UBi9P/TD4dA1UBZSwNjYgKEiVoaxFf1ZfLisOkQJV9zEZf+exFANeb0xBVKgvEyMGIBxFRtxJTHcExJghd1GLnNe1VnUoVngn1vZyhrt77/N+2Gz2Uz/wvzWxTOSltddssAftxr30AJmABEAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_5.png' title='' src='/static/294f14641caf877174683d3cedcc9f93/28260/img_5.png' srcset='/static/294f14641caf877174683d3cedcc9f93/e7570/img_5.png 170w,\n/static/294f14641caf877174683d3cedcc9f93/f46e7/img_5.png 340w,\n/static/294f14641caf877174683d3cedcc9f93/28260/img_5.png 342w' sizes='(max-width: 342px) 100vw, 342px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_5.png</figcaption>\n  </figure>\nselect 쿼리가 잘못된게 아닌가? 확인해봤지만 예상한대로 나갔다.\n여기까지 봐서는 이해가 안 간다. insert를 하고 select를 했는데 조회가 안 되니 말이다.</p>\n<h2>RandomPort 환경에서의 스레드와 트랜잭션</h2>\n<p>이를 이해하기 위해서는 RandomPort 환경에서의 요청이 어떤 스레드를 갖는지를 알아야 한다. 이 내용은 스프링 공식 문서를 들여다볼 필요가 있다.</p>\n<blockquote>\n<p>If your test is @Transactional, it rolls back the transaction at the end of each test method by default. However, as using this arrangement with either RANDOM<em>PORT or DEFINED</em>PORT implicitly provides a real servlet environment, the HTTP client and server run in separate threads and, thus, in separate transactions. Any transaction initiated on the server does not roll back in this case.</p>\n</blockquote>\n<blockquote>\n<p>테스트에 @Transactional이 붙어 있으면 롤백을 보장할 수 있다. 단, RANDOM<em>PORT 나 DEFINED</em>PORT 환경에서 테스트를 수행하면, 실제 서블릿 환경에서 테스트를 진행한다. 이 때 http 클라이언트(테스트)와 서버는 서로 다른 스레드를 갖는다. 즉 별개의 트랜잭션이 수행되는 것이다. 따라서 서버 쪽에서의 트랜잭션은 롤백되지 않는다.</p>\n</blockquote>\n<p>쉽게 설명하자면, 랜덤 포트 환경에서 테스트를 수행하는 순간, localhost 포트 어딘가에 내장 서버를 띄운다. 그리고 그 서버에서 요청을 보내도록 하는 것이 RestAssured 이다. 따라서 RestAssured에서 보내는 요청은, 내가 해당 테스트 메소드에서 실행하는 스레드와 별개의 스레드를 갖는다. 따라서 트랜잭션도 각자 별개로 갖는다.</p>\n<p>자, 아까 우리가 AcceptanceTest의 클래스 레벨에서 <code class=\"language-text\">@Transactional</code>을 선언했음을 기억할 것이다. 클래스 레벨에 이 어노테이션을 선언하면, 자동적으로 해당 클래스와 그를 상속한 메소드 레벨에 모두 트랜잭션이 걸린다.\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/d6076111fb8289c4122ae2aa222c682b/95234/img_6.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 63.52941176470588%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAACCElEQVR42o1Sy3KcMBDcD/HBr6rdBYQQC0KABAj2ETu2kzjH5JBUKofccs7Pd1qsfVvX+jBISKOe7p5ZmDJCXUg0pYTOBeoyRcV/IQTiOEaSJFgx9HqN71dXWHKf8Dx+IxZK5TC1QVVp6BBFQUCNYqORqwJ5vkG6KTAw+e/FxXlAKSUKXcG0DlXdQpsGWZYjJ0iapkyKEBFEMvnh9vY8YEQpMlMwjUWSJhBScKVUEUORXQBOCKyY9/Xm5h2A0RqZUvDjFnVrUVYGWpt5zWQKmYqZoYoiPL8HMJiuyLDSJQr6pzYbZHnOlfvAmAWXDLle4cv1NZahUec8VASoG4fGOa4t+sqjNmRr6tlX13j4yuFb8DTLEJPtm4Dhs6Y/hkBumDCMezyNz9hN9+inHXpaMY53+DQ84HfVwnTDrCQoOw3Ii4gVNT0LHra2x95+QGc9O2/nZrXO49BM+JGXKFk4o6rkZU5PMDwC1hybzk/w0x6P/jO2ZDXu79CRtSPTx+EefwqL7nDPnB0UGxmUBZDwPnqxYfF6ELyylNP1Iz4OTxiHPQtsacOIhudTP+Fn4WD9DqPfo7HdcVbJNoTgNAiRYCFEOv9oY2Z5DZlO7Q627fnIUW6HgsUOtORflFKJh+OddQPvepRaz/MaGEs2bCHTUOGIHow+FRH9qinv1+UlVtwnSXwiL5wJ/AedCZ3HwfdnegAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_6.png' title='' src='/static/d6076111fb8289c4122ae2aa222c682b/ca1dc/img_6.png' srcset='/static/d6076111fb8289c4122ae2aa222c682b/e7570/img_6.png 170w,\n/static/d6076111fb8289c4122ae2aa222c682b/f46e7/img_6.png 340w,\n/static/d6076111fb8289c4122ae2aa222c682b/ca1dc/img_6.png 680w,\n/static/d6076111fb8289c4122ae2aa222c682b/02d09/img_6.png 1020w,\n/static/d6076111fb8289c4122ae2aa222c682b/95234/img_6.png 1079w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_6.png</figcaption>\n  </figure>\n따라서, 현재 테스트 메소드의 트랜잭션 범위는 다음 화살표와 같이 테스트가 끝날 때 까지 유지된다.</p>\n<p>우리는 여기서 트랜잭션의 개념에 대해 다시 짚을 필요가 있다.\n\"트랜잭션이 끝나지 않았다\"는 의미는 무엇인가?\n내가 수행한 insert, update, delete 문이 커밋, 혹은 롤백되지 않았다는 뜻이다.</p>\n<p>커밋되지 않았다는 뜻은 무엇인가?\n데이터베이스의 갱신이 이뤄졌어도, 다른 스레드에서 확인할 수 없다는 뜻이다.\n왜? 트랜잭션은 각자 격리되어 서로의 트랜잭션이 끝나기 전 까지는 연산 과정을 볼 수 없기 때문이다.(트랜잭션의 Isolation(격리성) 특징을 기억하자)</p>\n<p>따라서, 현재 트랜잭션이 끝나기도 전에, 즉 반영되기도 전에 RestAssured를 통해 띄운 별개의 서버 스레드에서 GET 요청이 들어가니 해당 데이터를 확인할 수 없는 것이다.\n정확히 말하면 트랜잭션이 커밋되지 않았을 때 까지의 데이터는, 다른 스레드 입장에서 그냥 없는 데이터다. 없는걸 조회하니 당연히 값이 안 나온다.</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/ceb0b6e59d5718b93c731d3ca7bb2780/6b882/img_7.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 48.23529411764706%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABRklEQVR42qWS7U7CMBSGdzms+4xrYV27dRvocHyJQYKoP9QQvf8beD10RDRBEvXHk+esSU/fs9ZpV/cY325wdbPG5eIOzZI8X0GPWqjhGGY8p3pCdQtZXyMtm7M4evaI6fYNk80O5ewB5XQL2axRzJ6QFiPEoYcoDOF7DAHhey585h79FVpzouYZavGKcrmDnncW7Qvk4h08bzAQCbjUYIlEL+KEQC8ekPud471TCwtjSpgrqFwj00drcm5yJDxBJiV0UeCCC3h+YGGfDm3dOaQ1H44yFVRZf8fU0NUIiehDKYXSGGufNnied5au4Ql0NbSppExR1zU45wgCSsOY5fcNy6FNyJOEmkrbLKTLiaLI+s8JhRAwh5EL+pf773805PbJZFkGrTWqqkIcx3DdHm1mJ3Fkbn4YuYYYpN2o+zEPBHTAOT4Av3tJV9XHv5kAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_7.png' title='' src='/static/ceb0b6e59d5718b93c731d3ca7bb2780/ca1dc/img_7.png' srcset='/static/ceb0b6e59d5718b93c731d3ca7bb2780/e7570/img_7.png 170w,\n/static/ceb0b6e59d5718b93c731d3ca7bb2780/f46e7/img_7.png 340w,\n/static/ceb0b6e59d5718b93c731d3ca7bb2780/ca1dc/img_7.png 680w,\n/static/ceb0b6e59d5718b93c731d3ca7bb2780/02d09/img_7.png 1020w,\n/static/ceb0b6e59d5718b93c731d3ca7bb2780/6b882/img_7.png 1270w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_7.png</figcaption>\n  </figure>\n그래서 <code class=\"language-text\">@Transactional</code> 어노테이션을 제거하고 테스트를 수행했더니, 다음과 같이 통과하는 것을 볼 수 있다.\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/539d3abcceb71f6a558289e0848ac19d/adc5a/img_8.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 65.88235294117646%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAANCAYAAACpUE5eAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB5ElEQVR42o2TWXLbMBBEdZpEXACCBMANJMBdtuQ4qdz/Lp0ZWJU4VbGcj+EGqPF6enRyvUBrFVpToFI56krAVhJCCqRp+lclWRYre1CnUgk0tUFjK9TWkJhCU2kS1yiLCpU2UFSdlJi+fkF/PkPyAR8JCllA2wZtN6DpHOq2R1kaaG2hVPm2Mc9R0r1KEogsRf6IkC9FoTD4CZUhMqtRlAWkohYYGwkl0TFR+ondKMi9YYLejTDWolAqkqmyjEJSCOS0nv2HWBTkzbIo0PYD2SbLTUfCNWzbUQ8FZJbgTFaTNEGapJ8LMkVJIdRNG8U02Wx1D6vraFcTdWt7NKajdx1po6tHPTxTciw2rQfm7cDr+hNP2yum/RK/7dsN1+U71u0Zzgc61HzYhlN2P5HJOupjN3gc4zOmcaPnEa0bMIwTVnfA+xVd7yhE+UCQh5V6xIRh3hCWHS/zD+zzFfP+hHFa4JcNl+WGy3SL1IHeSwotIWf5v0JJSZCDcETiaHyu4RvWcGCcF4xhRj8GhLDh8Ff4sCJMWwxQ0UTwFAieBJFH6lP+zjInzbZXt8M7FvJ0SIg/bum7cx5jP2GkNT6Y14ypibaiMVNxzE78n2VUFv5d2Z9ncZ/DtyIaquzd3miVU78n/wtNaJuLDpSLtQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_8.png' title='' src='/static/539d3abcceb71f6a558289e0848ac19d/ca1dc/img_8.png' srcset='/static/539d3abcceb71f6a558289e0848ac19d/e7570/img_8.png 170w,\n/static/539d3abcceb71f6a558289e0848ac19d/f46e7/img_8.png 340w,\n/static/539d3abcceb71f6a558289e0848ac19d/ca1dc/img_8.png 680w,\n/static/539d3abcceb71f6a558289e0848ac19d/02d09/img_8.png 1020w,\n/static/539d3abcceb71f6a558289e0848ac19d/adc5a/img_8.png 1068w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_8.png</figcaption>\n  </figure>\n이해를 쉽게 하기 위해 바뀐 트랜잭션의 범위를 화살표로 표현하면, DictionaryPlant를 저장하는 과정에서 트랜잭션이 끝나고 커밋이 되어 db에 영속화가 완료된다.\n따라서 이후 랜덤 포트의 스레드에서도 해당 데이터를 조회할 수 있다.</p>\n<h2>트랜잭션의 격리 이해하기</h2>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/4f297df537bbdf2952dc4a88a14279c2/bb51b/img_9.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 31.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABKUlEQVR42pWQ2W6CYBCFef+3atKkjbF1A5X152dREGRxAeHCr6NJm3jZk0xmO3NmMsa16+me1lEXJaHr4fkKO1L4WhNFCUEoPk5ROkaFEV6knz0l9UBJL0kJo5gk3WEUh4yyyCiqI73EVx1walusc8iuzmjrmizfczo35OLPdYWqRLiIORYHDjJzubacu5ZaekYZWxyzJSvPY2FO0OGM/c7G207Yrj/w3LnULJbuO475Rq6XxNEKz5kSKotYb3DsCYG/INuHGHUp5/sBruuSZXvZmMvGC/Z2JsRvzNUnrjNns5lK7UvEHcryyO3WMQyD2I2+7yTvGcdBLiwSIZtY1pqmaUSwoKoqIfU8cL/fn/aL15gXPHJDp7k8VpGmqfwof4qN4/gn+F/8AJlXwUVIVOQyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_9.png' title='' src='/static/4f297df537bbdf2952dc4a88a14279c2/ca1dc/img_9.png' srcset='/static/4f297df537bbdf2952dc4a88a14279c2/e7570/img_9.png 170w,\n/static/4f297df537bbdf2952dc4a88a14279c2/f46e7/img_9.png 340w,\n/static/4f297df537bbdf2952dc4a88a14279c2/ca1dc/img_9.png 680w,\n/static/4f297df537bbdf2952dc4a88a14279c2/02d09/img_9.png 1020w,\n/static/4f297df537bbdf2952dc4a88a14279c2/bb51b/img_9.png 1320w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_9.png</figcaption>\n  </figure>\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/3ceedd46236c90d9fb1d34efce28e1ad/bb51b/img_10.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 31.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAGCAYAAADDl76dAAAACXBIWXMAAAsTAAALEwEAmpwYAAABK0lEQVR42pWQWW/CMBCE8///VaVKrRAtZziSkIOQ2M5JCCSQB74uSK3EY0ca7eHZWdvWpevphJeu41TVJOGecH/AVwf2aYrShjh5xEyiIkk1sdZESfLsH1L1PFMm49i0WHmmKXJNXpX0kl8in1PTYLchaa1p6hptFKf2SGZS2roiqGKCPKbMMzKZOV9OtF1DXZdYRWxT6jkLz2O2HBGFE1S6xduM2Kw+8Nyp9Gzm7jvO8g0TzYn3CzxnTBjYxNEaZzvC383QKsSqi4jdzsd1XbRWstHIxjPbzUSE3ywXn7jOlPV6LL0vMXcoipLrteN2uwmv9H0ndc8w3OSG+UHES2x7xfEoz8pyqqoSUc8D9/v9yV+85rzgUVtRYvCDgEQ+2RjzNBuG4c/wv/gBd/7CXiOatnUAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_10.png' title='' src='/static/3ceedd46236c90d9fb1d34efce28e1ad/ca1dc/img_10.png' srcset='/static/3ceedd46236c90d9fb1d34efce28e1ad/e7570/img_10.png 170w,\n/static/3ceedd46236c90d9fb1d34efce28e1ad/f46e7/img_10.png 340w,\n/static/3ceedd46236c90d9fb1d34efce28e1ad/ca1dc/img_10.png 680w,\n/static/3ceedd46236c90d9fb1d34efce28e1ad/02d09/img_10.png 1020w,\n/static/3ceedd46236c90d9fb1d34efce28e1ad/bb51b/img_10.png 1320w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_10.png</figcaption>\n  </figure>\n해당 동작에 대해 조금 더 설명하기 위해 별개의 스레드에 h2 database 콘솔을 띄워 확인해 보겠다. 위의 두 콘솔 화면은 세션 id가 다른 별개의 스레드를 갖는다. 편의상 위를 스레드A, 아래를 B라 하겠다</p>\n<p><figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/dd9a54c5ddfb5b0d712987298da827f7/bb51b/img_11.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 61.1764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAAB2UlEQVR42p2S627aQBBG/f5PVLWVWlVVGlLCJQHHXGyv1/cLYEJsAwmcjEFp/iRN1ZGOvLMz++23Ixt1XVPXDZWwXq4IPY3nhziRjw5DojjBDyPiJCWIYsIwRsdCFBHI/qmWZoTSl2Y5RpEl5FlMvizY5gmVdtis15gbj7hMWa+WIhax2ZRkacxGcrX08RYhq0VBUWQ0zQPV7p6yXIlgYFKmI0aOw615TaBviKMp9qTLdHKFp0x832I4/8ls9INUj/D1mKl1hW2PpH7HxOpgzwckscIoFx5KebjKJREneZZSVQ8M+xcMfn+nc/GF8W0Hy7oWkS5aTSkWC3a7hv1+d6JparbbRva2GFmiGA569PsDsV8QyWwWciCS+SVaEyhFnufsdzs5tKVpac7fU940HI9HXsJQYYbjuARBQCzDbsUeHx/FsUJ5HnPbFncWrutKn8NsNjsxmUxOmKYpLvevggdRb284HA48PT39WddVLeW2djjtnV28OjnHOX+ptxi8Ea1w+5T/iTcFW4dp7LEsNHmqZe0Qh478QsmHGG/fc6TX7fH50yXdziXfvv7ipnfJ/XIu2H/lXUHtjplbPZLQkkaPaq15KL0PMd6bhecMKZI7mo0WMSXN/8Yzt32JpfyIHOcAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_11.png' title='' src='/static/dd9a54c5ddfb5b0d712987298da827f7/ca1dc/img_11.png' srcset='/static/dd9a54c5ddfb5b0d712987298da827f7/e7570/img_11.png 170w,\n/static/dd9a54c5ddfb5b0d712987298da827f7/f46e7/img_11.png 340w,\n/static/dd9a54c5ddfb5b0d712987298da827f7/ca1dc/img_11.png 680w,\n/static/dd9a54c5ddfb5b0d712987298da827f7/02d09/img_11.png 1020w,\n/static/dd9a54c5ddfb5b0d712987298da827f7/bb51b/img_11.png 1320w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_11.png</figcaption>\n  </figure>\n스레드 A에서 트랜잭션을 시작하기위해 Autocommit을 False로 변경한 후, 두 명의 member 데이터를 insert 했다.\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/84f758604ced9d204da78e6b1297ec26/bb51b/img_12.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 61.1764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABsElEQVR42p2S627aQBBG/f6vFCmq0qa0KmBIXRIgvt/XVwzYgDAnQ4r6i1ApIx1pdnb1zbe7o7VtS9t2bIVVWRG6Hq4fYkU+XhgSxQl+GBEnKUEUE4YxXixEEYHU3/dSRSjnUpWh5SohUzFZmbPLEraexXq1YrZ2ieuUVVWKWMSqqVBpzFrWTunjFiFVkZPniq7bsN031HUlgsGMOjUwLIvfsxGB90QcLTAXQ5YvP3GdmbhaYNgDln8eUJ5B4Bss57+wTEP2n5nLOfN1QhI7aHXh4jgutmOTiBOlUrbbDfr4kYn+jcH3O0ajB8ajr8yfhzj2C1mWiauW3W4ndJe8Y7/foanEYToZo+sTsZ8TydsURUGapjRNIw2U5IqqqjjH6XR656PQnFBhWTZBEBDLY5dlyeFwkK4dnwmtv3Ts+57j8fg3P/Zy7e3ZjtSPF/p/7m6hXetyFv60w2vFs5vzj+XKJUtdksgiDi0ZoeS/aNf7nJjqU77cy2eNhtzfDXjSf9CUr4J5k+uCpx7ft1ksTFYy5Jbtsm4yNrUjuDf50KG5nIrLR7m2zGckzirvInibN7s0jkTeQnWyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_12.png' title='' src='/static/84f758604ced9d204da78e6b1297ec26/ca1dc/img_12.png' srcset='/static/84f758604ced9d204da78e6b1297ec26/e7570/img_12.png 170w,\n/static/84f758604ced9d204da78e6b1297ec26/f46e7/img_12.png 340w,\n/static/84f758604ced9d204da78e6b1297ec26/ca1dc/img_12.png 680w,\n/static/84f758604ced9d204da78e6b1297ec26/02d09/img_12.png 1020w,\n/static/84f758604ced9d204da78e6b1297ec26/bb51b/img_12.png 1320w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_12.png</figcaption>\n  </figure>\n이 때 A에서 select 문을 실행하면 데이터가 들어가 있는 것을 확인할 수 있다.\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/a14fa4ce271f012ac9459d49853e0136/bb51b/img_13.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 61.1764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABrUlEQVR42p2SaW/aUBBF/f9/UdVWqpQuJCoYkrpsCd6w/bzhDbwEYU6GFvUTJFVGOvJ43ujea+tpTdPQNC21UGY5vuPirH3MYI3r+wQqZO0HqDCSp48fhHhhiC29J3MvUARypqKYstyipXFIEiuSLKVLQmrXZFuWTLcOqogo80zEAsoqJ5a9rbzbmYeTBeSblDSNadoddVdRFJkIelOKyMAwTX5NR3juAypYsloOeZzf4dhTfH+JYQ14NG6IXYP12uBx8RNzZcj5jIXsrZ4mhMpGKzYOtu1g2RahJInjiLreMda/Mxl/Y/DjE6PRDfroK4vZENuakyQJbdvQdZ3QnvuW5+cOLQ5t7ic64/FE4qcEQcBmsyGKIqqqEoNY+pg8zznV8Xj8w7XSbD/GNC08z0MpRZZl7Pd7cW15T2n92bHvew6Hw9/+0Mtn16c4Mj+c6f+lew3tkstJ+N0JLw1PaSLlkKUuSeRKb6J8U65Q+CbaZZ8j+lDn44cBw7tbvnwe8KDfUmVPwupVrgq61m+Wck2UN5dFh7p02RXOm2jX/oVj3pOGM9qtK2K2LP8fLwCCjo9W5E5IAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_13.png' title='' src='/static/a14fa4ce271f012ac9459d49853e0136/ca1dc/img_13.png' srcset='/static/a14fa4ce271f012ac9459d49853e0136/e7570/img_13.png 170w,\n/static/a14fa4ce271f012ac9459d49853e0136/f46e7/img_13.png 340w,\n/static/a14fa4ce271f012ac9459d49853e0136/ca1dc/img_13.png 680w,\n/static/a14fa4ce271f012ac9459d49853e0136/02d09/img_13.png 1020w,\n/static/a14fa4ce271f012ac9459d49853e0136/bb51b/img_13.png 1320w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_13.png</figcaption>\n  </figure>\n그러나, B에서 동일한 select문을 실행하면 데이터를 확인할 수 없다.\n왜냐? 스레드 A의 트랜잭션은 끝나지 않았기 때문에 A에서 보이는 데이터는 \"임시 반영\"된 데이터일 뿐, \"영속화\"되지 않았기 때문이다.\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/cad5de9cbe3d1b7864510b0f468b3b0e/bb51b/img_14.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 61.1764705882353%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsTAAALEwEAmpwYAAABiUlEQVR42p2S2W7bMBBF9f9/1NcCblC4iTfVW2LtFClqsWRHkm3YOqWE5M0B3AxwwCE5y+WAVtM0NE1LbaiKPcIP8EOBE4cEQhBLRShipEqIYokQkkAa4pjInA93iUaYuESnWJlWpFqSFhmnVFEHDseqYnn0kZXmUO5RKuZwLNGJ5Lgv8IoQPxfs84ws07TtO/X5QGlirSxaUiY2tuOwWD4TBXNkvGW3fWa7/o27swmDFfO3Ea9/f6IDmyi0ed2Mccyd763YmLjd2xQlPawy9/E8H9dzByVaJ9R1zXQyYjF/YjH7ZRJeWC3HbFZ/8Nw1aZoaVQ2n08nQfvgt5/MJSyuP2fSFyWRq5GfEZjZ5ng9J/Wy7DkM3rL31S/e5uWOWJzSO4xJFEdIMuygKLpeL6dryHbNuQ/eO2+3G9Xr98K/Ds+FT3eNY97r0hb+t8N5hr1arkCIT5tskVHv1MNZXnezZiPHTDzK1Nn/P4VDsHuJuwX4WSmyGYnXl814+zpdPPpYhzaEP8v6LfxfakdB3SsWxAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_14.png' title='' src='/static/cad5de9cbe3d1b7864510b0f468b3b0e/ca1dc/img_14.png' srcset='/static/cad5de9cbe3d1b7864510b0f468b3b0e/e7570/img_14.png 170w,\n/static/cad5de9cbe3d1b7864510b0f468b3b0e/f46e7/img_14.png 340w,\n/static/cad5de9cbe3d1b7864510b0f468b3b0e/ca1dc/img_14.png 680w,\n/static/cad5de9cbe3d1b7864510b0f468b3b0e/02d09/img_14.png 1020w,\n/static/cad5de9cbe3d1b7864510b0f468b3b0e/bb51b/img_14.png 1320w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_14.png</figcaption>\n  </figure>\n만약 위와 같이 스레드 A에서 커밋을 하고 나면\n<figure class='gatsby-resp-image-figure' style='margin-bottom: 16px;'>\n    <span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; '>\n      <a class='gatsby-resp-image-link' href='/static/8a07b84cb0cb833d12cc4a29bef34245/bb51b/img_15.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 69.41176470588235%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB5UlEQVR42p2T3VLbMBCF/f6v1JvOlIEWSBpKgBAnshNbsuw4/sN24jjkQzK9hLSDZs7srqxzdi3tOvt9R9cdaNo9eZYTrAO8VYCQAYGUqEgbq1A6HuJQRYRmzw9D1qEcvtk9qTTlS42zSWI2m4S8zOiNrX1BVZRM6xWqiCmyDKUkVVmi4/fYyyR+psi3W5JNbIqpabqaPM9w0nBGkTwyFSsen0ao9T2RmuOJCUt3TBi4RJFgFtziza7I5DNh+Mh8do1YTFn5M9znG+PfGZ6Ps9ULxNLl2Z2zXvuGHFJVOXe/L7ib/ODXz2+DPxp/5+nhEm85JdaKpi5o2xd2trq6pG0q9vsWJ9Ee4/Et49GINE2R5k6s9TxBHJu78j2EEKaq0Ai0tLsd3eHA8fhKfzwaexx8a/v+iLOSsSH5aK1JkoSiKDgYgiV/ZTn7Q8+h69iZzBZ93w/ZmqYZDpxOr39xssE7+BzOR1ms4Jcr/Exwk4SUhSbbRqY/FVkaUeWpaanzcD7Oc+Lhz5ibq2umk2suLy64n1zykgsD7yw+EXzFnS8ZjexL56YLXNJE05QedeGfxYeC9hGC1ROL+cRMhmQTm+ylNIQvCtolzJQE3oRyuxwO2t/5l9iZCk9oaUYyXdBW6/8Ws4JvYHcmGbAUPokAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img_15.png' title='' src='/static/8a07b84cb0cb833d12cc4a29bef34245/ca1dc/img_15.png' srcset='/static/8a07b84cb0cb833d12cc4a29bef34245/e7570/img_15.png 170w,\n/static/8a07b84cb0cb833d12cc4a29bef34245/f46e7/img_15.png 340w,\n/static/8a07b84cb0cb833d12cc4a29bef34245/ca1dc/img_15.png 680w,\n/static/8a07b84cb0cb833d12cc4a29bef34245/02d09/img_15.png 1020w,\n/static/8a07b84cb0cb833d12cc4a29bef34245/bb51b/img_15.png 1320w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span>\n    <figcaption class='gatsby-resp-image-figcaption'>img_15.png</figcaption>\n  </figure>\n이제는 스레드 B에서도 동일한 데이터를 확인할 수 있다.</p>\n<h2>결론</h2>\n<p>결국 메소드 레벨에 <code class=\"language-text\">@Transactional</code> 어노테이션이 붙은 탓에 save 메소드를 성공적으로 수행해도, 트랜잭션이 끝나지 않아(정확히 말하면 커밋되지 않아) 랜덤 포트 서버의 스레드에서 확인할 수 없는 것이다.\n따라서 랜덤 포트 환경의 격리성을 보장하고자 할 때는 <code class=\"language-text\">@Transactional</code> 어노테이션을 사용하기 보다는, truncate를 하는 sql 스크립트를 사용하는 방법을 고려하는게 더 적절하다고 생각한다.</p>","frontmatter":{"title":"[트러블슈팅] @SpringbootTest의 RANDOM_PORT 환경에서 @Transactional 어노테이션을 사용했을 때, RestAssured GET 요청이 수행되지 않는 경우(트랜잭션 격리 이해하기)","date":"July 31, 2023","update":"July 31, 2023","tags":["Transaction","SpringbootTest"],"series":null},"fields":{"slug":"/transactional-not-in-restassured/","readingTime":{"minutes":9.67}}},"seriesList":{"edges":[{"node":{"id":"28f1d87e-d3fc-5567-8531-57649652864f","fields":{"slug":"/sprint-idea/"},"frontmatter":{"title":"구글 스프린트 기반 아이디어 도출"}}},{"node":{"id":"4a9246fb-171b-5973-88fc-864034e78afd","fields":{"slug":"/blog-starter/"},"frontmatter":{"title":"피움 블로그 생성과정"}}},{"node":{"id":"c826ce0e-1ea7-517c-8d19-84e90a59a798","fields":{"slug":"/jenkins-setting/"},"frontmatter":{"title":"젠킨스 설치하기"}}},{"node":{"id":"a387bf4f-567f-50e7-b6a7-99a1a1c8971b","fields":{"slug":"/jpa-notnull-nullable/"},"frontmatter":{"title":"@NotNull과 nullable = false는 어떤 차이가 있을까?"}}},{"node":{"id":"a78e224b-b711-5071-8e90-013d6f4bebc3","fields":{"slug":"/pium-deploy-step/"},"frontmatter":{"title":"피움의 배포과정"}}},{"node":{"id":"ce07fbab-1ed5-5f1e-8e2f-eb430879b56a","fields":{"slug":"/fe-tanstack-query/"},"frontmatter":{"title":"프론트엔드: Tanstack Query 사용에 대하여"}}},{"node":{"id":"159c943b-1a50-57dd-aa71-7557364752a5","fields":{"slug":"/ci-cd-setting/"},"frontmatter":{"title":"Jenkins와 Github Webhook을 이용해 CI/CD 구축하기"}}},{"node":{"id":"dea45a4a-bfde-5fbb-8a97-42d3a3e77a0b","fields":{"slug":"/jenkins-hook-by-label/"},"frontmatter":{"title":"PR 라벨로 젠킨스 빌드유발을 구분하기"}}},{"node":{"id":"1a03734e-d413-553f-9152-1dad2fc4acca","fields":{"slug":"/apply-https/"},"frontmatter":{"title":"내 서버에 HTTPS 설정하기"}}},{"node":{"id":"cecbc8b9-db00-562b-aa0b-06c406cfc44a","fields":{"slug":"/bundle-analyze/"},"frontmatter":{"title":"bundle-analyze를 통한 bundle 크기 분석"}}},{"node":{"id":"707f8ffb-1409-5c27-b15a-5661b235c226","fields":{"slug":"/db-drop-stop/"},"frontmatter":{"title":"Table Drop 못하게 막아버리기"}}},{"node":{"id":"fe4b591a-4dd5-5dd2-b18a-b318afd1e9e3","fields":{"slug":"/transactional-not-in-restassured/"},"frontmatter":{"title":"[트러블슈팅] @SpringbootTest의 RANDOM_PORT 환경에서 @Transactional 어노테이션을 사용했을 때, RestAssured GET 요청이 수행되지 않는 경우(트랜잭션 격리 이해하기)"}}},{"node":{"id":"80aa708e-ef8a-5c79-9644-cb8c04d55a63","fields":{"slug":"/acceptance-test-resolve/"},"frontmatter":{"title":"인수테스트 데이터 초기화하기"}}},{"node":{"id":"15def1d5-c20f-5d07-b46e-24a14661365f","fields":{"slug":"/react-setting-without-cra/"},"frontmatter":{"title":"webpack으로만 React 설정하기 (without CRA)"}}},{"node":{"id":"66383c86-e2c8-533a-90e0-2effae572742","fields":{"slug":"/stylelint-and-husky/"},"frontmatter":{"title":"stylelint와 husky를 통해 컨벤션 통일하기"}}},{"node":{"id":"ed5951d5-beda-5a8f-adb2-07c2fcb38d5e","fields":{"slug":"/OAuth2.0/"},"frontmatter":{"title":"내가 이해한 OAuth2.0"}}},{"node":{"id":"45eeb9a3-557d-5704-8fd9-925283e1e27b","fields":{"slug":"/restdocs-start/"},"frontmatter":{"title":"RestDocs로 API 문서화하기"}}},{"node":{"id":"663b560a-734d-51a9-a6dc-3c4f50716c74","fields":{"slug":"/spring-event-apply/"},"frontmatter":{"title":"Spring Event 적용하기"}}},{"node":{"id":"55ae8038-3f65-5a59-8db3-c7405e7fc125","fields":{"slug":"/github-actions-cypress/"},"frontmatter":{"title":"피움 Cypress 자동화 구축기"}}},{"node":{"id":"503e9e71-eda3-53d7-8142-7c309faf213e","fields":{"slug":"/why_we_applied_querydsl/"},"frontmatter":{"title":"피움 서비스의 Querydsl 도입 이유"}}},{"node":{"id":"709124d0-5b05-5530-804d-e90ec9856a13","fields":{"slug":"/querydsl_apply_procedure/"},"frontmatter":{"title":"피움 서비스의 Querydsl 적용 과정"}}},{"node":{"id":"5c865dcb-cefd-58be-8968-b5edf6c8080c","fields":{"slug":"/server-logging/"},"frontmatter":{"title":"Logback을 이용해 운영 환경 별 로그 남기기"}}},{"node":{"id":"8269f166-d041-533c-9d44-332d8d8c3dca","fields":{"slug":"/server-monitoring/"},"frontmatter":{"title":"CloudWatch를 이용한 모니터링 환경 구성"}}},{"node":{"id":"0faec7ad-3bd1-5f5e-9222-115f771df8ed","fields":{"slug":"/tanstack-query-cache-trouble-shooting/"},"frontmatter":{"title":"InfinityQuery에서 fetch가 제대로 이루어지지 않는다?!?!"}}},{"node":{"id":"c77f7199-7fc6-53a3-a1fb-0792e05655a7","fields":{"slug":"/OAuth2.0-backend/"},"frontmatter":{"title":"OAuth 2.0 로그인 구현하기 (카카오)"}}},{"node":{"id":"12e4480d-386b-5d0e-bd69-4209fed36066","fields":{"slug":"/OAuth-test-backend/"},"frontmatter":{"title":"외부 API 를 의존하는 OAuth 로그인 테스트하기"}}},{"node":{"id":"ff40e109-cc92-5d83-a213-ca9d07136d95","fields":{"slug":"/aws-s3-apply/"},"frontmatter":{"title":"AWS S3로 정적 이미지 배포하기"}}},{"node":{"id":"e343af80-72dd-5173-bbb5-5069a17d1200","fields":{"slug":"/search_in_spring_data_jpa/"},"frontmatter":{"title":"Spring Data Jpa를 활용한 검색 기능 개발하기"}}},{"node":{"id":"af344dd8-ea77-5fde-9452-a97952ce60be","fields":{"slug":"/submodule-apply/"},"frontmatter":{"title":"Git submodule을 이용한 민감정보 관리"}}},{"node":{"id":"08c9daf0-2344-52a9-8c68-31ac04c24ff0","fields":{"slug":"/tomcat-thread-config/"},"frontmatter":{"title":"톰캣 스레드 설정하기"}}},{"node":{"id":"eafed74f-ff11-5af1-a589-e9dd2ccb5c8e","fields":{"slug":"/http-cache/"},"frontmatter":{"title":"CloudFront와 HTTP 캐시"}}},{"node":{"id":"dbe47289-01f4-571d-9506-fbb92016f547","fields":{"slug":"/optimize-frontend/"},"frontmatter":{"title":"피움 최적화하기"}}},{"node":{"id":"7b830fe6-e2df-564a-926e-7f7800380336","fields":{"slug":"/query-analysis/"},"frontmatter":{"title":"서비스 내에서 발생하는 쿼리를 분석하고 개선하기"}}},{"node":{"id":"37437d15-a63e-52ef-b031-6ee1bc6fa8bc","fields":{"slug":"/image-resize/"},"frontmatter":{"title":"서버에서 이미지 리사이징하기"}}},{"node":{"id":"216f4636-4125-5765-83d8-a6a610692a41","fields":{"slug":"/dont-stop-deploy/"},"frontmatter":{"title":"무중단 배포 환경 구성하기"}}},{"node":{"id":"dd095976-5a96-51b5-9686-8956dc60cd24","fields":{"slug":"/hikaricp-connection-pool-setting/"},"frontmatter":{"title":"HikariCp Connection Pool 값 설정"}}},{"node":{"id":"625ad76f-acb1-56cc-9baa-3d6f1a954ac2","fields":{"slug":"/pwa/"},"frontmatter":{"title":"PWA를 도입해보자"}}},{"node":{"id":"6a12651c-e6b8-5fa6-9c57-766772d32680","fields":{"slug":"/serviceworker/"},"frontmatter":{"title":"Service Worker에 대한 대략적인 이해"}}},{"node":{"id":"b9709447-61dc-52f0-95a5-8670a3fbaaf4","fields":{"slug":"/installPrompt/"},"frontmatter":{"title":"홈화면에 추가 안내 prompt 만들기"}}}]},"previous":{"fields":{"slug":"/db-drop-stop/"},"frontmatter":{"title":"Table Drop 못하게 막아버리기"}},"next":{"fields":{"slug":"/acceptance-test-resolve/"},"frontmatter":{"title":"인수테스트 데이터 초기화하기"}}},"pageContext":{"id":"fe4b591a-4dd5-5dd2-b18a-b318afd1e9e3","series":null,"previousPostId":"707f8ffb-1409-5c27-b15a-5661b235c226","nextPostId":"80aa708e-ef8a-5c79-9644-cb8c04d55a63"}},"staticQueryHashes":[],"slicesMap":{}}