{"componentChunkName":"component---src-templates-post-jsx","path":"/db-drop-stop/","result":{"data":{"site":{"siteMetadata":{"title":"pium.log"}},"markdownRemark":{"id":"707f8ffb-1409-5c27-b15a-5661b235c226","excerpt":"이 글은 우테코 피움팀 크루 '주노', '그레이', '조이', '하마드'가 작성했습니다. 서론 본 설명 글은 다음과 같은 환경에서 진행됩니다. 배포서버 : Ubuntu 22.04.2 LTS DB서버 : Ubuntu 22.04.2 LTS 배포서버와 DB서버는 동일한 VPC를 사용하고 있습니다. DB : MySQL 8.0.33 Application : Spr…","html":"<blockquote>\n<p>이 글은 우테코 피움팀 크루 '<a href=\"https://github.com/Choi-JJunho\">주노</a>', '<a href=\"https://github.com/kim0914\">그레이</a>', '<a href=\"https://github.com/yeonkkk\">조이</a>', '<a href=\"https://github.com/rawfishthelgh\">하마드</a>'가 작성했습니다.</p>\n</blockquote>\n<h2>서론</h2>\n<p>본 설명 글은 다음과 같은 환경에서 진행됩니다.</p>\n<blockquote>\n<ul>\n<li>배포서버 : Ubuntu 22.04.2 LTS</li>\n<li>DB서버 : Ubuntu 22.04.2 LTS</li>\n<li>배포서버와 DB서버는 동일한 VPC를 사용하고 있습니다.</li>\n<li>DB : MySQL 8.0.33</li>\n<li>Application : SpringBoot 3.1.1</li>\n</ul>\n</blockquote>\n<p>개발 과정에서 실수로 Application 단에서 DB 혹은 테이블을 Drop 해버리는 상황이 있을 수 있다.</p>\n<p>테이블의 수정이 제한된 유저를 생성하여 해당 유저를 Application에서 사용하도록 구성해보자. </p>\n<blockquote>\n<p>도움을 주신 G선생님께 감사의 인사 올리며 시작하겠습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 636px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/8f933cb276f688c756d9cbf5800a4405/44bb2/c34a6c3a.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 43.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABIUlEQVR42q2STU/CQBCG9w+ZUAoCtbAf7bYV6ZbS8pGoCYL+BS9evXvy6G99nd0WgiExRj08eWd2JjOzmWFT84zgSmM40vB7Ar2+/BPsdv8BzlMEYfY/Bb2LAF6Xo0vYgl2f1BcNv2jA5NMWWlfIrldIsiXSVg/IaA6hih/Dbt5eUOR3qFd7LOod6vUjymqLarlDWT8gm26gM9vke3S6dLCQFiLUHBNhWnJwaTDmufObzvMzmskPdgkVLxDRT1m5eUU4TiCVoYBxKmSOWJeUnENF1p85XE4b52KGKC7Ib+xRkKB/qcDW9+90NpFLskFJau0kXUCImXuz2sQNTVI4tUWOzcgeDCJaJAfrdIa0WUGbnnyh443P3k6x13D0fX68iE9C9T4iTjV+ggAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='c34a6c3a' title='' src='/static/8f933cb276f688c756d9cbf5800a4405/44bb2/c34a6c3a.png' srcset='/static/8f933cb276f688c756d9cbf5800a4405/e7570/c34a6c3a.png 170w,\n/static/8f933cb276f688c756d9cbf5800a4405/f46e7/c34a6c3a.png 340w,\n/static/8f933cb276f688c756d9cbf5800a4405/44bb2/c34a6c3a.png 636w' sizes='(max-width: 636px) 100vw, 636px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n</blockquote>\n<h2>유저 생성하기</h2>\n<blockquote>\n<p>이후 진행할 작업에서 권한 부여를 위해 root 권한이 필요합니다.</p>\n</blockquote>\n<p>우선 root 권한을 가진 계정으로 MySQL에 로그인 한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"shell\"><pre class=\"language-shell\"><code class=\"language-shell\"><span class=\"token comment\"># MySQL에 로그인</span>\n<span class=\"token function\">sudo</span> mysql <span class=\"token parameter variable\">-u</span> root <span class=\"token parameter variable\">-p</span></code></pre></div>\n<p>Application에서 사용할 유저를 생성한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">USER</span> <span class=\"token string\">'pium'</span><span class=\"token variable\">@'localhost'</span> IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'password'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<blockquote>\n<p>만약 외부에서 접근해야하는 유저의 경우 다음 명령어를 참고하세요</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token comment\"># 외부 모든 IP에 대한 pium 이라는 유저 생성 </span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">USER</span> <span class=\"token string\">'pium'</span><span class=\"token variable\">@'%'</span> IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'password'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token comment\"># 특정 인스턴스에서만 접속가능한 pium 이라는 유저 생성 </span>\n<span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">USER</span> <span class=\"token string\">'pium'</span><span class=\"token variable\">@'접속할 인스턴스의 private ip'</span> IDENTIFIED <span class=\"token keyword\">BY</span> <span class=\"token string\">'password'</span><span class=\"token punctuation\">;</span></code></pre></div>\n</blockquote>\n<h2>권한 부여하기</h2>\n<p>MySQL에서 설정할 수 있는 권한은 아래와 같다.</p>\n<table>\n<thead>\n<tr>\n<th>권한</th>\n<th>내용</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>CREATE, ALTER, DROP</td>\n<td>테이블 생성, 변경, 삭제</td>\n</tr>\n<tr>\n<td>SELECT, INSERT, UPDATE, DELETE</td>\n<td>테이블의 레코드 조회, 입력, 수정, 삭제</td>\n</tr>\n<tr>\n<td>RELOAD</td>\n<td>권한 부여된 내용을 리로드</td>\n</tr>\n<tr>\n<td>SHUTDOWN</td>\n<td>서버 종료 작업 실행</td>\n</tr>\n<tr>\n<td>ALL</td>\n<td>모든 권한 허용</td>\n</tr>\n<tr>\n<td>USAGE</td>\n<td>권한 없이 계정만 생성</td>\n</tr>\n</tbody>\n</table>\n<p>우리는 <code class=\"language-text\">INSERT</code>, <code class=\"language-text\">UPDATE</code>, <code class=\"language-text\">SELECT</code>, <code class=\"language-text\">DELETE</code>만 사용하면 되기 떄문에, 새로 생성한 유저에게 해당 권한만 부여한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\"><span class=\"token keyword\">GRANT</span> <span class=\"token keyword\">SELECT</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">INSERT</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">UPDATE</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">DELETE</span> <span class=\"token keyword\">ON</span> pium_db<span class=\"token punctuation\">.</span><span class=\"token operator\">*</span> <span class=\"token keyword\">TO</span> <span class=\"token string\">'pium'</span><span class=\"token variable\">@'localhost'</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>설정한 권한을 <code class=\"language-text\">flush</code> 명령어를 이용해 적용한다.</p>\n<div class=\"gatsby-highlight\" data-language=\"sql\"><pre class=\"language-sql\"><code class=\"language-sql\">FLUSH <span class=\"token keyword\">PRIVILEGES</span><span class=\"token punctuation\">;</span></code></pre></div>\n<h2>확인하기</h2>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/dc3f7abd340d9d43646bcd6592067702/2573e/bd8e631c.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 4.705882352941177%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAABCAYAAADeko4lAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAR0lEQVR42mMwUFf7b6Sh8d9IR++/nqrGfy1ltf86Kur/tZXV/2sC2WqKKv8FBAT/c3Pz/Ofh4cXAXEBxKQmp/1pAPVrKqv8BQz4aj54VZi8AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='bd8e631c' title='' src='/static/dc3f7abd340d9d43646bcd6592067702/ca1dc/bd8e631c.png' srcset='/static/dc3f7abd340d9d43646bcd6592067702/e7570/bd8e631c.png 170w,\n/static/dc3f7abd340d9d43646bcd6592067702/f46e7/bd8e631c.png 340w,\n/static/dc3f7abd340d9d43646bcd6592067702/ca1dc/bd8e631c.png 680w,\n/static/dc3f7abd340d9d43646bcd6592067702/02d09/bd8e631c.png 1020w,\n/static/dc3f7abd340d9d43646bcd6592067702/9d567/bd8e631c.png 1360w,\n/static/dc3f7abd340d9d43646bcd6592067702/2573e/bd8e631c.png 1380w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>실제로 생성된 유저로 접속하여 Drop Table 명령어를 수행했을 때 권한 부족으로 수행되지 않음을 확인할 수 있다.</p>\n<h2>Application properties 적용</h2>\n<p>Application의 설정파일에 생성한 유저의 정보를 작성한다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/a5fdcb6a4b9204f52f0ba28e89ec7605/e7448/54161808.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 21.176470588235293%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAjUlEQVR42pWOSQ7CMBAEx0uwsmLHdhIkC/H/TxZDTogLyqHUc2jVtMhakPZEjgdm2xlTYlkWombLK61WSh+4izAaYfii/0mnHZF7OmVSKlZxMfJqjWPbEGNwvsMai9Gy/YM5hXFF9uPE54KfZ+w00Q09LgQ68yldIWVdp2uSinPVe8frk9s0E8aBcFH4BvinVdVHH7LcAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='54161808' title='' src='/static/a5fdcb6a4b9204f52f0ba28e89ec7605/ca1dc/54161808.png' srcset='/static/a5fdcb6a4b9204f52f0ba28e89ec7605/e7570/54161808.png 170w,\n/static/a5fdcb6a4b9204f52f0ba28e89ec7605/f46e7/54161808.png 340w,\n/static/a5fdcb6a4b9204f52f0ba28e89ec7605/ca1dc/54161808.png 680w,\n/static/a5fdcb6a4b9204f52f0ba28e89ec7605/e7448/54161808.png 900w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>이를 통해 Applicaiton에서는 Table의 생성, 수정, 삭제에 대한 조작을 할 수 없게 되었다.</p>\n<p>만약 테이블의 생성, 수정, 삭제에 대한 작업이 필요할 경우 DBA 혹은 DB 담당자에게 요청하는 프로세스를 거쳐야만 한다.</p>\n<h2>Reference</h2>\n<ul>\n<li>Chat GTP 4</li>\n<li>피움 백엔드 팀의 집단지성</li>\n</ul>","frontmatter":{"title":"Table Drop 못하게 막아버리기","date":"July 28, 2023","update":"July 28, 2023","tags":["DB","MySQL"],"series":null},"fields":{"slug":"/db-drop-stop/","readingTime":{"minutes":3.58}}},"seriesList":{"edges":[{"node":{"id":"28f1d87e-d3fc-5567-8531-57649652864f","fields":{"slug":"/sprint-idea/"},"frontmatter":{"title":"구글 스프린트 기반 아이디어 도출"}}},{"node":{"id":"4a9246fb-171b-5973-88fc-864034e78afd","fields":{"slug":"/blog-starter/"},"frontmatter":{"title":"피움 블로그 생성과정"}}},{"node":{"id":"c826ce0e-1ea7-517c-8d19-84e90a59a798","fields":{"slug":"/jenkins-setting/"},"frontmatter":{"title":"젠킨스 설치하기"}}},{"node":{"id":"a387bf4f-567f-50e7-b6a7-99a1a1c8971b","fields":{"slug":"/jpa-notnull-nullable/"},"frontmatter":{"title":"@NotNull과 nullable = false는 어떤 차이가 있을까?"}}},{"node":{"id":"a78e224b-b711-5071-8e90-013d6f4bebc3","fields":{"slug":"/pium-deploy-step/"},"frontmatter":{"title":"피움의 배포과정"}}},{"node":{"id":"ce07fbab-1ed5-5f1e-8e2f-eb430879b56a","fields":{"slug":"/fe-tanstack-query/"},"frontmatter":{"title":"프론트엔드: Tanstack Query 사용에 대하여"}}},{"node":{"id":"159c943b-1a50-57dd-aa71-7557364752a5","fields":{"slug":"/ci-cd-setting/"},"frontmatter":{"title":"Jenkins와 Github Webhook을 이용해 CI/CD 구축하기"}}},{"node":{"id":"dea45a4a-bfde-5fbb-8a97-42d3a3e77a0b","fields":{"slug":"/jenkins-hook-by-label/"},"frontmatter":{"title":"PR 라벨로 젠킨스 빌드유발을 구분하기"}}},{"node":{"id":"707f8ffb-1409-5c27-b15a-5661b235c226","fields":{"slug":"/db-drop-stop/"},"frontmatter":{"title":"Table Drop 못하게 막아버리기"}}},{"node":{"id":"1a03734e-d413-553f-9152-1dad2fc4acca","fields":{"slug":"/apply-https/"},"frontmatter":{"title":"내 서버에 HTTPS 설정하기"}}},{"node":{"id":"cecbc8b9-db00-562b-aa0b-06c406cfc44a","fields":{"slug":"/bundle-analyze/"},"frontmatter":{"title":"bundle-analyze를 통한 bundle 크기 분석"}}},{"node":{"id":"fe4b591a-4dd5-5dd2-b18a-b318afd1e9e3","fields":{"slug":"/transactional-not-in-restassured/"},"frontmatter":{"title":"[트러블슈팅] @SpringbootTest의 RANDOM_PORT 환경에서 @Transactional 어노테이션을 사용했을 때, RestAssured GET 요청이 수행되지 않는 경우(트랜잭션 격리 이해하기)"}}},{"node":{"id":"80aa708e-ef8a-5c79-9644-cb8c04d55a63","fields":{"slug":"/acceptance-test-resolve/"},"frontmatter":{"title":"인수테스트 데이터 초기화하기"}}},{"node":{"id":"15def1d5-c20f-5d07-b46e-24a14661365f","fields":{"slug":"/react-setting-without-cra/"},"frontmatter":{"title":"webpack으로만 React 설정하기 (without CRA)"}}},{"node":{"id":"66383c86-e2c8-533a-90e0-2effae572742","fields":{"slug":"/stylelint-and-husky/"},"frontmatter":{"title":"stylelint와 husky를 통해 컨벤션 통일하기"}}},{"node":{"id":"ed5951d5-beda-5a8f-adb2-07c2fcb38d5e","fields":{"slug":"/OAuth2.0/"},"frontmatter":{"title":"내가 이해한 OAuth2.0"}}},{"node":{"id":"45eeb9a3-557d-5704-8fd9-925283e1e27b","fields":{"slug":"/restdocs-start/"},"frontmatter":{"title":"RestDocs로 API 문서화하기"}}},{"node":{"id":"663b560a-734d-51a9-a6dc-3c4f50716c74","fields":{"slug":"/spring-event-apply/"},"frontmatter":{"title":"Spring Event 적용하기"}}},{"node":{"id":"55ae8038-3f65-5a59-8db3-c7405e7fc125","fields":{"slug":"/github-actions-cypress/"},"frontmatter":{"title":"피움 Cypress 자동화 구축기"}}},{"node":{"id":"503e9e71-eda3-53d7-8142-7c309faf213e","fields":{"slug":"/why_we_applied_querydsl/"},"frontmatter":{"title":"피움 서비스의 Querydsl 도입 이유"}}},{"node":{"id":"709124d0-5b05-5530-804d-e90ec9856a13","fields":{"slug":"/querydsl_apply_procedure/"},"frontmatter":{"title":"피움 서비스의 Querydsl 적용 과정"}}},{"node":{"id":"5c865dcb-cefd-58be-8968-b5edf6c8080c","fields":{"slug":"/server-logging/"},"frontmatter":{"title":"Logback을 이용해 운영 환경 별 로그 남기기"}}},{"node":{"id":"8269f166-d041-533c-9d44-332d8d8c3dca","fields":{"slug":"/server-monitoring/"},"frontmatter":{"title":"CloudWatch를 이용한 모니터링 환경 구성"}}},{"node":{"id":"0faec7ad-3bd1-5f5e-9222-115f771df8ed","fields":{"slug":"/tanstack-query-cache-trouble-shooting/"},"frontmatter":{"title":"InfinityQuery에서 fetch가 제대로 이루어지지 않는다?!?!"}}},{"node":{"id":"c77f7199-7fc6-53a3-a1fb-0792e05655a7","fields":{"slug":"/OAuth2.0-backend/"},"frontmatter":{"title":"OAuth 2.0 로그인 구현하기 (카카오)"}}},{"node":{"id":"12e4480d-386b-5d0e-bd69-4209fed36066","fields":{"slug":"/OAuth-test-backend/"},"frontmatter":{"title":"외부 API 를 의존하는 OAuth 로그인 테스트하기"}}},{"node":{"id":"ff40e109-cc92-5d83-a213-ca9d07136d95","fields":{"slug":"/aws-s3-apply/"},"frontmatter":{"title":"AWS S3로 정적 이미지 배포하기"}}},{"node":{"id":"e343af80-72dd-5173-bbb5-5069a17d1200","fields":{"slug":"/search_in_spring_data_jpa/"},"frontmatter":{"title":"Spring Data Jpa를 활용한 검색 기능 개발하기"}}},{"node":{"id":"af344dd8-ea77-5fde-9452-a97952ce60be","fields":{"slug":"/submodule-apply/"},"frontmatter":{"title":"Git submodule을 이용한 민감정보 관리"}}},{"node":{"id":"08c9daf0-2344-52a9-8c68-31ac04c24ff0","fields":{"slug":"/tomcat-thread-config/"},"frontmatter":{"title":"톰캣 스레드 설정하기"}}},{"node":{"id":"eafed74f-ff11-5af1-a589-e9dd2ccb5c8e","fields":{"slug":"/http-cache/"},"frontmatter":{"title":"CloudFront와 HTTP 캐시"}}},{"node":{"id":"dbe47289-01f4-571d-9506-fbb92016f547","fields":{"slug":"/optimize-frontend/"},"frontmatter":{"title":"피움 최적화하기"}}},{"node":{"id":"7b830fe6-e2df-564a-926e-7f7800380336","fields":{"slug":"/query-analysis/"},"frontmatter":{"title":"서비스 내에서 발생하는 쿼리를 분석하고 개선하기"}}},{"node":{"id":"37437d15-a63e-52ef-b031-6ee1bc6fa8bc","fields":{"slug":"/image-resize/"},"frontmatter":{"title":"서버에서 이미지 리사이징하기"}}},{"node":{"id":"216f4636-4125-5765-83d8-a6a610692a41","fields":{"slug":"/dont-stop-deploy/"},"frontmatter":{"title":"무중단 배포 환경 구성하기"}}},{"node":{"id":"dd095976-5a96-51b5-9686-8956dc60cd24","fields":{"slug":"/hikaricp-connection-pool-setting/"},"frontmatter":{"title":"HikariCp Connection Pool 값 설정"}}},{"node":{"id":"625ad76f-acb1-56cc-9baa-3d6f1a954ac2","fields":{"slug":"/pwa/"},"frontmatter":{"title":"PWA를 도입해보자"}}},{"node":{"id":"6a12651c-e6b8-5fa6-9c57-766772d32680","fields":{"slug":"/serviceworker/"},"frontmatter":{"title":"Service Worker에 대한 대략적인 이해"}}},{"node":{"id":"ac7012e4-5b85-5040-b65e-c068968d7979","fields":{"slug":"/web-push/"},"frontmatter":{"title":"브라우저에서 알림 구현하기"}}},{"node":{"id":"b9709447-61dc-52f0-95a5-8670a3fbaaf4","fields":{"slug":"/installPrompt/"},"frontmatter":{"title":"홈화면에 추가 안내 prompt 만들기"}}},{"node":{"id":"09501eea-fa70-5c42-9ee1-f25a5ab08bb5","fields":{"slug":"/pium-apply-pwa/"},"frontmatter":{"title":"피움의 PWA 적용기"}}}]},"previous":{"fields":{"slug":"/jenkins-hook-by-label/"},"frontmatter":{"title":"PR 라벨로 젠킨스 빌드유발을 구분하기"}},"next":{"fields":{"slug":"/apply-https/"},"frontmatter":{"title":"내 서버에 HTTPS 설정하기"}}},"pageContext":{"id":"707f8ffb-1409-5c27-b15a-5661b235c226","series":null,"previousPostId":"dea45a4a-bfde-5fbb-8a97-42d3a3e77a0b","nextPostId":"1a03734e-d413-553f-9152-1dad2fc4acca"}},"staticQueryHashes":[],"slicesMap":{}}