{"componentChunkName":"component---src-templates-post-jsx","path":"/jpa-notnull-nullable/","result":{"data":{"site":{"siteMetadata":{"title":"pium.log"}},"markdownRemark":{"id":"a387bf4f-567f-50e7-b6a7-99a1a1c8971b","excerpt":"이 글은 우테코 피움팀 크루 '그레이'가 작성했습니다. 서론 JPA를 이용해 엔티티를 설계하다가  어노테이션과 @Column의 의 차이점이 궁금해져 알아보았습니다. nullable = false ?? JPA는 엔티티를 매핑하고 설계하면 자동으로 DDL을 생성해 주는 기능을 제공합니다. \n또한 엔티티의 각 컬럼들에 대해 NOT NULL, UNIQUE 등과 …","html":"<blockquote>\n<p>이 글은 우테코 피움팀 크루 '<a href=\"https://github.com/Kim0914\">그레이</a>'가 작성했습니다.</p>\n</blockquote>\n<h2>서론</h2>\n<p>JPA를 이용해 엔티티를 설계하다가 <code class=\"language-text\">@NotNull</code> 어노테이션과 @Column의 <code class=\"language-text\">nullable=false</code>의 차이점이 궁금해져 알아보았습니다.</p>\n<h2>nullable = false ??</h2>\n<p>JPA는 엔티티를 매핑하고 설계하면 자동으로 DDL을 생성해 주는 기능을 제공합니다.\n또한 엔티티의 각 컬럼들에 대해 NOT NULL, UNIQUE 등과 같은 제약 조건이 포함되는 경우에도 자동으로 DDL을 생성해 줍니다.</p>\n<p>엔티티를 설계할 때 일반적으로 @Column 어노테이션을 활용합니다.\n@Column 어노테이션에서 해당 컬럼의 NOT NULL 제약을 설정할 수 있는데 <code class=\"language-text\">@Column(name = \"email\", nullable = false)</code>와 같이 nullable=false 설정을 걸어주면, 해당 제약 조건을 명시할 수 있습니다.\n따로 명시하지 않으면 nullable의 기본 값은 true입니다.</p>\n<p>간단한 User 엔티티를 생성해 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AuditingEntity</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">,</span> updatable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> userId<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"email\"</span><span class=\"token punctuation\">,</span> nullable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>User 테이블의 email 필드는 반드시 값이 존재해야 합니다.\n즉, <strong>NOT NULL 제약 조건이 필요</strong>합니다.\n여기서 JPA가 자동으로 생성하는 DDL을 확인해 보겠습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 511px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/07ba5d1c8c397f8be6371368e94590bd/40f84/img.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 56.470588235294116%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAABL0lEQVR42pVT7ZKCMBDzNU4RCogglkK/wHv/B9trojA3o+OdP5Zuoc0m2WV3bi9iRiv9VUt9auRrn8khy2V/OHLNjsVHsVsvVXUjqqy5ltWJcczVBn6PnPt3BQlYqEom68U6Lz7MMk6WeXe5bgWapk0KzsxPKW/OHdcnQDxQLS9KGcwk3kcxabUuSIiLOOyTJSEVsvZe5NLr9G6iTVDxBIjAB4DMyzeBez2k/CZxXh4eD0mFoxr4jACRlwwhGwxxGdIheZwcwZ0PYri30nY9z60EXjaFSVbwYIizaD0SBNJ9iGyUUjX9Wpv0tsu/GboHCPyZEkNYAKZoxCt5fwICSA+jXLWhdEScb2T535ncAAtVEgAMBzOyEWCIsflosPEAO3r1GGxVVuwm4pB99qf8AHc/NmNete98AAAAAElFTkSuQmCC'); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img' title='' src='/static/07ba5d1c8c397f8be6371368e94590bd/40f84/img.png' srcset='/static/07ba5d1c8c397f8be6371368e94590bd/e7570/img.png 170w,\n/static/07ba5d1c8c397f8be6371368e94590bd/f46e7/img.png 340w,\n/static/07ba5d1c8c397f8be6371368e94590bd/40f84/img.png 511w' sizes='(max-width: 511px) 100vw, 511px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p><code class=\"language-text\">email varchar(50) not null</code> 과 같이 not null 제약 조건이 자동으로 명시됨을 알 수 있습니다.</p>\n<p>하지만 DDL은 애플리케이션 내부가 아닌 데이터베이스 컬럼의 속성에 대한 조건이므로, 스프링(자바) 애플리케이션 내 User 엔티티의 email 필드는 null이 허용됩니다.</p>\n<p>테스트 코드로 확인해 보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@TestConstructor</span><span class=\"token punctuation\">(</span>autowireMode <span class=\"token operator\">=</span> <span class=\"token class-name\">TestConstructor<span class=\"token punctuation\">.</span>AutowireMode</span><span class=\"token punctuation\">.</span><span class=\"token constant\">ALL</span><span class=\"token punctuation\">)</span>\n<span class=\"token annotation punctuation\">@DataJpaTest</span>\n<span class=\"token keyword\">class</span> <span class=\"token class-name\">UserRepositoryTest</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token keyword\">private</span> <span class=\"token keyword\">final</span> <span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">public</span> <span class=\"token class-name\">UserRepositoryTest</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">UserRepository</span> userRepository<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>userRepository <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n\n    <span class=\"token annotation punctuation\">@Test</span>\n    <span class=\"token keyword\">void</span> <span class=\"token function\">save</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token class-name\">User</span> user <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">User</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"gray1234\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"gray\"</span><span class=\"token punctuation\">,</span> <span class=\"token keyword\">null</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token class-name\">User</span> savedUser <span class=\"token operator\">=</span> userRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n        <span class=\"token function\">assertThat</span><span class=\"token punctuation\">(</span>savedUser<span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">isEqualTo</span><span class=\"token punctuation\">(</span>user<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/71aee32c567a1f0f3cd007720fe0bc0e/bbbf7/img2.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 40%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABN0lEQVR42m2Sa3aCMBBGWUerQEJCEkEFfFv1dAHd/3amdyhtrfXHPROScPNNIOuHjXT9IDEmqUOQNi2kSY2k1DK3YC5JmNDnoNzN1YE98Zdst73J5f1DYn+T1F/Fuyg7V8uFzXsX5OC/OMLJR9nXUToky/HQRjzj0joxlZe8MJL52EpYrCSklXgI1suGxX5iGKsbawdrXl5TGw6NVT3WMMmKwkpWj7GBlr22zQtbNmiiNxId4UCqNXuStonE5aUYKOaFOEQVvM5zKBDGv3dgTDUmPCNR4QHJEBtZ0ppBlpPiZZb/CHSszBjPHoUeLEJNeNa7ox1NODDfcoBjrSytzEmnfEvueS5EdCXZDS6IdiTs+Ooth1SkNNyz5WqeSf+1XCJcTRe/pDagNamEgyzCijX9ZRzPj8JP4iTnrJ0znIQAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img2' title='' src='/static/71aee32c567a1f0f3cd007720fe0bc0e/ca1dc/img2.png' srcset='/static/71aee32c567a1f0f3cd007720fe0bc0e/e7570/img2.png 170w,\n/static/71aee32c567a1f0f3cd007720fe0bc0e/f46e7/img2.png 340w,\n/static/71aee32c567a1f0f3cd007720fe0bc0e/ca1dc/img2.png 680w,\n/static/71aee32c567a1f0f3cd007720fe0bc0e/02d09/img2.png 1020w,\n/static/71aee32c567a1f0f3cd007720fe0bc0e/bbbf7/img2.png 1280w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>테스트가 실패함을 확인할 수 있습니다.</p>\n<p>하지만 여기서 주의 깊게 살펴볼 점이 있습니다. 예외 메시지를 따라 올라가 보면 insert 쿼리가 한 번 발생한 것을 알 수 있습니다. 또한 발생한 예외 타입이 JdbcSQL.... Exception입니다.</p>\n<p>즉 애플리케이션 내부가 아닌, 데이터베이스 내에서 예외가 발생했다는 것입니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/6eb86d0d25b3bd233da6c29c69b111b7/78ab2/img3.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 36.47058823529412%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsTAAALEwEAmpwYAAABFUlEQVR42m1RV1LDMBTUOYi71WUV24GEMtz/Vo99shNmGD5W+3qTWGOktGSyfiEXYuVZalLGkXOhMtssZMcMPG2Atr7CwL+kQkJpWx0vl5aapqu4/EHb9r/oBmpOZr05wflSGRKcwAJjmlWdjnmcZJWZu36sCY8G/zV9FuQnYlR9rshr9cNUi2pjEYT1sQUX12ClDY3jDP1oLuXh56asi7AkSmWjEMHrTmW7HsVxz1xW2DN4qzFlv9Y7SfYjb91fyYP149bIERZVPaZ0J1tAYzq2s8zsTg6YxLOOMwRwgh45F/GMhMLCDjN9wPgN57t2tAJvxtMNP3cHrsANq38i5ktZumOSAltGTEZslmiGE7l+okUb+gEewspdEbtDdAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img3' title='' src='/static/6eb86d0d25b3bd233da6c29c69b111b7/ca1dc/img3.png' srcset='/static/6eb86d0d25b3bd233da6c29c69b111b7/e7570/img3.png 170w,\n/static/6eb86d0d25b3bd233da6c29c69b111b7/f46e7/img3.png 340w,\n/static/6eb86d0d25b3bd233da6c29c69b111b7/ca1dc/img3.png 680w,\n/static/6eb86d0d25b3bd233da6c29c69b111b7/02d09/img3.png 1020w,\n/static/6eb86d0d25b3bd233da6c29c69b111b7/78ab2/img3.png 1201w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>애플리케이션 내에서는 email 컬럼의 null을 체크하지 못하고, 데이터베이스에 쿼리가 실행될 때 예외가 발생한다는 것입니다. 또한 insert 쿼리가 데이베이스에서 실행되므로 Auto Increment인 PK가 증가합니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/8328bd74000f76b69473afbebb4ddfec/ef64d/img4.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 39.411764705882355%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA4ElEQVR42o1SWxKDIAzkGq2KD0Twjdr2/jdLs/HRmY7t+LFsDMsSElXbDZQXJd2jhKJYnyJO0stQhbHkfC2mhmOg2GBKJ5xmxc8Lvr+VKauPIcfgRGeUpjllbAQzzTFy34ABeN+HuRrGQB0/ewwTLY8X9UMQ46btJdf1I4VpoYHz8/ygieFcLWfCNMseNNDjnFqWpyR83VLLSXDddCs4hhBwvjnYsqGt/KEr7doasMKS5YZu91gGsyOKNLP+O6yzniqYoSoYV87LzSgdsJUThubqtFWzlY3GYiDnA7j+27wB3onf0dqVQqkAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img4' title='' src='/static/8328bd74000f76b69473afbebb4ddfec/ca1dc/img4.png' srcset='/static/8328bd74000f76b69473afbebb4ddfec/e7570/img4.png 170w,\n/static/8328bd74000f76b69473afbebb4ddfec/f46e7/img4.png 340w,\n/static/8328bd74000f76b69473afbebb4ddfec/ca1dc/img4.png 680w,\n/static/8328bd74000f76b69473afbebb4ddfec/02d09/img4.png 1020w,\n/static/8328bd74000f76b69473afbebb4ddfec/ef64d/img4.png 1165w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>첫 번째 유저를 저장할 때는 email 값을 null로 할당한 후 try - catch를 이용해 예외를 삼키고, 두 번째 유저는 정상적으로 저장한 후 PK를 출력해 봤습니다. 예상한 것처럼, 두 번째 유저의 PK는 2 임을 확인할 수 있습니다.</p>\n<p><strong>그렇다면, 애플리케이션 내 엔티티에서는 null을 어떻게 막을 수 있을까요?</strong></p>\n<h2>@NotNull과 함께라면?</h2>\n<p><code class=\"language-text\">@NotNull</code>은 java validation에 속하며 <code class=\"language-text\">@Valid</code>를 이용한 요청을 처리하는 단계에서 예외를 잡을 수도 있고, bean validation을 통해 예외를 검증할 수도 있습니다.</p>\n<p>우리가 DTO와 같이 클래스의 필드를 검증하는 방법과 동일하게 엔티티의 필드도 검증할 수 있습니다. 당연히 같은 자바 객체이고 도메인이기 때문에 동일하게 적용할 수 있습니다.</p>\n<p>@Valid 어노테이션도 없이 어떻게?라고 생각할 수 있는데요, Hibernate는 엔티티에 적용된 Bean Validation 어노테이션 역시 DDL로 변환합니다.\n@NotNull은 nullable=false와 마찬가지로 DDL 상에서 해당 컬럼이 NOT NULL 제약조건을 가짐을 명시합니다.</p>\n<p>스프링 공식문서인 밸덩에서도 이를 명확히 언급하고 있습니다. <a href=\"https://www.baeldung.com/hibernate-notnull-vs-nullable\">밸덩 바로가기</a></p>\n<p>이전 User 테이블에 nullable=false를 제거한 후 @NotNull 어노테이션만 붙여준 후 생성되는 DDL을 살펴보겠습니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token annotation punctuation\">@Entity</span>\n<span class=\"token annotation punctuation\">@Table</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user\"</span><span class=\"token punctuation\">)</span>\n<span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">User</span> <span class=\"token keyword\">extends</span> <span class=\"token class-name\">AuditingEntity</span> <span class=\"token punctuation\">{</span>\n\n    <span class=\"token annotation punctuation\">@Id</span>\n    <span class=\"token annotation punctuation\">@GeneratedValue</span><span class=\"token punctuation\">(</span>strategy <span class=\"token operator\">=</span> <span class=\"token class-name\">GenerationType</span><span class=\"token punctuation\">.</span><span class=\"token constant\">IDENTITY</span><span class=\"token punctuation\">)</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"id\"</span><span class=\"token punctuation\">,</span> updatable <span class=\"token operator\">=</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">Long</span> id<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"user_id\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> userId<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"password\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> password<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">20</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> name<span class=\"token punctuation\">;</span>\n\n    <span class=\"token annotation punctuation\">@NotNull</span>\n    <span class=\"token annotation punctuation\">@Column</span><span class=\"token punctuation\">(</span>name <span class=\"token operator\">=</span> <span class=\"token string\">\"email\"</span><span class=\"token punctuation\">,</span> length <span class=\"token operator\">=</span> <span class=\"token number\">50</span><span class=\"token punctuation\">)</span>\n    <span class=\"token keyword\">private</span> <span class=\"token class-name\">String</span> email<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 581px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/e5b63e9522a57e7a8f2337fc96f1da3e/3f4f8/img5.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 50.588235294117645%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABAUlEQVR42pWSWXKDMBBEfQ1biH0Tu9ic3P9gHbWIKCg7KfMxSEOJp+4ebqWq0HYDVNXAkwGE59v1WNIPT3vpBy9nXN0ICKMESZojilPESWZXP4gs/OFJPISEEP7Wi63/F0jIoCfoccY4LeiHEU3bIc1yUwWKsrIrL1VVjbxQfwP5uJsb87zEsjwtmLWsX5hNr81+NBc1bW+BDn6M4QVIlZkBrs9vo06jbjpM82qBBFEtlTm773I+AXmoVLVRtlmlbQKphsNyA/ukdiA/ps1jlnznhnMZyKCZFe12/WCAs7G8IghjiA9hpwwJ1L/hM0fa5xCuqNuBVMHa/sFk76+AHPAHtkYYSW8uW1QAAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img5' title='' src='/static/e5b63e9522a57e7a8f2337fc96f1da3e/3f4f8/img5.png' srcset='/static/e5b63e9522a57e7a8f2337fc96f1da3e/e7570/img5.png 170w,\n/static/e5b63e9522a57e7a8f2337fc96f1da3e/f46e7/img5.png 340w,\n/static/e5b63e9522a57e7a8f2337fc96f1da3e/3f4f8/img5.png 581w' sizes='(max-width: 581px) 100vw, 581px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>동일하게 <strong>email varchar(50) not null</strong> 과 같이 not null 제약 조건이 자동으로 명시됨을 알 수 있습니다.</p>\n<p>Hibernate에 의해 DDL이 자동으로 생성되는 기능을 끄고 싶다면 아래와 같이 설정하면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"properties\"><pre class=\"language-properties\"><code class=\"language-properties\"><span class=\"token key attr-name\">spring.jpa.properties.hibernate.validator.apply_to_ddl</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">false</span></code></pre></div>\n<p>그렇다면 nullable = false와 어떤 차이가 있을까요?</p>\n<p>차이점을 알아보기 위해 이전에 User의 email 필드에 null을 세팅한 후 저장하는 테스트 코드를 실행해보겠습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/0def70e8fe415ea9627150a16d3d5057/78ab2/img6.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 45.294117647058826%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABbElEQVR42kWSV3LDMAxEdRGrS+yqLuPYntz/VMgDJU8+dlC5XIAstpRkjpPENIkPSRzoByODcTkejSUXs+/pU2hN+wK+9UGsC+L9EReGYLveZN8Bdlk3MdbT5GWal6OZwzHN+YBarfuTMF90+mlapOi6QYJHgQIl1niJWAeRyzeTs04Mqqyq1rwqhLTrR+l0mtFm6EWFbTrZ2142cAULCHUrHsS6E1c1YkGkz525gK/1gXx1qaUta2kulbTEhaE4QzKBFbVqQ9OL00NKAuxpj/i/9q3HL7pRCo/sV0zyAx7InttBYiY9mr6EmlOFmg9nXsUMOs1JHuDKO7zxAC8We4dQVd4oKK7g3psM9efRyaKX4ifsws/Y5zXvtUW5h6eomHuH5EPDh2X/YBVK+NIcJL/k3/hv7Mbh1UWZwcKDadwxaoXCVkeuIdwgfJ1ED15NsUP4xD6HI69+XgkEyfL6EI7YmlVUjF2WjZRVI39VjAkScBD/sQAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img6' title='' src='/static/0def70e8fe415ea9627150a16d3d5057/ca1dc/img6.png' srcset='/static/0def70e8fe415ea9627150a16d3d5057/e7570/img6.png 170w,\n/static/0def70e8fe415ea9627150a16d3d5057/f46e7/img6.png 340w,\n/static/0def70e8fe415ea9627150a16d3d5057/ca1dc/img6.png 680w,\n/static/0def70e8fe415ea9627150a16d3d5057/02d09/img6.png 1020w,\n/static/0def70e8fe415ea9627150a16d3d5057/78ab2/img6.png 1201w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>다음과 같이 <code class=\"language-text\">javax.validation.ConstraintViolationException</code> 예외가 발생한다는 것을 알 수 있습니다. 또한 nullable=false 방식 때 발생하던 <strong>insert 쿼리가 발생하지 않는다</strong>는 점도 함께 볼 수 있습니다.</p>\n<p><code class=\"language-text\">javax.validation.ConstraintViolationException</code> 예외가 발생했다는 것은 스프링(자바) 애플리케이션 내에서 예외를 잡았다는 것입니다. 그러므로 데이터베이스에 쿼리가 실행될 일이 없습니다.</p>\n<p>좀 더 정확하게 말하면 객체가 생성되는 시점이 아닌 <strong>엔티티가 영속화되는 시점에 예외가 발생</strong>합니다.</p>\n<p>확실하게 알아보기 위해 동일한 User1, User2 저장 테스트를 실행해 보면 2번째로 저장한 유저의 PK가 1 임을 알 수 있습니다.</p>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/a5bab48c86a13529241f6a4e54ab9bf5/7e04b/img7.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 38.82352941176471%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABBklEQVR42o1SWY7DIBTjHNOmJQTIBiRkae9/Mhe/KJpFM+p8WM96q02i8rohzQtCnGB9B20s6sbhXjfQv6BmveBnnv2Na6FCTFjWHTFNCCHBlGW6NhjGgLYbBOTsY+Swb3vpHcYo+TFEjIWPhau8bJiKwpRmrNsD/TDCFaVb4XNewPq2P7E/nqW+Sz2WXubyspbZjDTNAgpTtHokstjmdariUt92sM4LP8Ea8+R3bVDdtKhmtLTcDwGN9QLaNY0t3Mk7Hfabb5yxNp85RudbiTymaOFyveHjUglO/jW+wzmryyFFZbRp7WGNsqmQ0Qn3uFb3t+Bi/h2KX4pDfA/iP8N/LTTW4wUNI+R3MMXm9wAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img7' title='' src='/static/a5bab48c86a13529241f6a4e54ab9bf5/ca1dc/img7.png' srcset='/static/a5bab48c86a13529241f6a4e54ab9bf5/e7570/img7.png 170w,\n/static/a5bab48c86a13529241f6a4e54ab9bf5/f46e7/img7.png 340w,\n/static/a5bab48c86a13529241f6a4e54ab9bf5/ca1dc/img7.png 680w,\n/static/a5bab48c86a13529241f6a4e54ab9bf5/02d09/img7.png 1020w,\n/static/a5bab48c86a13529241f6a4e54ab9bf5/7e04b/img7.png 1197w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>또한 @NotNull을 어노테이션을 사용하게 되면 예외 메시지를 직접 작성할 수 있는 장점도 존재합니다.</p>\n<hr>\n<p>여담으로, @NotNull 없이 nullable=false 만 설정한 경우에도 NULL 검증을 진행하고 싶다면 아래와 같이 설정하면 됩니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"properties\"><pre class=\"language-properties\"><code class=\"language-properties\"><span class=\"token key attr-name\">spring.jpa.properties.hibernate.check_nullability</span><span class=\"token punctuation\">=</span><span class=\"token value attr-value\">true</span></code></pre></div>\n<p><span class='gatsby-resp-image-wrapper' style='position: relative; display: block; margin-left: auto; margin-right: auto; max-width: 680px; margin-bottom: 16px;'>\n      <a class='gatsby-resp-image-link' href='/static/e8b3a0b2d617daac6f2414986df9fed6/bb7f4/img8.png' style='display: block' target='_blank' rel='noopener'>\n    <span class='gatsby-resp-image-background-image' style=\"padding-bottom: 43.529411764705884%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjklEQVR42m2S2ZabMBBE+Y5kYnYESAiDV7CdmTn5/2+q3JbfcvJQ7kXVpVKb7BQXxXnRFI+aiG7warpegXrwk/oxpNxPczr/t2f1GGLCsp6VNa1T03QJzg2qqkZFUalFtK5bNaAjt9rOW3g1nN5qkCIaxhm5KLtDeNF40Dh2Tks36Np7nYlnZ/moG+cbvAfxknigcTpRL1wYMDCXtfq8VHaC+Mngb3CDuCP0AJ8Iveht9Ky23Hg3VjL7KB9mENW5XpW5Rjg3wYD9S9vpym0rTYPlF0hncAV2aWx7TbZbxMe6UwWvJJacVbg10aKoldnQtxv1h2fas7/c280XDr/BO3pdhqDLOGnB3UyccRqYHRDuMeVAVbXKFn6eCD1tX817lxsOX+zzCXbcb/QjogNCE/CIB9CWlfJfuYpDodzALrMZZVv6HaQnIrB2XouLPNMrukkrn8hxWdOn0fFkP0UF8gMCPz4O+oloAnlm/9LGfmxvJmw7OyJSj4sqRH086b5t2vddrh/S0AfD/0NelPoLwD8Ks4SAzg4AAAAASUVORK5CYII='); background-size: cover; display: block;\"></span>\n  <img class='gatsby-resp-image-image' alt='img8' title='' src='/static/e8b3a0b2d617daac6f2414986df9fed6/ca1dc/img8.png' srcset='/static/e8b3a0b2d617daac6f2414986df9fed6/e7570/img8.png 170w,\n/static/e8b3a0b2d617daac6f2414986df9fed6/f46e7/img8.png 340w,\n/static/e8b3a0b2d617daac6f2414986df9fed6/ca1dc/img8.png 680w,\n/static/e8b3a0b2d617daac6f2414986df9fed6/02d09/img8.png 1020w,\n/static/e8b3a0b2d617daac6f2414986df9fed6/bb7f4/img8.png 1192w' sizes='(max-width: 680px) 100vw, 680px' style='width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0;' loading='lazy' decoding='async'>\n  </a>\n    </span></p>\n<p>\b스프링(자바) 애플리케이션 단에서 예외가 잡히는 것을 볼 수 있습니다. 하지만 예외 타입이 hibernate.PropertyValueException으로 다릅니다.</p>\n<p>굳이 추천하는 방법은 아닌 것 같습니다.</p>\n<p>또한 <code class=\"language-text\">@NotBlank</code>나 <code class=\"language-text\">@NotEmpty</code>는 자동으로 DDL을 생성해주지 않습니다.</p>\n<p>그러므로 @NotBlank나 @NotEmpty를 사용하는 경우에는 <code class=\"language-text\">@Column(nullable=false)</code>를 반드시 추가해야 DDL에 NOT NULL 제약조건이 반영됩니다.</p>\n<hr>\n<h2>정리</h2>\n<p><strong>@Column(nullable = false)</strong>\nDDL을 자동으로 생성하지만, 애플리케이션의 영속성 컨텍스트에서 엔티티 필드에 null이 들어가는 것을 막지 못한다.</p>\n<p>또한 데이터베이스에 쿼리가 실행된 후 예외가 발생한다.</p>\n<p><strong>@NotNull</strong>\nDDL을 자동으로 생성하고 애플리케이션의 영속성 컨텍스트에서 엔티티 필드에 null이 들어가는 것을 막는다.</p>\n<p>잘못된 제약 조건인 경우 데이터베이스에 불필요한 쿼리를 날리지 않는다.</p>\n<p>추가적으로 Bean Validation 방식은 예외 메세지를 직접 작성할 수 있다.</p>\n<p>또한 @Size와 같이 다른 validation을 통해 엔티티 필드 값을 검증할 수 있다.</p>\n<p>단점으로는 코드가 지저분해지고, JPA를 이용한 엔티티화 시킨 것이 아닌 객체라면 @NotNull 어노테이션을 해석하지 못한다.</p>\n<p>하이버네이트에서는 nullable=false보다 @NotNull 사용을 조금 더 권장하고 있다.</p>\n<h2>레퍼런스</h2>\n<p><a href=\"https://www.baeldung.com/hibernate-notnull-vs-nullable\">https://www.baeldung.com/hibernate-notnull-vs-nullable</a></p>\n<p><a href=\"https://kafcamus.tistory.com/15\">https://kafcamus.tistory.com/15</a></p>","frontmatter":{"title":"@NotNull과 nullable = false는 어떤 차이가 있을까?","date":"July 16, 2023","update":"July 16, 2023","tags":["JPA","Validation","nullable"],"series":null},"fields":{"slug":"/jpa-notnull-nullable/","readingTime":{"minutes":9.925}}},"seriesList":{"edges":[{"node":{"id":"28f1d87e-d3fc-5567-8531-57649652864f","fields":{"slug":"/sprint-idea/"},"frontmatter":{"title":"구글 스프린트 기반 아이디어 도출"}}},{"node":{"id":"4a9246fb-171b-5973-88fc-864034e78afd","fields":{"slug":"/blog-starter/"},"frontmatter":{"title":"피움 블로그 생성과정"}}},{"node":{"id":"c826ce0e-1ea7-517c-8d19-84e90a59a798","fields":{"slug":"/jenkins-setting/"},"frontmatter":{"title":"젠킨스 설치하기"}}},{"node":{"id":"a387bf4f-567f-50e7-b6a7-99a1a1c8971b","fields":{"slug":"/jpa-notnull-nullable/"},"frontmatter":{"title":"@NotNull과 nullable = false는 어떤 차이가 있을까?"}}},{"node":{"id":"a78e224b-b711-5071-8e90-013d6f4bebc3","fields":{"slug":"/pium-deploy-step/"},"frontmatter":{"title":"피움의 배포과정"}}},{"node":{"id":"ce07fbab-1ed5-5f1e-8e2f-eb430879b56a","fields":{"slug":"/fe-tanstack-query/"},"frontmatter":{"title":"프론트엔드: Tanstack Query 사용에 대하여"}}},{"node":{"id":"159c943b-1a50-57dd-aa71-7557364752a5","fields":{"slug":"/ci-cd-setting/"},"frontmatter":{"title":"Jenkins와 Github Webhook을 이용해 CI/CD 구축하기"}}},{"node":{"id":"dea45a4a-bfde-5fbb-8a97-42d3a3e77a0b","fields":{"slug":"/jenkins-hook-by-label/"},"frontmatter":{"title":"PR 라벨로 젠킨스 빌드유발을 구분하기"}}},{"node":{"id":"1a03734e-d413-553f-9152-1dad2fc4acca","fields":{"slug":"/apply-https/"},"frontmatter":{"title":"내 서버에 HTTPS 설정하기"}}},{"node":{"id":"cecbc8b9-db00-562b-aa0b-06c406cfc44a","fields":{"slug":"/bundle-analyze/"},"frontmatter":{"title":"bundle-analyze를 통한 bundle 크기 분석"}}},{"node":{"id":"707f8ffb-1409-5c27-b15a-5661b235c226","fields":{"slug":"/db-drop-stop/"},"frontmatter":{"title":"Table Drop 못하게 막아버리기"}}},{"node":{"id":"fe4b591a-4dd5-5dd2-b18a-b318afd1e9e3","fields":{"slug":"/transactional-not-in-restassured/"},"frontmatter":{"title":"[트러블슈팅] @SpringbootTest의 RANDOM_PORT 환경에서 @Transactional 어노테이션을 사용했을 때, RestAssured GET 요청이 수행되지 않는 경우(트랜잭션 격리 이해하기)"}}},{"node":{"id":"80aa708e-ef8a-5c79-9644-cb8c04d55a63","fields":{"slug":"/acceptance-test-resolve/"},"frontmatter":{"title":"인수테스트 데이터 초기화하기"}}},{"node":{"id":"15def1d5-c20f-5d07-b46e-24a14661365f","fields":{"slug":"/react-setting-without-cra/"},"frontmatter":{"title":"webpack으로만 React 설정하기 (without CRA)"}}},{"node":{"id":"66383c86-e2c8-533a-90e0-2effae572742","fields":{"slug":"/stylelint-and-husky/"},"frontmatter":{"title":"stylelint와 husky를 통해 컨벤션 통일하기"}}},{"node":{"id":"ed5951d5-beda-5a8f-adb2-07c2fcb38d5e","fields":{"slug":"/OAuth2.0/"},"frontmatter":{"title":"내가 이해한 OAuth2.0"}}},{"node":{"id":"45eeb9a3-557d-5704-8fd9-925283e1e27b","fields":{"slug":"/restdocs-start/"},"frontmatter":{"title":"RestDocs로 API 문서화하기"}}},{"node":{"id":"663b560a-734d-51a9-a6dc-3c4f50716c74","fields":{"slug":"/spring-event-apply/"},"frontmatter":{"title":"Spring Event 적용하기"}}},{"node":{"id":"55ae8038-3f65-5a59-8db3-c7405e7fc125","fields":{"slug":"/github-actions-cypress/"},"frontmatter":{"title":"피움 Cypress 자동화 구축기"}}},{"node":{"id":"503e9e71-eda3-53d7-8142-7c309faf213e","fields":{"slug":"/why_we_applied_querydsl/"},"frontmatter":{"title":"피움 서비스의 Querydsl 도입 이유"}}},{"node":{"id":"5c865dcb-cefd-58be-8968-b5edf6c8080c","fields":{"slug":"/server-logging/"},"frontmatter":{"title":"Logback을 이용해 운영 환경 별 로그 남기기"}}},{"node":{"id":"709124d0-5b05-5530-804d-e90ec9856a13","fields":{"slug":"/querydsl_apply_procedure/"},"frontmatter":{"title":"피움 서비스의 Querydsl 적용 과정"}}},{"node":{"id":"8269f166-d041-533c-9d44-332d8d8c3dca","fields":{"slug":"/server-monitoring/"},"frontmatter":{"title":"CloudWatch를 이용한 모니터링 환경 구성"}}},{"node":{"id":"0faec7ad-3bd1-5f5e-9222-115f771df8ed","fields":{"slug":"/tanstack-query-cache-trouble-shooting/"},"frontmatter":{"title":"InfinityQuery에서 fetch가 제대로 이루어지지 않는다?!?!"}}},{"node":{"id":"c77f7199-7fc6-53a3-a1fb-0792e05655a7","fields":{"slug":"/OAuth2.0-backend/"},"frontmatter":{"title":"OAuth 2.0 로그인 구현하기 (카카오)"}}},{"node":{"id":"12e4480d-386b-5d0e-bd69-4209fed36066","fields":{"slug":"/OAuth-test-backend/"},"frontmatter":{"title":"외부 API 를 의존하는 OAuth 로그인 테스트하기"}}},{"node":{"id":"ff40e109-cc92-5d83-a213-ca9d07136d95","fields":{"slug":"/aws-s3-apply/"},"frontmatter":{"title":"AWS S3로 정적 이미지 배포하기"}}},{"node":{"id":"e343af80-72dd-5173-bbb5-5069a17d1200","fields":{"slug":"/search_in_spring_data_jpa/"},"frontmatter":{"title":"Spring Data Jpa를 활용한 검색 기능 개발하기"}}},{"node":{"id":"af344dd8-ea77-5fde-9452-a97952ce60be","fields":{"slug":"/submodule-apply/"},"frontmatter":{"title":"Git submodule을 이용한 민감정보 관리"}}},{"node":{"id":"08c9daf0-2344-52a9-8c68-31ac04c24ff0","fields":{"slug":"/tomcat-thread-config/"},"frontmatter":{"title":"톰캣 스레드 설정하기"}}},{"node":{"id":"eafed74f-ff11-5af1-a589-e9dd2ccb5c8e","fields":{"slug":"/http-cache/"},"frontmatter":{"title":"CloudFront와 HTTP 캐시"}}},{"node":{"id":"dbe47289-01f4-571d-9506-fbb92016f547","fields":{"slug":"/optimize-frontend/"},"frontmatter":{"title":"피움 최적화하기"}}},{"node":{"id":"7b830fe6-e2df-564a-926e-7f7800380336","fields":{"slug":"/query-analysis/"},"frontmatter":{"title":"서비스 내에서 발생하는 쿼리를 분석하고 개선하기"}}},{"node":{"id":"37437d15-a63e-52ef-b031-6ee1bc6fa8bc","fields":{"slug":"/image-resize/"},"frontmatter":{"title":"서버에서 이미지 리사이징하기"}}}]},"previous":{"fields":{"slug":"/jenkins-setting/"},"frontmatter":{"title":"젠킨스 설치하기"}},"next":{"fields":{"slug":"/pium-deploy-step/"},"frontmatter":{"title":"피움의 배포과정"}}},"pageContext":{"id":"a387bf4f-567f-50e7-b6a7-99a1a1c8971b","series":null,"previousPostId":"c826ce0e-1ea7-517c-8d19-84e90a59a798","nextPostId":"a78e224b-b711-5071-8e90-013d6f4bebc3"}},"staticQueryHashes":[],"slicesMap":{}}